const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BveS8cjY.js","assets/index-C8gjeNZq.css","assets/core-DgXLvxy9.js"])))=>i.map(i=>d[i]);
import{j as ud,aF as ld,aG as qh,g as H,at as Kt,aH as dd,B as _e,aI as rt,l as pd,aJ as vi,aK as yo,aL as Vo}from"./index-BveS8cjY.js";function fi(i){return new Promise((e,t)=>{i.oncomplete=i.onsuccess=()=>e(i.result),i.onabort=i.onerror=()=>t(i.error)})}function Fh(i,e){let t;const r=()=>{if(t)return t;const s=indexedDB.open(i);return s.onupgradeneeded=()=>s.result.createObjectStore(e),t=fi(s),t.then(n=>{n.onclose=()=>t=void 0},()=>{}),t};return(s,n)=>r().then(o=>n(o.transaction(e,s).objectStore(e)))}let Bs;function Cr(){return Bs||(Bs=Fh("keyval-store","keyval")),Bs}function Ko(i,e=Cr()){return e("readonly",t=>fi(t.get(i)))}function fd(i,e,t=Cr()){return t("readwrite",r=>(r.put(e,i),fi(r.transaction)))}function gd(i,e=Cr()){return e("readwrite",t=>(t.delete(i),fi(t.transaction)))}function yd(i=Cr()){return i("readwrite",e=>(e.clear(),fi(e.transaction)))}function md(i,e){return i.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},fi(i.transaction)}function wd(i=Cr()){return i("readonly",e=>{if(e.getAllKeys)return fi(e.getAllKeys());const t=[];return md(e,r=>t.push(r.key)).then(()=>t)})}var Ls={};var Cn=function(i,e){return Cn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])},Cn(i,e)};function bd(i,e){Cn(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var An=function(){return An=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},An.apply(this,arguments)};function vd(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t}function Ed(i,e,t,r){var s=arguments.length,n=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(i,e,t,r);else for(var a=i.length-1;a>=0;a--)(o=i[a])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function _d(i,e){return function(t,r){e(t,r,i)}}function Id(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)}function Dd(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{h(r.next(u))}catch(l){o(l)}}function c(u){try{h(r.throw(u))}catch(l){o(l)}}function h(u){u.done?n(u.value):s(u.value).then(a,c)}h((r=r.apply(i,e||[])).next())})}function $d(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(u){return c([h,u])}}function c(h){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,s&&(n=h[0]&2?s.return:h[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,h[1])).done)return n;switch(s=0,n&&(h=[h[0]&2,n.value]),h[0]){case 0:case 1:n=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,s=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){t.label=h[1];break}if(h[0]===6&&t.label<n[1]){t.label=n[1],n=h;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(h);break}n[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(i,t)}catch(u){h=[6,u],s=0}finally{r=n=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Sd(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}function Pd(i,e){for(var t in i)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=i[t])}function xn(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],r=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Bh(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var r=t.call(i),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return n}function Od(){for(var i=[],e=0;e<arguments.length;e++)i=i.concat(Bh(arguments[e]));return i}function Cd(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;for(var r=Array(i),s=0,e=0;e<t;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)r[s]=n[o];return r}function _r(i){return this instanceof _r?(this.v=i,this):new _r(i)}function Ad(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(i,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(d){r[d]&&(s[d]=function(f){return new Promise(function(p,g){n.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{c(r[d](f))}catch(p){l(n[0][3],p)}}function c(d){d.value instanceof _r?Promise.resolve(d.value.v).then(h,u):l(n[0][2],d)}function h(d){a("next",d)}function u(d){a("throw",d)}function l(d,f){d(f),n.shift(),n.length&&a(n[0][0],n[0][1])}}function xd(i){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,n){e[s]=i[s]?function(o){return(t=!t)?{value:_r(i[s](o)),done:s==="return"}:n?n(o):o}:n}}function Nd(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof xn=="function"?xn(i):i[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=i[n]&&function(o){return new Promise(function(a,c){o=i[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(h){n({value:h,done:a})},o)}}function Td(i,e){return Object.defineProperty?Object.defineProperty(i,"raw",{value:e}):i.raw=e,i}function Rd(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)Object.hasOwnProperty.call(i,t)&&(e[t]=i[t]);return e.default=i,e}function jd(i){return i&&i.__esModule?i:{default:i}}function Ud(i,e){if(!e.has(i))throw new TypeError("attempted to get private field on non-instance");return e.get(i)}function qd(i,e,t){if(!e.has(i))throw new TypeError("attempted to set private field on non-instance");return e.set(i,t),t}const Fd=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return An},__asyncDelegator:xd,__asyncGenerator:Ad,__asyncValues:Nd,__await:_r,__awaiter:Dd,__classPrivateFieldGet:Ud,__classPrivateFieldSet:qd,__createBinding:Sd,__decorate:Ed,__exportStar:Pd,__extends:bd,__generator:$d,__importDefault:jd,__importStar:Rd,__makeTemplateObject:Td,__metadata:Id,__param:_d,__read:Bh,__rest:vd,__spread:Od,__spreadArrays:Cd,__values:xn},Symbol.toStringTag,{value:"Module"})),Ar=ud(Fd);var ks={},sr={},Wo;function Bd(){if(Wo)return sr;Wo=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.delay=void 0;function i(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return sr.delay=i,sr}var Jt={},Ms={},Zt={},Go;function Ld(){return Go||(Go=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.ONE_THOUSAND=Zt.ONE_HUNDRED=void 0,Zt.ONE_HUNDRED=100,Zt.ONE_THOUSAND=1e3),Zt}var zs={},Yo;function kd(){return Yo||(Yo=1,(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ONE_YEAR=i.FOUR_WEEKS=i.THREE_WEEKS=i.TWO_WEEKS=i.ONE_WEEK=i.THIRTY_DAYS=i.SEVEN_DAYS=i.FIVE_DAYS=i.THREE_DAYS=i.ONE_DAY=i.TWENTY_FOUR_HOURS=i.TWELVE_HOURS=i.SIX_HOURS=i.THREE_HOURS=i.ONE_HOUR=i.SIXTY_MINUTES=i.THIRTY_MINUTES=i.TEN_MINUTES=i.FIVE_MINUTES=i.ONE_MINUTE=i.SIXTY_SECONDS=i.THIRTY_SECONDS=i.TEN_SECONDS=i.FIVE_SECONDS=i.ONE_SECOND=void 0,i.ONE_SECOND=1,i.FIVE_SECONDS=5,i.TEN_SECONDS=10,i.THIRTY_SECONDS=30,i.SIXTY_SECONDS=60,i.ONE_MINUTE=i.SIXTY_SECONDS,i.FIVE_MINUTES=i.ONE_MINUTE*5,i.TEN_MINUTES=i.ONE_MINUTE*10,i.THIRTY_MINUTES=i.ONE_MINUTE*30,i.SIXTY_MINUTES=i.ONE_MINUTE*60,i.ONE_HOUR=i.SIXTY_MINUTES,i.THREE_HOURS=i.ONE_HOUR*3,i.SIX_HOURS=i.ONE_HOUR*6,i.TWELVE_HOURS=i.ONE_HOUR*12,i.TWENTY_FOUR_HOURS=i.ONE_HOUR*24,i.ONE_DAY=i.TWENTY_FOUR_HOURS,i.THREE_DAYS=i.ONE_DAY*3,i.FIVE_DAYS=i.ONE_DAY*5,i.SEVEN_DAYS=i.ONE_DAY*7,i.THIRTY_DAYS=i.ONE_DAY*30,i.ONE_WEEK=i.SEVEN_DAYS,i.TWO_WEEKS=i.ONE_WEEK*2,i.THREE_WEEKS=i.ONE_WEEK*3,i.FOUR_WEEKS=i.ONE_WEEK*4,i.ONE_YEAR=i.ONE_DAY*365})(zs)),zs}var Jo;function Lh(){return Jo||(Jo=1,(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=Ar;e.__exportStar(Ld(),i),e.__exportStar(kd(),i)})(Ms)),Ms}var Zo;function Md(){if(Zo)return Jt;Zo=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.fromMiliseconds=Jt.toMiliseconds=void 0;const i=Lh();function e(r){return r*i.ONE_THOUSAND}Jt.toMiliseconds=e;function t(r){return Math.floor(r/i.ONE_THOUSAND)}return Jt.fromMiliseconds=t,Jt}var Qo;function zd(){return Qo||(Qo=1,(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=Ar;e.__exportStar(Bd(),i),e.__exportStar(Md(),i)})(ks)),ks}var Ei={},Xo;function Hd(){if(Xo)return Ei;Xo=1,Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.Watch=void 0;class i{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const r=this.get(t);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-r.started;this.timestamps.set(t,{started:r.started,elapsed:s})}get(t){const r=this.timestamps.get(t);if(typeof r>"u")throw new Error(`No timestamp found for label: ${t}`);return r}elapsed(t){const r=this.get(t);return r.elapsed||Date.now()-r.started}}return Ei.Watch=i,Ei.default=i,Ei}var Hs={},nr={},ea;function Vd(){if(ea)return nr;ea=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.IWatch=void 0;class i{}return nr.IWatch=i,nr}var ta;function Kd(){return ta||(ta=1,(function(i){Object.defineProperty(i,"__esModule",{value:!0}),Ar.__exportStar(Vd(),i)})(Hs)),Hs}var ia;function Wd(){return ia||(ia=1,(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=Ar;e.__exportStar(zd(),i),e.__exportStar(Hd(),i),e.__exportStar(Kd(),i),e.__exportStar(Lh(),i)})(Ls)),Ls}var q=Wd(),re={},ra;function kh(){if(ra)return re;ra=1,Object.defineProperty(re,"__esModule",{value:!0}),re.getLocalStorage=re.getLocalStorageOrThrow=re.getCrypto=re.getCryptoOrThrow=re.getLocation=re.getLocationOrThrow=re.getNavigator=re.getNavigatorOrThrow=re.getDocument=re.getDocumentOrThrow=re.getFromWindowOrThrow=re.getFromWindow=void 0;function i(d){let f;return typeof window<"u"&&typeof window[d]<"u"&&(f=window[d]),f}re.getFromWindow=i;function e(d){const f=i(d);if(!f)throw new Error(`${d} is not defined in Window`);return f}re.getFromWindowOrThrow=e;function t(){return e("document")}re.getDocumentOrThrow=t;function r(){return i("document")}re.getDocument=r;function s(){return e("navigator")}re.getNavigatorOrThrow=s;function n(){return i("navigator")}re.getNavigator=n;function o(){return e("location")}re.getLocationOrThrow=o;function a(){return i("location")}re.getLocation=a;function c(){return e("crypto")}re.getCryptoOrThrow=c;function h(){return i("crypto")}re.getCrypto=h;function u(){return e("localStorage")}re.getLocalStorageOrThrow=u;function l(){return i("localStorage")}return re.getLocalStorage=l,re}var Ut=kh(),or={},sa;function Gd(){if(sa)return or;sa=1,Object.defineProperty(or,"__esModule",{value:!0}),or.getWindowMetadata=void 0;const i=kh();function e(){let t,r;try{t=i.getDocumentOrThrow(),r=i.getLocationOrThrow()}catch{return null}function s(){const f=t.getElementsByTagName("link"),p=[];for(let g=0;g<f.length;g++){const y=f[g],v=y.getAttribute("rel");if(v&&v.toLowerCase().indexOf("icon")>-1){const m=y.getAttribute("href");if(m)if(m.toLowerCase().indexOf("https:")===-1&&m.toLowerCase().indexOf("http:")===-1&&m.indexOf("//")!==0){let b=r.protocol+"//"+r.host;if(m.indexOf("/")===0)b+=m;else{const P=r.pathname.split("/");P.pop();const A=P.join("/");b+=A+"/"+m}p.push(b)}else if(m.indexOf("//")===0){const b=r.protocol+m;p.push(b)}else p.push(m)}}return p}function n(...f){const p=t.getElementsByTagName("meta");for(let g=0;g<p.length;g++){const y=p[g],v=["itemprop","property","name"].map(m=>y.getAttribute(m)).filter(m=>m?f.includes(m):!1);if(v.length&&v){const m=y.getAttribute("content");if(m)return m}}return""}function o(){let f=n("name","og:site_name","og:title","twitter:title");return f||(f=t.title),f}function a(){return n("description","og:description","twitter:description","keywords")}const c=o(),h=a(),u=r.origin,l=s();return{description:h,url:u,icons:l,name:c}}return or.getWindowMetadata=e,or}var Yd=Gd();function Ir(i,{strict:e=!0}={}){return!i||typeof i!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(i):i.startsWith("0x")}function na(i){return Ir(i,{strict:!1})?Math.ceil((i.length-2)/2):i.length}const Mh="2.23.2";let Vs={getDocsUrl:({docsBaseUrl:i,docsPath:e="",docsSlug:t})=>e?`${i??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${Mh}`};class hi extends Error{constructor(e,t={}){const r=t.cause instanceof hi?t.cause.details:t.cause?.message?t.cause.message:t.details,s=t.cause instanceof hi&&t.cause.docsPath||t.docsPath,n=Vs.getDocsUrl?.({...t,docsPath:s}),o=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...r?[`Details: ${r}`]:[],...Vs.version?[`Version: ${Vs.version}`]:[]].join(`
`);super(o,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=Mh}walk(e){return zh(this,e)}}function zh(i,e){return e?.(i)?i:i&&typeof i=="object"&&"cause"in i&&i.cause!==void 0?zh(i.cause,e):e?null:i}class Hh extends hi{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function Zi(i,{dir:e,size:t=32}={}){return typeof i=="string"?Jd(i,{dir:e,size:t}):Zd(i,{dir:e,size:t})}function Jd(i,{dir:e,size:t=32}={}){if(t===null)return i;const r=i.replace("0x","");if(r.length>t*2)throw new Hh({size:Math.ceil(r.length/2),targetSize:t,type:"hex"});return`0x${r[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function Zd(i,{dir:e,size:t=32}={}){if(t===null)return i;if(i.length>t)throw new Hh({size:i.length,targetSize:t,type:"bytes"});const r=new Uint8Array(t);for(let s=0;s<t;s++){const n=e==="right";r[n?s:t-s-1]=i[n?s:i.length-s-1]}return r}class Qd extends hi{constructor({max:e,min:t,signed:r,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class Xd extends hi{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Qi(i,{size:e}){if(na(i)>e)throw new Xd({givenSize:na(i),maxSize:e})}function Nn(i,e={}){const{signed:t}=e;e.size&&Qi(i,{size:e.size});const r=BigInt(i);if(!t)return r;const s=(i.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return r<=n?r:r-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function ep(i,e={}){return Number(Nn(i,e))}const tp=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function Tn(i,e={}){return typeof i=="number"||typeof i=="bigint"?Kh(i,e):typeof i=="string"?sp(i,e):typeof i=="boolean"?ip(i,e):Vh(i,e)}function ip(i,e={}){const t=`0x${Number(i)}`;return typeof e.size=="number"?(Qi(t,{size:e.size}),Zi(t,{size:e.size})):t}function Vh(i,e={}){let t="";for(let s=0;s<i.length;s++)t+=tp[i[s]];const r=`0x${t}`;return typeof e.size=="number"?(Qi(r,{size:e.size}),Zi(r,{dir:"right",size:e.size})):r}function Kh(i,e={}){const{signed:t,size:r}=e,s=BigInt(i);let n;r?t?n=(1n<<BigInt(r)*8n-1n)-1n:n=2n**(BigInt(r)*8n)-1n:typeof i=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&t?-n-1n:0;if(n&&s>n||s<o){const c=typeof i=="bigint"?"n":"";throw new Qd({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:t,size:r,value:`${i}${c}`})}const a=`0x${(t&&s<0?(1n<<BigInt(r*8))+BigInt(s):s).toString(16)}`;return r?Zi(a,{size:r}):a}const rp=new TextEncoder;function sp(i,e={}){const t=rp.encode(i);return Vh(t,e)}const np=new TextEncoder;function op(i,e={}){return typeof i=="number"||typeof i=="bigint"?cp(i,e):typeof i=="boolean"?ap(i,e):Ir(i)?Wh(i,e):Gh(i,e)}function ap(i,e={}){const t=new Uint8Array(1);return t[0]=Number(i),typeof e.size=="number"?(Qi(t,{size:e.size}),Zi(t,{size:e.size})):t}const $t={zero:48,nine:57,A:65,F:70,a:97,f:102};function oa(i){if(i>=$t.zero&&i<=$t.nine)return i-$t.zero;if(i>=$t.A&&i<=$t.F)return i-($t.A-10);if(i>=$t.a&&i<=$t.f)return i-($t.a-10)}function Wh(i,e={}){let t=i;e.size&&(Qi(t,{size:e.size}),t=Zi(t,{dir:"right",size:e.size}));let r=t.slice(2);r.length%2&&(r=`0${r}`);const s=r.length/2,n=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=oa(r.charCodeAt(a++)),h=oa(r.charCodeAt(a++));if(c===void 0||h===void 0)throw new hi(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);n[o]=c*16+h}return n}function cp(i,e){const t=Kh(i,e);return Wh(t)}function Gh(i,e={}){const t=np.encode(i);return typeof e.size=="number"?(Qi(t,{size:e.size}),Zi(t,{dir:"right",size:e.size})):t}function Yh(i,e){const t=e||"hex",r=ld(Ir(i,{strict:!1})?op(i):i);return t==="bytes"?r:Tn(r)}class hp extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const Ks=new hp(8192);function up(i,e){if(Ks.has(`${i}.${e}`))return Ks.get(`${i}.${e}`);const t=i.substring(2).toLowerCase(),r=Yh(Gh(t),"bytes"),s=t.split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(r[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const n=`0x${s.join("")}`;return Ks.set(`${i}.${e}`,n),n}function lp(i){const e=Yh(`0x${i.substring(4)}`).substring(26);return up(`0x${e}`)}async function dp({hash:i,signature:e}){const t=Ir(i)?i:Tn(i),{secp256k1:r}=await qh(async()=>{const{secp256k1:o}=await import("./index-BveS8cjY.js").then(a=>a.aU);return{secp256k1:o}},__vite__mapDeps([0,1]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:h,s:u,v:l,yParity:d}=e,f=Number(d??l),p=aa(f);return new r.Signature(Nn(h),Nn(u)).addRecoveryBit(p)}const o=Ir(e)?e:Tn(e),a=ep(`0x${o.slice(130)}`),c=aa(a);return r.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function aa(i){if(i===0||i===1)return i;if(i===27)return 0;if(i===28)return 1;throw new Error("Invalid yParityOrV value")}async function pp({hash:i,signature:e}){return lp(await dp({hash:i,signature:e}))}function fp(i){if(i.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let h=0;h<e.length;h++)e[h]=255;for(let h=0;h<i.length;h++){const u=i.charAt(h),l=u.charCodeAt(0);if(e[l]!==255)throw new TypeError(u+" is ambiguous");e[l]=h}const t=i.length,r=i.charAt(0),s=Math.log(t)/Math.log(256),n=Math.log(256)/Math.log(t);function o(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";let u=0,l=0,d=0;const f=h.length;for(;d!==f&&h[d]===0;)d++,u++;const p=(f-d)*n+1>>>0,g=new Uint8Array(p);for(;d!==f;){let m=h[d],b=0;for(let P=p-1;(m!==0||b<l)&&P!==-1;P--,b++)m+=256*g[P]>>>0,g[P]=m%t>>>0,m=m/t>>>0;if(m!==0)throw new Error("Non-zero carry");l=b,d++}let y=p-l;for(;y!==p&&g[y]===0;)y++;let v=r.repeat(u);for(;y<p;++y)v+=i.charAt(g[y]);return v}function a(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;let u=0,l=0,d=0;for(;h[u]===r;)l++,u++;const f=(h.length-u)*s+1>>>0,p=new Uint8Array(f);for(;u<h.length;){const m=h.charCodeAt(u);if(m>255)return;let b=e[m];if(b===255)return;let P=0;for(let A=f-1;(b!==0||P<d)&&A!==-1;A--,P++)b+=t*p[A]>>>0,p[A]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");d=P,u++}let g=f-d;for(;g!==f&&p[g]===0;)g++;const y=new Uint8Array(l+(f-g));let v=l;for(;g!==f;)y[v++]=p[g++];return y}function c(h){const u=a(h);if(u)return u;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var gp="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const yp=fp(gp),mp=i=>JSON.stringify(i,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),wp=i=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=i.replace(e,'$1"$2n"$3');return JSON.parse(t,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function ui(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return wp(i)}catch{return i}}function qt(i){return typeof i=="string"?i:mp(i)||""}function bp(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Jh(i,...e){if(!bp(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error("Uint8Array expected of length "+e+", got length="+i.length)}function ca(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function vp(i,e){Jh(i);const t=e.outputLen;if(i.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const _i=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Ws=i=>new DataView(i.buffer,i.byteOffset,i.byteLength);function Ep(i){if(typeof i!="string")throw new Error("utf8ToBytes expected string, got "+typeof i);return new Uint8Array(new TextEncoder().encode(i))}function Zh(i){return typeof i=="string"&&(i=Ep(i)),Jh(i),i}let _p=class{clone(){return this._cloneInto()}};function Ip(i){const e=r=>i().update(Zh(r)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Qh(i=32){if(_i&&typeof _i.getRandomValues=="function")return _i.getRandomValues(new Uint8Array(i));if(_i&&typeof _i.randomBytes=="function")return _i.randomBytes(i);throw new Error("crypto.getRandomValues must be defined")}function Dp(i,e,t,r){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n),c=r?4:0,h=r?0:4;i.setUint32(e+c,o,r),i.setUint32(e+h,a,r)}let $p=class extends _p{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ws(this.buffer)}update(e){ca(this);const{view:t,buffer:r,blockLen:s}=this;e=Zh(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Ws(e);for(;s<=n-o;o+=s)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ca(this),vp(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let l=o;l<s;l++)t[l]=0;Dp(r,s-8,BigInt(this.length*8),n),this.process(r,0);const a=Ws(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<h;l++)a.setUint32(4*l,u[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%t&&e.buffer.set(r),e}};const Mr=BigInt(2**32-1),Rn=BigInt(32);function Xh(i,e=!1){return e?{h:Number(i&Mr),l:Number(i>>Rn&Mr)}:{h:Number(i>>Rn&Mr)|0,l:Number(i&Mr)|0}}function Sp(i,e=!1){let t=new Uint32Array(i.length),r=new Uint32Array(i.length);for(let s=0;s<i.length;s++){const{h:n,l:o}=Xh(i[s],e);[t[s],r[s]]=[n,o]}return[t,r]}const Pp=(i,e)=>BigInt(i>>>0)<<Rn|BigInt(e>>>0),Op=(i,e,t)=>i>>>t,Cp=(i,e,t)=>i<<32-t|e>>>t,Ap=(i,e,t)=>i>>>t|e<<32-t,xp=(i,e,t)=>i<<32-t|e>>>t,Np=(i,e,t)=>i<<64-t|e>>>t-32,Tp=(i,e,t)=>i>>>t-32|e<<64-t,Rp=(i,e)=>e,jp=(i,e)=>i,Up=(i,e,t)=>i<<t|e>>>32-t,qp=(i,e,t)=>e<<t|i>>>32-t,Fp=(i,e,t)=>e<<t-32|i>>>64-t,Bp=(i,e,t)=>i<<t-32|e>>>64-t;function Lp(i,e,t,r){const s=(e>>>0)+(r>>>0);return{h:i+t+(s/2**32|0)|0,l:s|0}}const kp=(i,e,t)=>(i>>>0)+(e>>>0)+(t>>>0),Mp=(i,e,t,r)=>e+t+r+(i/2**32|0)|0,zp=(i,e,t,r)=>(i>>>0)+(e>>>0)+(t>>>0)+(r>>>0),Hp=(i,e,t,r,s)=>e+t+r+s+(i/2**32|0)|0,Vp=(i,e,t,r,s)=>(i>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(s>>>0),Kp=(i,e,t,r,s,n)=>e+t+r+s+n+(i/2**32|0)|0,W={fromBig:Xh,split:Sp,toBig:Pp,shrSH:Op,shrSL:Cp,rotrSH:Ap,rotrSL:xp,rotrBH:Np,rotrBL:Tp,rotr32H:Rp,rotr32L:jp,rotlSH:Up,rotlSL:qp,rotlBH:Fp,rotlBL:Bp,add:Lp,add3L:kp,add3H:Mp,add4L:zp,add4H:Hp,add5H:Kp,add5L:Vp},[Wp,Gp]=W.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(i=>BigInt(i))),Ft=new Uint32Array(80),Bt=new Uint32Array(80);let Yp=class extends $p{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:h,El:u,Fh:l,Fl:d,Gh:f,Gl:p,Hh:g,Hl:y}=this;return[e,t,r,s,n,o,a,c,h,u,l,d,f,p,g,y]}set(e,t,r,s,n,o,a,c,h,u,l,d,f,p,g,y){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=h|0,this.El=u|0,this.Fh=l|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=y|0}process(e,t){for(let b=0;b<16;b++,t+=4)Ft[b]=e.getUint32(t),Bt[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const P=Ft[b-15]|0,A=Bt[b-15]|0,w=W.rotrSH(P,A,1)^W.rotrSH(P,A,8)^W.shrSH(P,A,7),_=W.rotrSL(P,A,1)^W.rotrSL(P,A,8)^W.shrSL(P,A,7),D=Ft[b-2]|0,I=Bt[b-2]|0,j=W.rotrSH(D,I,19)^W.rotrBH(D,I,61)^W.shrSH(D,I,6),R=W.rotrSL(D,I,19)^W.rotrBL(D,I,61)^W.shrSL(D,I,6),U=W.add4L(_,R,Bt[b-7],Bt[b-16]),k=W.add4H(U,w,j,Ft[b-7],Ft[b-16]);Ft[b]=k|0,Bt[b]=U|0}let{Ah:r,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:h,Dl:u,Eh:l,El:d,Fh:f,Fl:p,Gh:g,Gl:y,Hh:v,Hl:m}=this;for(let b=0;b<80;b++){const P=W.rotrSH(l,d,14)^W.rotrSH(l,d,18)^W.rotrBH(l,d,41),A=W.rotrSL(l,d,14)^W.rotrSL(l,d,18)^W.rotrBL(l,d,41),w=l&f^~l&g,_=d&p^~d&y,D=W.add5L(m,A,_,Gp[b],Bt[b]),I=W.add5H(D,v,P,w,Wp[b],Ft[b]),j=D|0,R=W.rotrSH(r,s,28)^W.rotrBH(r,s,34)^W.rotrBH(r,s,39),U=W.rotrSL(r,s,28)^W.rotrBL(r,s,34)^W.rotrBL(r,s,39),k=r&n^r&a^n&a,$=s&o^s&c^o&c;v=g|0,m=y|0,g=f|0,y=p|0,f=l|0,p=d|0,{h:l,l:d}=W.add(h|0,u|0,I|0,j|0),h=a|0,u=c|0,a=n|0,c=o|0,n=r|0,o=s|0;const S=W.add3L(j,U,$);r=W.add3H(S,I,R,k),s=S|0}({h:r,l:s}=W.add(this.Ah|0,this.Al|0,r|0,s|0)),{h:n,l:o}=W.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=W.add(this.Ch|0,this.Cl|0,a|0,c|0),{h,l:u}=W.add(this.Dh|0,this.Dl|0,h|0,u|0),{h:l,l:d}=W.add(this.Eh|0,this.El|0,l|0,d|0),{h:f,l:p}=W.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:y}=W.add(this.Gh|0,this.Gl|0,g|0,y|0),{h:v,l:m}=W.add(this.Hh|0,this.Hl|0,v|0,m|0),this.set(r,s,n,o,a,c,h,u,l,d,f,p,g,y,v,m)}roundClean(){Ft.fill(0),Bt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Jp=Ip(()=>new Yp);const mo=BigInt(0),eu=BigInt(1),Zp=BigInt(2);function wo(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function bo(i){if(!wo(i))throw new Error("Uint8Array expected")}function Gs(i,e){if(typeof e!="boolean")throw new Error(i+" boolean expected, got "+e)}const Qp=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function vo(i){bo(i);let e="";for(let t=0;t<i.length;t++)e+=Qp[i[t]];return e}function tu(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);return i===""?mo:BigInt("0x"+i)}const St={_0:48,_9:57,A:65,F:70,a:97,f:102};function ha(i){if(i>=St._0&&i<=St._9)return i-St._0;if(i>=St.A&&i<=St.F)return i-(St.A-10);if(i>=St.a&&i<=St.f)return i-(St.a-10)}function iu(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);const e=i.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const o=ha(i.charCodeAt(n)),a=ha(i.charCodeAt(n+1));if(o===void 0||a===void 0){const c=i[n]+i[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[s]=o*16+a}return r}function Xp(i){return tu(vo(i))}function rs(i){return bo(i),tu(vo(Uint8Array.from(i).reverse()))}function ru(i,e){return iu(i.toString(16).padStart(e*2,"0"))}function jn(i,e){return ru(i,e).reverse()}function Pt(i,e,t){let r;if(typeof e=="string")try{r=iu(e)}catch(n){throw new Error(i+" must be hex string or Uint8Array, cause: "+n)}else if(wo(e))r=Uint8Array.from(e);else throw new Error(i+" must be hex string or Uint8Array");const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(i+" of length "+t+" expected, got "+s);return r}function ua(...i){let e=0;for(let r=0;r<i.length;r++){const s=i[r];bo(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<i.length;r++){const n=i[r];t.set(n,s),s+=n.length}return t}const Ys=i=>typeof i=="bigint"&&mo<=i;function ef(i,e,t){return Ys(i)&&Ys(e)&&Ys(t)&&e<=i&&i<t}function ar(i,e,t,r){if(!ef(e,t,r))throw new Error("expected valid "+i+": "+t+" <= n < "+r+", got "+e)}function tf(i){let e;for(e=0;i>mo;i>>=eu,e+=1);return e}const rf=i=>(Zp<<BigInt(i-1))-eu,sf={bigint:i=>typeof i=="bigint",function:i=>typeof i=="function",boolean:i=>typeof i=="boolean",string:i=>typeof i=="string",stringOrUint8Array:i=>typeof i=="string"||wo(i),isSafeInteger:i=>Number.isSafeInteger(i),array:i=>Array.isArray(i),field:(i,e)=>e.Fp.isValid(i),hash:i=>typeof i=="function"&&Number.isSafeInteger(i.outputLen)};function Eo(i,e,t={}){const r=(s,n,o)=>{const a=sf[n];if(typeof a!="function")throw new Error("invalid validator function");const c=i[s];if(!(o&&c===void 0)&&!a(c,i))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))r(s,n,!1);for(const[s,n]of Object.entries(t))r(s,n,!0);return i}function la(i){const e=new WeakMap;return(t,...r)=>{const s=e.get(t);if(s!==void 0)return s;const n=i(t,...r);return e.set(t,n),n}}const ve=BigInt(0),he=BigInt(1),ii=BigInt(2),nf=BigInt(3),Un=BigInt(4),da=BigInt(5),pa=BigInt(8);function fe(i,e){const t=i%e;return t>=ve?t:e+t}function of(i,e,t){if(e<ve)throw new Error("invalid exponent, negatives unsupported");if(t<=ve)throw new Error("invalid modulus");if(t===he)return ve;let r=he;for(;e>ve;)e&he&&(r=r*i%t),i=i*i%t,e>>=he;return r}function ft(i,e,t){let r=i;for(;e-- >ve;)r*=r,r%=t;return r}function fa(i,e){if(i===ve)throw new Error("invert: expected non-zero number");if(e<=ve)throw new Error("invert: expected positive modulus, got "+e);let t=fe(i,e),r=e,s=ve,n=he;for(;t!==ve;){const o=r/t,a=r%t,c=s-n*o;r=t,t=a,s=n,n=c}if(r!==he)throw new Error("invert: does not exist");return fe(s,e)}function af(i){const e=(i-he)/ii;let t,r,s;for(t=i-he,r=0;t%ii===ve;t/=ii,r++);for(s=ii;s<i&&of(s,e,i)!==i-he;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(i+he)/Un;return function(a,c){const h=a.pow(c,o);if(!a.eql(a.sqr(h),c))throw new Error("Cannot find square root");return h}}const n=(t+he)/ii;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,h=o.pow(o.mul(o.ONE,s),t),u=o.pow(a,n),l=o.pow(a,t);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(l);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(h,he<<BigInt(c-d-1));h=o.sqr(f),u=o.mul(u,f),l=o.mul(l,h),c=d}return u}}function cf(i){if(i%Un===nf){const e=(i+he)/Un;return function(t,r){const s=t.pow(r,e);if(!t.eql(t.sqr(s),r))throw new Error("Cannot find square root");return s}}if(i%pa===da){const e=(i-da)/pa;return function(t,r){const s=t.mul(r,ii),n=t.pow(s,e),o=t.mul(r,n),a=t.mul(t.mul(o,ii),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),r))throw new Error("Cannot find square root");return c}}return af(i)}const hf=(i,e)=>(fe(i,e)&he)===he,uf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function lf(i){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=uf.reduce((r,s)=>(r[s]="function",r),e);return Eo(i,t)}function df(i,e,t){if(t<ve)throw new Error("invalid exponent, negatives unsupported");if(t===ve)return i.ONE;if(t===he)return e;let r=i.ONE,s=e;for(;t>ve;)t&he&&(r=i.mul(r,s)),s=i.sqr(s),t>>=he;return r}function pf(i,e){const t=new Array(e.length),r=e.reduce((n,o,a)=>i.is0(o)?n:(t[a]=n,i.mul(n,o)),i.ONE),s=i.inv(r);return e.reduceRight((n,o,a)=>i.is0(o)?n:(t[a]=i.mul(n,t[a]),i.mul(n,o)),s),t}function su(i,e){const t=e!==void 0?e:i.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function nu(i,e,t=!1,r={}){if(i<=ve)throw new Error("invalid field: expected ORDER > 0, got "+i);const{nBitLength:s,nByteLength:n}=su(i,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:i,isLE:t,BITS:s,BYTES:n,MASK:rf(s),ZERO:ve,ONE:he,create:c=>fe(c,i),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ve<=c&&c<i},is0:c=>c===ve,isOdd:c=>(c&he)===he,neg:c=>fe(-c,i),eql:(c,h)=>c===h,sqr:c=>fe(c*c,i),add:(c,h)=>fe(c+h,i),sub:(c,h)=>fe(c-h,i),mul:(c,h)=>fe(c*h,i),pow:(c,h)=>df(a,c,h),div:(c,h)=>fe(c*fa(h,i),i),sqrN:c=>c*c,addN:(c,h)=>c+h,subN:(c,h)=>c-h,mulN:(c,h)=>c*h,inv:c=>fa(c,i),sqrt:r.sqrt||(c=>(o||(o=cf(i)),o(a,c))),invertBatch:c=>pf(a,c),cmov:(c,h,u)=>u?h:c,toBytes:c=>t?jn(c,n):ru(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?rs(c):Xp(c)}});return Object.freeze(a)}const ga=BigInt(0),zr=BigInt(1);function Js(i,e){const t=e.negate();return i?t:e}function ou(i,e){if(!Number.isSafeInteger(i)||i<=0||i>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+i)}function Zs(i,e){ou(i,e);const t=Math.ceil(e/i)+1,r=2**(i-1);return{windows:t,windowSize:r}}function ff(i,e){if(!Array.isArray(i))throw new Error("array expected");i.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function gf(i,e){if(!Array.isArray(i))throw new Error("array of scalars expected");i.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const Qs=new WeakMap,au=new WeakMap;function Xs(i){return au.get(i)||1}function yf(i,e){return{constTimeNegate:Js,hasPrecomputes(t){return Xs(t)!==1},unsafeLadder(t,r,s=i.ZERO){let n=t;for(;r>ga;)r&zr&&(s=s.add(n)),n=n.double(),r>>=zr;return s},precomputeWindow(t,r){const{windows:s,windowSize:n}=Zs(r,e),o=[];let a=t,c=a;for(let h=0;h<s;h++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,r,s){const{windows:n,windowSize:o}=Zs(t,e);let a=i.ZERO,c=i.BASE;const h=BigInt(2**t-1),u=2**t,l=BigInt(t);for(let d=0;d<n;d++){const f=d*o;let p=Number(s&h);s>>=l,p>o&&(p-=u,s+=zr);const g=f,y=f+Math.abs(p)-1,v=d%2!==0,m=p<0;p===0?c=c.add(Js(v,r[g])):a=a.add(Js(m,r[y]))}return{p:a,f:c}},wNAFUnsafe(t,r,s,n=i.ZERO){const{windows:o,windowSize:a}=Zs(t,e),c=BigInt(2**t-1),h=2**t,u=BigInt(t);for(let l=0;l<o;l++){const d=l*a;if(s===ga)break;let f=Number(s&c);if(s>>=u,f>a&&(f-=h,s+=zr),f===0)continue;let p=r[d+Math.abs(f)-1];f<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(t,r,s){let n=Qs.get(r);return n||(n=this.precomputeWindow(r,t),t!==1&&Qs.set(r,s(n))),n},wNAFCached(t,r,s){const n=Xs(t);return this.wNAF(n,this.getPrecomputes(n,t,s),r)},wNAFCachedUnsafe(t,r,s,n){const o=Xs(t);return o===1?this.unsafeLadder(t,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),r,n)},setWindowSize(t,r){ou(r,e),au.set(t,r),Qs.delete(t)}}}function mf(i,e,t,r){if(ff(t,i),gf(r,e),t.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const s=i.ZERO,n=tf(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),h=Math.floor((e.BITS-1)/o)*o;let u=s;for(let l=h;l>=0;l-=o){c.fill(s);for(let f=0;f<r.length;f++){const p=r[f],g=Number(p>>BigInt(l)&BigInt(a));c[g]=c[g].add(t[f])}let d=s;for(let f=c.length-1,p=s;f>0;f--)p=p.add(c[f]),d=d.add(p);if(u=u.add(d),l!==0)for(let f=0;f<o;f++)u=u.double()}return u}function wf(i){return lf(i.Fp),Eo(i,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...su(i.n,i.nBitLength),...i,p:i.Fp.ORDER})}const ot=BigInt(0),qe=BigInt(1),Hr=BigInt(2),bf=BigInt(8),vf={zip215:!0};function Ef(i){const e=wf(i);return Eo(i,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function _f(i){const e=Ef(i),{Fp:t,n:r,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,h=Hr<<BigInt(a*8)-qe,u=t.create,l=nu(e.n,e.nBitLength),d=e.uvRatio||((S,E)=>{try{return{isValid:!0,value:t.sqrt(S*t.inv(E))}}catch{return{isValid:!1,value:ot}}}),f=e.adjustScalarBytes||(S=>S),p=e.domain||((S,E,C)=>{if(Gs("phflag",C),E.length||C)throw new Error("Contexts/pre-hash are not supported");return S});function g(S,E){ar("coordinate "+S,E,ot,h)}function y(S){if(!(S instanceof b))throw new Error("ExtendedPoint expected")}const v=la((S,E)=>{const{ex:C,ey:x,ez:O}=S,N=S.is0();E==null&&(E=N?bf:t.inv(O));const B=u(C*E),L=u(x*E),M=u(O*E);if(N)return{x:ot,y:qe};if(M!==qe)throw new Error("invZ was invalid");return{x:B,y:L}}),m=la(S=>{const{a:E,d:C}=e;if(S.is0())throw new Error("bad point: ZERO");const{ex:x,ey:O,ez:N,et:B}=S,L=u(x*x),M=u(O*O),z=u(N*N),K=u(z*z),V=u(L*E),oe=u(z*u(V+M)),te=u(K+u(C*u(L*M)));if(oe!==te)throw new Error("bad point: equation left != right (1)");const J=u(x*O),xe=u(N*B);if(J!==xe)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(E,C,x,O){this.ex=E,this.ey=C,this.ez=x,this.et=O,g("x",E),g("y",C),g("z",x),g("t",O),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(E){if(E instanceof b)throw new Error("extended point not allowed");const{x:C,y:x}=E||{};return g("x",C),g("y",x),new b(C,x,qe,u(C*x))}static normalizeZ(E){const C=t.invertBatch(E.map(x=>x.ez));return E.map((x,O)=>x.toAffine(C[O])).map(b.fromAffine)}static msm(E,C){return mf(b,l,E,C)}_setWindowSize(E){w.setWindowSize(this,E)}assertValidity(){m(this)}equals(E){y(E);const{ex:C,ey:x,ez:O}=this,{ex:N,ey:B,ez:L}=E,M=u(C*L),z=u(N*O),K=u(x*L),V=u(B*O);return M===z&&K===V}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:E}=e,{ex:C,ey:x,ez:O}=this,N=u(C*C),B=u(x*x),L=u(Hr*u(O*O)),M=u(E*N),z=C+x,K=u(u(z*z)-N-B),V=M+B,oe=V-L,te=M-B,J=u(K*oe),xe=u(V*te),Ie=u(K*te),Te=u(oe*V);return new b(J,xe,Te,Ie)}add(E){y(E);const{a:C,d:x}=e,{ex:O,ey:N,ez:B,et:L}=this,{ex:M,ey:z,ez:K,et:V}=E;if(C===BigInt(-1)){const Fo=u((N-O)*(z+M)),Bo=u((N+O)*(z-M)),Fs=u(Bo-Fo);if(Fs===ot)return this.double();const Lo=u(B*Hr*V),ko=u(L*Hr*K),Mo=ko+Lo,zo=Bo+Fo,Ho=ko-Lo,od=u(Mo*Fs),ad=u(zo*Ho),cd=u(Mo*Ho),hd=u(Fs*zo);return new b(od,ad,hd,cd)}const oe=u(O*M),te=u(N*z),J=u(L*x*V),xe=u(B*K),Ie=u((O+N)*(M+z)-oe-te),Te=xe-J,Ze=xe+J,Dt=u(te-C*oe),bi=u(Ie*Te),rd=u(Ze*Dt),sd=u(Ie*Dt),nd=u(Te*Ze);return new b(bi,rd,nd,sd)}subtract(E){return this.add(E.negate())}wNAF(E){return w.wNAFCached(this,E,b.normalizeZ)}multiply(E){const C=E;ar("scalar",C,qe,r);const{p:x,f:O}=this.wNAF(C);return b.normalizeZ([x,O])[0]}multiplyUnsafe(E,C=b.ZERO){const x=E;return ar("scalar",x,ot,r),x===ot?A:this.is0()||x===qe?this:w.wNAFCachedUnsafe(this,x,b.normalizeZ,C)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return w.unsafeLadder(this,r).is0()}toAffine(E){return v(this,E)}clearCofactor(){const{h:E}=e;return E===qe?this:this.multiplyUnsafe(E)}static fromHex(E,C=!1){const{d:x,a:O}=e,N=t.BYTES;E=Pt("pointHex",E,N),Gs("zip215",C);const B=E.slice(),L=E[N-1];B[N-1]=L&-129;const M=rs(B),z=C?h:t.ORDER;ar("pointHex.y",M,ot,z);const K=u(M*M),V=u(K-qe),oe=u(x*K-O);let{isValid:te,value:J}=d(V,oe);if(!te)throw new Error("Point.fromHex: invalid y coordinate");const xe=(J&qe)===qe,Ie=(L&128)!==0;if(!C&&J===ot&&Ie)throw new Error("Point.fromHex: x=0 and x_0=1");return Ie!==xe&&(J=u(-J)),b.fromAffine({x:J,y:M})}static fromPrivateKey(E){return I(E).point}toRawBytes(){const{x:E,y:C}=this.toAffine(),x=jn(C,t.BYTES);return x[x.length-1]|=E&qe?128:0,x}toHex(){return vo(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,qe,u(e.Gx*e.Gy)),b.ZERO=new b(ot,qe,qe,ot);const{BASE:P,ZERO:A}=b,w=yf(b,a*8);function _(S){return fe(S,r)}function D(S){return _(rs(S))}function I(S){const E=t.BYTES;S=Pt("private key",S,E);const C=Pt("hashed private key",n(S),2*E),x=f(C.slice(0,E)),O=C.slice(E,2*E),N=D(x),B=P.multiply(N),L=B.toRawBytes();return{head:x,prefix:O,scalar:N,point:B,pointBytes:L}}function j(S){return I(S).pointBytes}function R(S=new Uint8Array,...E){const C=ua(...E);return D(n(p(C,Pt("context",S),!!s)))}function U(S,E,C={}){S=Pt("message",S),s&&(S=s(S));const{prefix:x,scalar:O,pointBytes:N}=I(E),B=R(C.context,x,S),L=P.multiply(B).toRawBytes(),M=R(C.context,L,N,S),z=_(B+M*O);ar("signature.s",z,ot,r);const K=ua(L,jn(z,t.BYTES));return Pt("result",K,t.BYTES*2)}const k=vf;function $(S,E,C,x=k){const{context:O,zip215:N}=x,B=t.BYTES;S=Pt("signature",S,2*B),E=Pt("message",E),C=Pt("publicKey",C,B),N!==void 0&&Gs("zip215",N),s&&(E=s(E));const L=rs(S.slice(B,2*B));let M,z,K;try{M=b.fromHex(C,N),z=b.fromHex(S.slice(0,B),N),K=P.multiplyUnsafe(L)}catch{return!1}if(!N&&M.isSmallOrder())return!1;const V=R(O,z.toRawBytes(),M.toRawBytes(),E);return z.add(M.multiplyUnsafe(V)).subtract(K).clearCofactor().equals(b.ZERO)}return P._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:U,verify:$,ExtendedPoint:b,utils:{getExtendedPublicKey:I,randomPrivateKey:()=>o(t.BYTES),precompute(S=8,E=b.BASE){return E._setWindowSize(S),E.multiply(BigInt(3)),E}}}}BigInt(0),BigInt(1);const _o=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ya=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const If=BigInt(1),ma=BigInt(2);BigInt(3);const Df=BigInt(5),$f=BigInt(8);function Sf(i){const e=BigInt(10),t=BigInt(20),r=BigInt(40),s=BigInt(80),n=_o,o=i*i%n*i%n,a=ft(o,ma,n)*o%n,c=ft(a,If,n)*i%n,h=ft(c,Df,n)*c%n,u=ft(h,e,n)*h%n,l=ft(u,t,n)*u%n,d=ft(l,r,n)*l%n,f=ft(d,s,n)*d%n,p=ft(f,s,n)*d%n,g=ft(p,e,n)*h%n;return{pow_p_5_8:ft(g,ma,n)*i%n,b2:o}}function Pf(i){return i[0]&=248,i[31]&=127,i[31]|=64,i}function Of(i,e){const t=_o,r=fe(e*e*e,t),s=fe(r*r*e,t),n=Sf(i*s).pow_p_5_8;let o=fe(i*r*n,t);const a=fe(e*o*o,t),c=o,h=fe(o*ya,t),u=a===i,l=a===fe(-i,t),d=a===fe(-i*ya,t);return u&&(o=c),(l||d)&&(o=h),hf(o,t)&&(o=fe(-o,t)),{isValid:u||l,value:o}}const Cf=nu(_o,void 0,!0),Af={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Cf,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:$f,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Jp,randomBytes:Qh,adjustScalarBytes:Pf,uvRatio:Of},cu=_f(Af),xf="EdDSA",Nf="JWT",us=".",Es="base64url",hu="utf8",uu="utf8",Tf=":",Rf="did",jf="key",wa="base58btc",Uf="z",qf="K36",Ff=32;function Io(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function lu(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Io(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function du(i,e){e||(e=i.reduce((s,n)=>s+n.length,0));const t=lu(e);let r=0;for(const s of i)t.set(s,r),r+=s.length;return Io(t)}function Bf(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var n=i.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=i.length,c=i.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,v=0,m=p.length;v!==m&&p[v]===0;)v++,g++;for(var b=(m-v)*u+1>>>0,P=new Uint8Array(b);v!==m;){for(var A=p[v],w=0,_=b-1;(A!==0||w<y)&&_!==-1;_--,w++)A+=256*P[_]>>>0,P[_]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");y=w,v++}for(var D=b-y;D!==b&&P[D]===0;)D++;for(var I=c.repeat(g);D<b;++D)I+=i.charAt(P[D]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,v=0;p[g]===c;)y++,g++;for(var m=(p.length-g)*h+1>>>0,b=new Uint8Array(m);p[g];){var P=t[p.charCodeAt(g)];if(P===255)return;for(var A=0,w=m-1;(P!==0||A<v)&&w!==-1;w--,A++)P+=a*b[w]>>>0,b[w]=P%256>>>0,P=P/256>>>0;if(P!==0)throw new Error("Non-zero carry");v=A,g++}if(p[g]!==" "){for(var _=m-v;_!==m&&b[_]===0;)_++;for(var D=new Uint8Array(y+(m-_)),I=y;_!==m;)D[I++]=b[_++];return D}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:d,decode:f}}var Lf=Bf,kf=Lf;const pu=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Mf=i=>new TextEncoder().encode(i),zf=i=>new TextDecoder().decode(i);let Hf=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Vf=class{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return fu(this,e)}},Kf=class{constructor(e){this.decoders=e}or(e){return fu(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const fu=(i,e)=>new Kf({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});let Wf=class{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Hf(e,t,r),this.decoder=new Vf(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const _s=({name:i,prefix:e,encode:t,decode:r})=>new Wf(i,e,t,r),xr=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=kf(t,e);return _s({prefix:i,name:e,encode:r,decode:n=>pu(s(n))})},Gf=(i,e,t,r)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=i.length;for(;i[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,h=0;for(let u=0;u<n;++u){const l=s[i[u]];if(l===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Yf=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<i.length;++c)for(a=a<<8|i[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),r)for(;n.length*t&7;)n+="=";return n},Oe=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>_s({prefix:e,name:i,encode(s){return Yf(s,r,t)},decode(s){return Gf(s,r,t,i)}}),Jf=_s({prefix:"\0",name:"identity",encode:i=>zf(i),decode:i=>Mf(i)});var Zf=Object.freeze({__proto__:null,identity:Jf});const Qf=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Xf=Object.freeze({__proto__:null,base2:Qf});const eg=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var tg=Object.freeze({__proto__:null,base8:eg});const ig=xr({prefix:"9",name:"base10",alphabet:"0123456789"});var rg=Object.freeze({__proto__:null,base10:ig});const sg=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ng=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var og=Object.freeze({__proto__:null,base16:sg,base16upper:ng});const ag=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),cg=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),hg=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ug=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),lg=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),dg=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pg=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fg=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),gg=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var yg=Object.freeze({__proto__:null,base32:ag,base32upper:cg,base32pad:hg,base32padupper:ug,base32hex:lg,base32hexupper:dg,base32hexpad:pg,base32hexpadupper:fg,base32z:gg});const mg=xr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wg=xr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var bg=Object.freeze({__proto__:null,base36:mg,base36upper:wg});const vg=xr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Eg=xr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var _g=Object.freeze({__proto__:null,base58btc:vg,base58flickr:Eg});const Ig=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dg=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$g=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Sg=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Pg=Object.freeze({__proto__:null,base64:Ig,base64pad:Dg,base64url:$g,base64urlpad:Sg});const gu=Array.from(""),Og=gu.reduce((i,e,t)=>(i[t]=e,i),[]),Cg=gu.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function Ag(i){return i.reduce((e,t)=>(e+=Og[t],e),"")}function xg(i){const e=[];for(const t of i){const r=Cg[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const Ng=_s({prefix:"",name:"base256emoji",encode:Ag,decode:xg});var Tg=Object.freeze({__proto__:null,base256emoji:Ng}),Rg=yu,ba=128,jg=-128,Ug=Math.pow(2,31);function yu(i,e,t){e=e||[],t=t||0;for(var r=t;i>=Ug;)e[t++]=i&255|ba,i/=128;for(;i&jg;)e[t++]=i&255|ba,i>>>=7;return e[t]=i|0,yu.bytes=t-r+1,e}var qg=qn,Fg=128,va=127;function qn(i,r){var t=0,r=r||0,s=0,n=r,o,a=i.length;do{if(n>=a)throw qn.bytes=0,new RangeError("Could not decode varint");o=i[n++],t+=s<28?(o&va)<<s:(o&va)*Math.pow(2,s),s+=7}while(o>=Fg);return qn.bytes=n-r,t}var Bg=Math.pow(2,7),Lg=Math.pow(2,14),kg=Math.pow(2,21),Mg=Math.pow(2,28),zg=Math.pow(2,35),Hg=Math.pow(2,42),Vg=Math.pow(2,49),Kg=Math.pow(2,56),Wg=Math.pow(2,63),Gg=function(i){return i<Bg?1:i<Lg?2:i<kg?3:i<Mg?4:i<zg?5:i<Hg?6:i<Vg?7:i<Kg?8:i<Wg?9:10},Yg={encode:Rg,decode:qg,encodingLength:Gg},mu=Yg;const Ea=(i,e,t=0)=>(mu.encode(i,e,t),e),_a=i=>mu.encodingLength(i),Fn=(i,e)=>{const t=e.byteLength,r=_a(i),s=r+_a(t),n=new Uint8Array(s+t);return Ea(i,n,0),Ea(t,n,r),n.set(e,s),new Jg(i,t,e,n)};let Jg=class{constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}};const wu=({name:i,code:e,encode:t})=>new Zg(i,e,t);let Zg=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Fn(this.code,t):t.then(r=>Fn(this.code,r))}else throw Error("Unknown type, must be binary type")}};const bu=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),Qg=wu({name:"sha2-256",code:18,encode:bu("SHA-256")}),Xg=wu({name:"sha2-512",code:19,encode:bu("SHA-512")});var ey=Object.freeze({__proto__:null,sha256:Qg,sha512:Xg});const vu=0,ty="identity",Eu=pu,iy=i=>Fn(vu,Eu(i)),ry={code:vu,name:ty,encode:Eu,digest:iy};var sy=Object.freeze({__proto__:null,identity:ry});new TextEncoder,new TextDecoder;const Ia={...Zf,...Xf,...tg,...rg,...og,...yg,...bg,..._g,...Pg,...Tg};({...ey,...sy});function _u(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const Da=_u("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),en=_u("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=lu(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Iu={utf8:Da,"utf-8":Da,hex:Ia.base16,latin1:en,ascii:en,binary:en,...Ia};function Is(i,e="utf8"){const t=Iu[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}function Xi(i,e="utf8"){const t=Iu[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Io(globalThis.Buffer.from(i,"utf-8")):t.decoder.decode(`${t.prefix}${i}`)}function $a(i){return ui(Is(Xi(i,Es),hu))}function ls(i){return Is(Xi(qt(i),hu),Es)}function Du(i){const e=Xi(qf,wa),t=Uf+Is(du([e,i]),wa);return[Rf,jf,t].join(Tf)}function ny(i){return Is(i,Es)}function oy(i){return Xi(i,Es)}function ay(i){return Xi([ls(i.header),ls(i.payload)].join(us),uu)}function cy(i){return[ls(i.header),ls(i.payload),ny(i.signature)].join(us)}function Bn(i){const e=i.split(us),t=$a(e[0]),r=$a(e[1]),s=oy(e[2]),n=Xi(e.slice(0,2).join(us),uu);return{header:t,payload:r,signature:s,data:n}}function Sa(i=Qh(Ff)){const e=cu.getPublicKey(i);return{secretKey:du([i,e]),publicKey:e}}async function hy(i,e,t,r,s=q.fromMiliseconds(Date.now())){const n={alg:xf,typ:Nf},o=Du(r.publicKey),a=s+t,c={iss:o,sub:i,aud:e,iat:s,exp:a},h=ay({header:n,payload:c}),u=cu.sign(h,r.secretKey.slice(0,32));return cy({header:n,payload:c,signature:u})}function $u(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function mr(i,e){e||(e=i.reduce((s,n)=>s+n.length,0));const t=$u(e);let r=0;for(const s of i)t.set(s,r),r+=s.length;return t}function uy(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var n=i.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=i.length,c=i.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,v=0,m=p.length;v!==m&&p[v]===0;)v++,g++;for(var b=(m-v)*u+1>>>0,P=new Uint8Array(b);v!==m;){for(var A=p[v],w=0,_=b-1;(A!==0||w<y)&&_!==-1;_--,w++)A+=256*P[_]>>>0,P[_]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");y=w,v++}for(var D=b-y;D!==b&&P[D]===0;)D++;for(var I=c.repeat(g);D<b;++D)I+=i.charAt(P[D]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,v=0;p[g]===c;)y++,g++;for(var m=(p.length-g)*h+1>>>0,b=new Uint8Array(m);p[g];){var P=t[p.charCodeAt(g)];if(P===255)return;for(var A=0,w=m-1;(P!==0||A<v)&&w!==-1;w--,A++)P+=a*b[w]>>>0,b[w]=P%256>>>0,P=P/256>>>0;if(P!==0)throw new Error("Non-zero carry");v=A,g++}if(p[g]!==" "){for(var _=m-v;_!==m&&b[_]===0;)_++;for(var D=new Uint8Array(y+(m-_)),I=y;_!==m;)D[I++]=b[_++];return D}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:d,decode:f}}var ly=uy,dy=ly;const py=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},fy=i=>new TextEncoder().encode(i),gy=i=>new TextDecoder().decode(i);class yy{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class my{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Su(this,e)}}class wy{constructor(e){this.decoders=e}or(e){return Su(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Su=(i,e)=>new wy({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class by{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new yy(e,t,r),this.decoder=new my(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ds=({name:i,prefix:e,encode:t,decode:r})=>new by(i,e,t,r),Nr=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=dy(t,e);return Ds({prefix:i,name:e,encode:r,decode:n=>py(s(n))})},vy=(i,e,t,r)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=i.length;for(;i[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,h=0;for(let u=0;u<n;++u){const l=s[i[u]];if(l===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Ey=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<i.length;++c)for(a=a<<8|i[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),r)for(;n.length*t&7;)n+="=";return n},Ce=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>Ds({prefix:e,name:i,encode(s){return Ey(s,r,t)},decode(s){return vy(s,r,t,i)}}),_y=Ds({prefix:"\0",name:"identity",encode:i=>gy(i),decode:i=>fy(i)}),Iy=Object.freeze(Object.defineProperty({__proto__:null,identity:_y},Symbol.toStringTag,{value:"Module"})),Dy=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),$y=Object.freeze(Object.defineProperty({__proto__:null,base2:Dy},Symbol.toStringTag,{value:"Module"})),Sy=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Py=Object.freeze(Object.defineProperty({__proto__:null,base8:Sy},Symbol.toStringTag,{value:"Module"})),Oy=Nr({prefix:"9",name:"base10",alphabet:"0123456789"}),Cy=Object.freeze(Object.defineProperty({__proto__:null,base10:Oy},Symbol.toStringTag,{value:"Module"})),Ay=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xy=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ny=Object.freeze(Object.defineProperty({__proto__:null,base16:Ay,base16upper:xy},Symbol.toStringTag,{value:"Module"})),Ty=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ry=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),jy=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Uy=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),qy=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Fy=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),By=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ly=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ky=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),My=Object.freeze(Object.defineProperty({__proto__:null,base32:Ty,base32hex:qy,base32hexpad:By,base32hexpadupper:Ly,base32hexupper:Fy,base32pad:jy,base32padupper:Uy,base32upper:Ry,base32z:ky},Symbol.toStringTag,{value:"Module"})),zy=Nr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Hy=Nr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Vy=Object.freeze(Object.defineProperty({__proto__:null,base36:zy,base36upper:Hy},Symbol.toStringTag,{value:"Module"})),Ky=Nr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Wy=Nr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Gy=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ky,base58flickr:Wy},Symbol.toStringTag,{value:"Module"})),Yy=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Jy=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Zy=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Qy=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Xy=Object.freeze(Object.defineProperty({__proto__:null,base64:Yy,base64pad:Jy,base64url:Zy,base64urlpad:Qy},Symbol.toStringTag,{value:"Module"})),Pu=Array.from(""),em=Pu.reduce((i,e,t)=>(i[t]=e,i),[]),tm=Pu.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function im(i){return i.reduce((e,t)=>(e+=em[t],e),"")}function rm(i){const e=[];for(const t of i){const r=tm[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const sm=Ds({prefix:"",name:"base256emoji",encode:im,decode:rm}),nm=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:sm},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Pa={...Iy,...$y,...Py,...Cy,...Ny,...My,...Vy,...Gy,...Xy,...nm};function Ou(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const Oa=Ou("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),tn=Ou("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=$u(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Cu={utf8:Oa,"utf-8":Oa,hex:Pa.base16,latin1:tn,ascii:tn,binary:tn,...Pa};function it(i,e="utf8"){const t=Cu[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}function Me(i,e="utf8"){const t=Cu[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}const om={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var am={};const cm=":";function zi(i){const[e,t]=i.split(cm);return{namespace:e,reference:t}}function Ca(i,e=[]){const t=[];return Object.keys(i).forEach(r=>{if(e.length&&!e.includes(r))return;const s=i[r];t.push(...s.accounts)}),t}function Au(i,e){return i.includes(":")?[i]:e.chains||[]}var hm=Object.defineProperty,um=Object.defineProperties,lm=Object.getOwnPropertyDescriptors,Aa=Object.getOwnPropertySymbols,dm=Object.prototype.hasOwnProperty,pm=Object.prototype.propertyIsEnumerable,xa=(i,e,t)=>e in i?hm(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Na=(i,e)=>{for(var t in e||(e={}))dm.call(e,t)&&xa(i,t,e[t]);if(Aa)for(var t of Aa(e))pm.call(e,t)&&xa(i,t,e[t]);return i},fm=(i,e)=>um(i,lm(e));const gm="ReactNative",Ye={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},ym="js";function ds(){return typeof Kt<"u"&&typeof Kt.versions<"u"&&typeof Kt.versions.node<"u"}function Yt(){return!Ut.getDocument()&&!!Ut.getNavigator()&&navigator.product===gm}function mm(){return Yt()&&typeof H<"u"&&typeof(H==null?void 0:H.Platform)<"u"&&(H==null?void 0:H.Platform.OS)==="android"}function wm(){return Yt()&&typeof H<"u"&&typeof(H==null?void 0:H.Platform)<"u"&&(H==null?void 0:H.Platform.OS)==="ios"}function er(){return!ds()&&!!Ut.getNavigator()&&!!Ut.getDocument()}function Tr(){return Yt()?Ye.reactNative:ds()?Ye.node:er()?Ye.browser:Ye.unknown}function Ta(){var i;try{return Yt()&&typeof H<"u"&&typeof(H==null?void 0:H.Application)<"u"?(i=H.Application)==null?void 0:i.applicationId:void 0}catch{return}}function bm(i,e){const t=new URLSearchParams(i);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const s=e[r];s!==void 0&&t.set(r,s)}return t.toString()}function vm(i){var e,t;const r=xu();try{return i!=null&&i.url&&r.url&&new URL(i.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${i.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),i.url=r.url),(e=i?.icons)!=null&&e.length&&i.icons.length>0&&(i.icons=i.icons.filter(s=>s!=="")),fm(Na(Na({},r),i),{url:i?.url||r.url,name:i?.name||r.name,description:i?.description||r.description,icons:(t=i?.icons)!=null&&t.length&&i.icons.length>0?i.icons:r.icons})}catch(s){return console.warn("Error populating app metadata",s),i||r}}function xu(){return Yd.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Em(){if(Tr()===Ye.reactNative&&typeof H<"u"&&typeof(H==null?void 0:H.Platform)<"u"){const{OS:t,Version:r}=H.Platform;return[t,r].join("-")}const i=dd();if(i===null)return"unknown";const e=i.os?i.os.replace(" ","").toLowerCase():"unknown";return i.type==="browser"?[e,i.name,i.version].join("-"):[e,i.version].join("-")}function _m(){var i;const e=Tr();return e===Ye.browser?[e,((i=Ut.getLocation())==null?void 0:i.host)||"unknown"].join(":"):e}function Nu(i,e,t){const r=Em(),s=_m();return[[i,e].join("-"),[ym,t].join("-"),r,s].join("/")}function Im({protocol:i,version:e,relayUrl:t,sdkVersion:r,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const h=t.split("?"),u=Nu(i,e,r),l={auth:s,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=bm(h[1]||"",l);return h[0]+"?"+d}function oi(i,e){return i.filter(t=>e.includes(t)).length===i.length}function Ln(i){return Object.fromEntries(i.entries())}function kn(i){return new Map(Object.entries(i))}function ei(i=q.FIVE_MINUTES,e){const t=q.toMiliseconds(i||q.FIVE_MINUTES);let r,s,n,o;return{resolve:a=>{n&&r&&(clearTimeout(n),r(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const h=new Error(e);o=Promise.reject(h),c(h)},t),r=a,s=c})}}function Ht(i,e,t){return new Promise(async(r,s)=>{const n=setTimeout(()=>s(new Error(t)),e);try{const o=await i;r(o)}catch(o){s(o)}clearTimeout(n)})}function Tu(i,e){if(typeof e=="string"&&e.startsWith(`${i}:`))return e;if(i.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(i.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${i}`)}function Dm(i){return Tu("topic",i)}function $m(i){return Tu("id",i)}function Ru(i){const[e,t]=i.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")r.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return r}function pe(i,e){return q.fromMiliseconds(Date.now()+q.toMiliseconds(i))}function Mt(i){return Date.now()>=q.toMiliseconds(i)}function ee(i,e){return`${i}${e?`:${e}`:""}`}function _t(i=[],e=[]){return[...new Set([...i,...e])]}async function Sm({id:i,topic:e,wcDeepLink:t}){var r;try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t,n=s?.href;if(typeof n!="string")return;const o=Pm(n,i,e),a=Tr();if(a===Ye.browser){if(!((r=Ut.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Om(o)}else a===Ye.reactNative&&typeof(H==null?void 0:H.Linking)<"u"&&await H.Linking.openURL(o)}catch(s){console.error(s)}}function Pm(i,e,t){const r=`requestId=${e}&sessionTopic=${t}`;i.endsWith("/")&&(i=i.slice(0,-1));let s=`${i}`;if(i.startsWith("https://t.me")){const n=i.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${Nm(r,!0)}`}else s=`${s}/wc?${r}`;return s}function Om(i){let e="_self";xm()?e="_top":(Am()||i.startsWith("https://")||i.startsWith("http://"))&&(e="_blank"),window.open(i,e,"noreferrer noopener")}async function Cm(i,e){let t="";try{if(er()&&(t=localStorage.getItem(e),t))return t;t=await i.getItem(e)}catch(r){console.error(r)}return t}function Ra(i,e){if(!i.includes(e))return null;const t=i.split(/([&,?,=])/),r=t.indexOf(e);return t[r+2]}function ja(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,i=>{const e=Math.random()*16|0;return(i==="x"?e:e&3|8).toString(16)})}function Do(){return typeof Kt<"u"&&am.IS_VITEST==="true"}function Am(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function xm(){try{return window.self!==window.top}catch{return!1}}function Nm(i,e=!1){const t=_e.from(i).toString("base64");return e?t.replace(/[=]/g,""):t}function ju(i){return _e.from(i,"base64").toString("utf-8")}function Tm(i){return new Promise(e=>setTimeout(e,i))}function Dr(i){if(!Number.isSafeInteger(i)||i<0)throw new Error("positive integer expected, got "+i)}function Rm(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Rr(i,...e){if(!Rm(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error("Uint8Array expected of length "+e+", got length="+i.length)}function $o(i){if(typeof i!="function"||typeof i.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Dr(i.outputLen),Dr(i.blockLen)}function Hi(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Uu(i,e){Rr(i);const t=e.outputLen;if(i.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Vr=BigInt(2**32-1),Ua=BigInt(32);function jm(i,e=!1){return e?{h:Number(i&Vr),l:Number(i>>Ua&Vr)}:{h:Number(i>>Ua&Vr)|0,l:Number(i&Vr)|0}}function Um(i,e=!1){let t=new Uint32Array(i.length),r=new Uint32Array(i.length);for(let s=0;s<i.length;s++){const{h:n,l:o}=jm(i[s],e);[t[s],r[s]]=[n,o]}return[t,r]}const qm=(i,e,t)=>i<<t|e>>>32-t,Fm=(i,e,t)=>e<<t|i>>>32-t,Bm=(i,e,t)=>e<<t-32|i>>>64-t,Lm=(i,e,t)=>i<<t-32|e>>>64-t,Ii=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function km(i){return new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4))}function rn(i){return new DataView(i.buffer,i.byteOffset,i.byteLength)}function gt(i,e){return i<<32-e|i>>>e}const qa=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Mm(i){return i<<24&4278190080|i<<8&16711680|i>>>8&65280|i>>>24&255}function Fa(i){for(let e=0;e<i.length;e++)i[e]=Mm(i[e])}function zm(i){if(typeof i!="string")throw new Error("utf8ToBytes expected string, got "+typeof i);return new Uint8Array(new TextEncoder().encode(i))}function Vi(i){return typeof i=="string"&&(i=zm(i)),Rr(i),i}function Hm(...i){let e=0;for(let r=0;r<i.length;r++){const s=i[r];Rr(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<i.length;r++){const n=i[r];t.set(n,s),s+=n.length}return t}let So=class{clone(){return this._cloneInto()}};function qu(i){const e=r=>i().update(Vi(r)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function tr(i=32){if(Ii&&typeof Ii.getRandomValues=="function")return Ii.getRandomValues(new Uint8Array(i));if(Ii&&typeof Ii.randomBytes=="function")return Ii.randomBytes(i);throw new Error("crypto.getRandomValues must be defined")}const Fu=[],Bu=[],Lu=[],Vm=BigInt(0),cr=BigInt(1),Km=BigInt(2),Wm=BigInt(7),Gm=BigInt(256),Ym=BigInt(113);for(let i=0,e=cr,t=1,r=0;i<24;i++){[t,r]=[r,(2*t+3*r)%5],Fu.push(2*(5*r+t)),Bu.push((i+1)*(i+2)/2%64);let s=Vm;for(let n=0;n<7;n++)e=(e<<cr^(e>>Wm)*Ym)%Gm,e&Km&&(s^=cr<<(cr<<BigInt(n))-cr);Lu.push(s)}const[Jm,Zm]=Um(Lu,!0),Ba=(i,e,t)=>t>32?Bm(i,e,t):qm(i,e,t),La=(i,e,t)=>t>32?Lm(i,e,t):Fm(i,e,t);function Qm(i,e=24){const t=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)t[o]=i[o]^i[o+10]^i[o+20]^i[o+30]^i[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,h=t[c],u=t[c+1],l=Ba(h,u,1)^t[a],d=La(h,u,1)^t[a+1];for(let f=0;f<50;f+=10)i[o+f]^=l,i[o+f+1]^=d}let s=i[2],n=i[3];for(let o=0;o<24;o++){const a=Bu[o],c=Ba(s,n,a),h=La(s,n,a),u=Fu[o];s=i[u],n=i[u+1],i[u]=c,i[u+1]=h}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=i[o+a];for(let a=0;a<10;a++)i[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}i[0]^=Jm[r],i[1]^=Zm[r]}t.fill(0)}let Xm=class ku extends So{constructor(e,t,r,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Dr(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=km(this.state)}keccak(){qa||Fa(this.state32),Qm(this.state32,this.rounds),qa||Fa(this.state32),this.posOut=0,this.pos=0}update(e){Hi(this);const{blockLen:t,state:r}=this;e=Vi(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(t-this.pos,s-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:s}=this;e[r]^=t,(t&128)!==0&&r===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Hi(this,!1),Rr(e),this.finish();const t=this.state,{blockLen:r}=this;for(let s=0,n=e.length;s<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Dr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Uu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new ku(t,r,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const ew=(i,e,t)=>qu(()=>new Xm(e,i,t)),tw=ew(1,136,256/8),iw="https://rpc.walletconnect.org/v1";function Mu(i){const e=`Ethereum Signed Message:
${i.length}`,t=new TextEncoder().encode(e+i);return"0x"+_e.from(tw(t)).toString("hex")}async function rw(i,e,t,r,s,n){switch(t.t){case"eip191":return await sw(i,e,t.s);case"eip1271":return await nw(i,e,t.s,r,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function sw(i,e,t){return(await pp({hash:Mu(e),signature:t})).toLowerCase()===i.toLowerCase()}async function nw(i,e,t,r,s,n){const o=zi(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",h="0000000000000000000000000000000000000000000000000000000000000041",u=t.substring(2),l=Mu(e).substring(2),d=a+l+c+h+u,f=await fetch(`${n||iw}/?chainId=${r}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:ow(),jsonrpc:"2.0",method:"eth_call",params:[{to:i,data:d},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function ow(){return Date.now()+Math.floor(Math.random()*1e3)}function aw(i){const e=atob(i),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const r=t[0];if(r===0)throw new Error("No signatures found");const s=1+r*64;if(t.length<s)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const n=_e.from(i,"base64").slice(1,65);return yp.encode(n)}var cw=Object.defineProperty,hw=Object.defineProperties,uw=Object.getOwnPropertyDescriptors,ka=Object.getOwnPropertySymbols,lw=Object.prototype.hasOwnProperty,dw=Object.prototype.propertyIsEnumerable,Ma=(i,e,t)=>e in i?cw(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pw=(i,e)=>{for(var t in e||(e={}))lw.call(e,t)&&Ma(i,t,e[t]);if(ka)for(var t of ka(e))dw.call(e,t)&&Ma(i,t,e[t]);return i},fw=(i,e)=>hw(i,uw(e));const gw="did:pkh:",Po=i=>i?.split(":"),yw=i=>{const e=i&&Po(i);if(e)return i.includes(gw)?e[3]:e[1]},Mn=i=>{const e=i&&Po(i);if(e)return e[2]+":"+e[3]},ps=i=>{const e=i&&Po(i);if(e)return e.pop()};async function za(i){const{cacao:e,projectId:t}=i,{s:r,p:s}=e,n=zu(s,s.iss),o=ps(s.iss);return await rw(o,n,r,Mn(s.iss),t)}const zu=(i,e)=>{const t=`${i.domain} wants you to sign in with your Ethereum account:`,r=ps(e);if(!i.aud&&!i.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=i.statement||void 0;const n=`URI: ${i.aud||i.uri}`,o=`Version: ${i.version}`,a=`Chain ID: ${yw(e)}`,c=`Nonce: ${i.nonce}`,h=`Issued At: ${i.iat}`,u=i.exp?`Expiration Time: ${i.exp}`:void 0,l=i.nbf?`Not Before: ${i.nbf}`:void 0,d=i.requestId?`Request ID: ${i.requestId}`:void 0,f=i.resources?`Resources:${i.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=ss(i.resources);if(p){const g=$r(p);s=$w(s,g)}return[t,r,"",s,"",n,o,a,c,h,u,l,d,f].filter(g=>g!=null).join(`
`)};function mw(i){return _e.from(JSON.stringify(i)).toString("base64")}function ww(i){return JSON.parse(_e.from(i,"base64").toString("utf-8"))}function li(i){if(!i)throw new Error("No recap provided, value is undefined");if(!i.att)throw new Error("No `att` property found");const e=Object.keys(i.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const r=i.att[t];if(Array.isArray(r))throw new Error(`Resource must be an object: ${t}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(r).forEach(s=>{const n=r[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function bw(i,e,t,r={}){return t?.sort((s,n)=>s.localeCompare(n)),{att:{[i]:vw(e,t,r)}}}function vw(i,e,t={}){e=e?.sort((s,n)=>s.localeCompare(n));const r=e.map(s=>({[`${i}/${s}`]:[t]}));return Object.assign({},...r)}function Hu(i){return li(i),`urn:recap:${mw(i).replace(/=/g,"")}`}function $r(i){const e=ww(i.replace("urn:recap:",""));return li(e),e}function Ew(i,e,t){const r=bw(i,e,t);return Hu(r)}function _w(i){return i&&i.includes("urn:recap:")}function Iw(i,e){const t=$r(i),r=$r(e),s=Dw(t,r);return Hu(s)}function Dw(i,e){li(i),li(e);const t=Object.keys(i.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),r={att:{}};return t.forEach(s=>{var n,o;Object.keys(((n=i.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,h;r.att[s]=fw(pw({},r.att[s]),{[a]:((c=i.att[s])==null?void 0:c[a])||((h=e.att[s])==null?void 0:h[a])})})}),r}function $w(i="",e){li(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(i.includes(t))return i;const r=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));c.sort((l,d)=>l.action.localeCompare(d.action));const h={};c.forEach(l=>{h[l.ability]||(h[l.ability]=[]),h[l.ability].push(l.action)});const u=Object.keys(h).map(l=>(s++,`(${s}) '${l}': '${h[l].join("', '")}' for '${a}'.`));r.push(u.join(", ").replace(".,","."))});const n=r.join(" "),o=`${t}${n}`;return`${i?i+" ":""}${o}`}function Ha(i){var e;const t=$r(i);li(t);const r=(e=t.att)==null?void 0:e.eip155;return r?Object.keys(r).map(s=>s.split("/")[1]):[]}function Va(i){const e=$r(i);li(e);const t=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(s=>{var n;(n=s?.[0])!=null&&n.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function ss(i){if(!i)return;const e=i?.[i.length-1];return _w(e)?e:void 0}function sn(i){if(!Number.isSafeInteger(i)||i<0)throw new Error("positive integer expected, got "+i)}function Vu(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Ge(i,...e){if(!Vu(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error("Uint8Array expected of length "+e+", got length="+i.length)}function Ka(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Sw(i,e){Ge(i);const t=e.outputLen;if(i.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Wa(i){if(typeof i!="boolean")throw new Error(`boolean expected, not ${i}`)}const Wt=i=>new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4)),Pw=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Ow=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ow)throw new Error("Non little-endian hardware is not supported");function Cw(i){if(typeof i!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(i))}function zn(i){if(typeof i=="string")i=Cw(i);else if(Vu(i))i=Hn(i);else throw new Error("Uint8Array expected, got "+typeof i);return i}function Aw(i,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(i,e)}function xw(i,e){if(i.length!==e.length)return!1;let t=0;for(let r=0;r<i.length;r++)t|=i[r]^e[r];return t===0}const Nw=(i,e)=>{function t(r,...s){if(Ge(r),i.nonceLength!==void 0){const h=s[0];if(!h)throw new Error("nonce / iv required");i.varSizeNonce?Ge(h):Ge(h,i.nonceLength)}const n=i.tagLength;n&&s[1]!==void 0&&Ge(s[1]);const o=e(r,...s),a=(h,u)=>{if(u!==void 0){if(h!==2)throw new Error("cipher output not supported");Ge(u)}};let c=!1;return{encrypt(h,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ge(h),a(o.encrypt.length,u),o.encrypt(h,u)},decrypt(h,u){if(Ge(h),n&&h.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(h,u)}}}return Object.assign(t,i),t};function Ga(i,e,t=!0){if(e===void 0)return new Uint8Array(i);if(e.length!==i)throw new Error("invalid output length, expected "+i+", got: "+e.length);if(t&&!Tw(e))throw new Error("invalid output, must be aligned");return e}function Ya(i,e,t,r){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n);i.setUint32(e+4,o,r),i.setUint32(e+0,a,r)}function Tw(i){return i.byteOffset%4===0}function Hn(i){return Uint8Array.from(i)}function Ki(...i){for(let e=0;e<i.length;e++)i[e].fill(0)}const Ku=i=>Uint8Array.from(i.split("").map(e=>e.charCodeAt(0))),Rw=Ku("expand 16-byte k"),jw=Ku("expand 32-byte k"),Uw=Wt(Rw),qw=Wt(jw);function Z(i,e){return i<<e|i>>>32-e}function Vn(i){return i.byteOffset%4===0}const Kr=64,Fw=16,Wu=2**32-1,Ja=new Uint32Array;function Bw(i,e,t,r,s,n,o,a){const c=s.length,h=new Uint8Array(Kr),u=Wt(h),l=Vn(s)&&Vn(n),d=l?Wt(s):Ja,f=l?Wt(n):Ja;for(let p=0;p<c;o++){if(i(e,t,r,u,o,a),o>=Wu)throw new Error("arx: counter overflow");const g=Math.min(Kr,c-p);if(l&&g===Kr){const y=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let v=0,m;v<Fw;v++)m=y+v,f[m]=d[m]^u[v];p+=Kr;continue}for(let y=0,v;y<g;y++)v=p+y,n[v]=s[v]^h[y];p+=g}}function Lw(i,e){const{allowShortKeys:t,extendNonceFn:r,counterLength:s,counterRight:n,rounds:o}=Aw({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof i!="function")throw new Error("core must be a function");return sn(s),sn(o),Wa(n),Wa(t),(a,c,h,u,l=0)=>{Ge(a),Ge(c),Ge(h);const d=h.length;if(u===void 0&&(u=new Uint8Array(d)),Ge(u),sn(l),l<0||l>=Wu)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const f=[];let p=a.length,g,y;if(p===32)f.push(g=Hn(a)),y=qw;else if(p===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),y=Uw,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Vn(c)||f.push(c=Hn(c));const v=Wt(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(y,v,Wt(c.subarray(0,16)),v),c=c.subarray(16)}const m=16-s;if(m!==c.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(m!==12){const P=new Uint8Array(12);P.set(c,n?0:12-c.length),c=P,f.push(c)}const b=Wt(c);return Bw(i,y,v,b,h,u,l,o),Ki(...f),u}}const De=(i,e)=>i[e++]&255|(i[e++]&255)<<8;class kw{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=zn(e),Ge(e,32);const t=De(e,0),r=De(e,2),s=De(e,4),n=De(e,6),o=De(e,8),a=De(e,10),c=De(e,12),h=De(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|h<<8)&8191,this.r[9]=h>>>5&127;for(let u=0;u<8;u++)this.pad[u]=De(e,16+2*u)}process(e,t,r=!1){const s=r?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],h=o[2],u=o[3],l=o[4],d=o[5],f=o[6],p=o[7],g=o[8],y=o[9],v=De(e,t+0),m=De(e,t+2),b=De(e,t+4),P=De(e,t+6),A=De(e,t+8),w=De(e,t+10),_=De(e,t+12),D=De(e,t+14);let I=n[0]+(v&8191),j=n[1]+((v>>>13|m<<3)&8191),R=n[2]+((m>>>10|b<<6)&8191),U=n[3]+((b>>>7|P<<9)&8191),k=n[4]+((P>>>4|A<<12)&8191),$=n[5]+(A>>>1&8191),S=n[6]+((A>>>14|w<<2)&8191),E=n[7]+((w>>>11|_<<5)&8191),C=n[8]+((_>>>8|D<<8)&8191),x=n[9]+(D>>>5|s),O=0,N=O+I*a+j*(5*y)+R*(5*g)+U*(5*p)+k*(5*f);O=N>>>13,N&=8191,N+=$*(5*d)+S*(5*l)+E*(5*u)+C*(5*h)+x*(5*c),O+=N>>>13,N&=8191;let B=O+I*c+j*a+R*(5*y)+U*(5*g)+k*(5*p);O=B>>>13,B&=8191,B+=$*(5*f)+S*(5*d)+E*(5*l)+C*(5*u)+x*(5*h),O+=B>>>13,B&=8191;let L=O+I*h+j*c+R*a+U*(5*y)+k*(5*g);O=L>>>13,L&=8191,L+=$*(5*p)+S*(5*f)+E*(5*d)+C*(5*l)+x*(5*u),O+=L>>>13,L&=8191;let M=O+I*u+j*h+R*c+U*a+k*(5*y);O=M>>>13,M&=8191,M+=$*(5*g)+S*(5*p)+E*(5*f)+C*(5*d)+x*(5*l),O+=M>>>13,M&=8191;let z=O+I*l+j*u+R*h+U*c+k*a;O=z>>>13,z&=8191,z+=$*(5*y)+S*(5*g)+E*(5*p)+C*(5*f)+x*(5*d),O+=z>>>13,z&=8191;let K=O+I*d+j*l+R*u+U*h+k*c;O=K>>>13,K&=8191,K+=$*a+S*(5*y)+E*(5*g)+C*(5*p)+x*(5*f),O+=K>>>13,K&=8191;let V=O+I*f+j*d+R*l+U*u+k*h;O=V>>>13,V&=8191,V+=$*c+S*a+E*(5*y)+C*(5*g)+x*(5*p),O+=V>>>13,V&=8191;let oe=O+I*p+j*f+R*d+U*l+k*u;O=oe>>>13,oe&=8191,oe+=$*h+S*c+E*a+C*(5*y)+x*(5*g),O+=oe>>>13,oe&=8191;let te=O+I*g+j*p+R*f+U*d+k*l;O=te>>>13,te&=8191,te+=$*u+S*h+E*c+C*a+x*(5*y),O+=te>>>13,te&=8191;let J=O+I*y+j*g+R*p+U*f+k*d;O=J>>>13,J&=8191,J+=$*l+S*u+E*h+C*c+x*a,O+=J>>>13,J&=8191,O=(O<<2)+O|0,O=O+N|0,N=O&8191,O=O>>>13,B+=O,n[0]=N,n[1]=B,n[2]=L,n[3]=M,n[4]=z,n[5]=K,n[6]=V,n[7]=oe,n[8]=te,n[9]=J}finalize(){const{h:e,pad:t}=this,r=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,r[0]=e[0]+5,s=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+s,s=r[a]>>>13,r[a]&=8191;r[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)r[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Ki(r)}update(e){Ka(this);const{buffer:t,blockLen:r}=this;e=zn(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);if(o===r){for(;r<=s-n;n+=r)this.process(e,n);continue}t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Ki(this.h,this.r,this.buffer,this.pad)}digestInto(e){Ka(this),Sw(e,this),this.finished=!0;const{buffer:t,h:r}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=r[o]>>>0,e[n++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}}function Mw(i){const e=(r,s)=>i(s).update(zn(r)).digest(),t=i(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=r=>i(r),e}const zw=Mw(i=>new kw(i));function Hw(i,e,t,r,s,n=20){let o=i[0],a=i[1],c=i[2],h=i[3],u=e[0],l=e[1],d=e[2],f=e[3],p=e[4],g=e[5],y=e[6],v=e[7],m=s,b=t[0],P=t[1],A=t[2],w=o,_=a,D=c,I=h,j=u,R=l,U=d,k=f,$=p,S=g,E=y,C=v,x=m,O=b,N=P,B=A;for(let M=0;M<n;M+=2)w=w+j|0,x=Z(x^w,16),$=$+x|0,j=Z(j^$,12),w=w+j|0,x=Z(x^w,8),$=$+x|0,j=Z(j^$,7),_=_+R|0,O=Z(O^_,16),S=S+O|0,R=Z(R^S,12),_=_+R|0,O=Z(O^_,8),S=S+O|0,R=Z(R^S,7),D=D+U|0,N=Z(N^D,16),E=E+N|0,U=Z(U^E,12),D=D+U|0,N=Z(N^D,8),E=E+N|0,U=Z(U^E,7),I=I+k|0,B=Z(B^I,16),C=C+B|0,k=Z(k^C,12),I=I+k|0,B=Z(B^I,8),C=C+B|0,k=Z(k^C,7),w=w+R|0,B=Z(B^w,16),E=E+B|0,R=Z(R^E,12),w=w+R|0,B=Z(B^w,8),E=E+B|0,R=Z(R^E,7),_=_+U|0,x=Z(x^_,16),C=C+x|0,U=Z(U^C,12),_=_+U|0,x=Z(x^_,8),C=C+x|0,U=Z(U^C,7),D=D+k|0,O=Z(O^D,16),$=$+O|0,k=Z(k^$,12),D=D+k|0,O=Z(O^D,8),$=$+O|0,k=Z(k^$,7),I=I+j|0,N=Z(N^I,16),S=S+N|0,j=Z(j^S,12),I=I+j|0,N=Z(N^I,8),S=S+N|0,j=Z(j^S,7);let L=0;r[L++]=o+w|0,r[L++]=a+_|0,r[L++]=c+D|0,r[L++]=h+I|0,r[L++]=u+j|0,r[L++]=l+R|0,r[L++]=d+U|0,r[L++]=f+k|0,r[L++]=p+$|0,r[L++]=g+S|0,r[L++]=y+E|0,r[L++]=v+C|0,r[L++]=m+x|0,r[L++]=b+O|0,r[L++]=P+N|0,r[L++]=A+B|0}const Vw=Lw(Hw,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Kw=new Uint8Array(16),Za=(i,e)=>{i.update(e);const t=e.length%16;t&&i.update(Kw.subarray(t))},Ww=new Uint8Array(32);function Qa(i,e,t,r,s){const n=i(e,t,Ww),o=zw.create(n);s&&Za(o,s),Za(o,r);const a=new Uint8Array(16),c=Pw(a);Ya(c,0,BigInt(s?s.length:0),!0),Ya(c,8,BigInt(r.length),!0),o.update(a);const h=o.digest();return Ki(n,a),h}const Gw=i=>(e,t,r)=>({encrypt(s,n){const o=s.length;n=Ga(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);i(e,t,a,a,1);const c=Qa(i,e,t,a,r);return n.set(c,o),Ki(c),n},decrypt(s,n){n=Ga(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Qa(i,e,t,o,r);if(!xw(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),i(e,t,n,n,1),Ki(c),n}}),Gu=Nw({blockSize:64,nonceLength:12,tagLength:16},Gw(Vw));let Yu=class extends So{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,$o(e);const r=Vi(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(r.length>s?e.create().update(r).digest():r);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return Hi(this),this.iHash.update(e),this}digestInto(e){Hi(this),Rr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const $s=(i,e,t)=>new Yu(i,e).update(t).digest();$s.create=(i,e)=>new Yu(i,e);function Yw(i,e,t){return $o(i),t===void 0&&(t=new Uint8Array(i.outputLen)),$s(i,Vi(t),Vi(e))}const nn=new Uint8Array([0]),Xa=new Uint8Array;function Jw(i,e,t,r=32){if($o(i),Dr(r),r>255*i.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i.outputLen);t===void 0&&(t=Xa);const n=new Uint8Array(s*i.outputLen),o=$s.create(i,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let h=0;h<s;h++)nn[0]=h+1,a.update(h===0?Xa:c).update(t).update(nn).digestInto(c),n.set(c,i.outputLen*h),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),nn.fill(0),n.slice(0,r)}const Zw=(i,e,t,r,s)=>Jw(i,Yw(i,e,t),r,s);function Qw(i,e,t,r){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n),c=r?4:0,h=r?0:4;i.setUint32(e+c,o,r),i.setUint32(e+h,a,r)}function Xw(i,e,t){return i&e^~i&t}function eb(i,e,t){return i&e^i&t^e&t}let tb=class extends So{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=rn(this.buffer)}update(e){Hi(this);const{view:t,buffer:r,blockLen:s}=this;e=Vi(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=rn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Hi(this),Uu(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let l=o;l<s;l++)t[l]=0;Qw(r,s-8,BigInt(this.length*8),n),this.process(r,0);const a=rn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<h;l++)a.setUint32(4*l,u[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%t&&e.buffer.set(r),e}};const ib=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Lt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),kt=new Uint32Array(64);class rb extends tb{constructor(){super(64,32,8,!1),this.A=Lt[0]|0,this.B=Lt[1]|0,this.C=Lt[2]|0,this.D=Lt[3]|0,this.E=Lt[4]|0,this.F=Lt[5]|0,this.G=Lt[6]|0,this.H=Lt[7]|0}get(){const{A:e,B:t,C:r,D:s,E:n,F:o,G:a,H:c}=this;return[e,t,r,s,n,o,a,c]}set(e,t,r,s,n,o,a,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let l=0;l<16;l++,t+=4)kt[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){const d=kt[l-15],f=kt[l-2],p=gt(d,7)^gt(d,18)^d>>>3,g=gt(f,17)^gt(f,19)^f>>>10;kt[l]=g+kt[l-7]+p+kt[l-16]|0}let{A:r,B:s,C:n,D:o,E:a,F:c,G:h,H:u}=this;for(let l=0;l<64;l++){const d=gt(a,6)^gt(a,11)^gt(a,25),f=u+d+Xw(a,c,h)+ib[l]+kt[l]|0,p=(gt(r,2)^gt(r,13)^gt(r,22))+eb(r,s,n)|0;u=h,h=c,c=a,a=o+f|0,o=n,n=s,s=r,r=f+p|0}r=r+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,h=h+this.G|0,u=u+this.H|0,this.set(r,s,n,o,a,c,h,u)}roundClean(){kt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const jr=qu(()=>new rb);const Ss=BigInt(0),Ps=BigInt(1),sb=BigInt(2);function di(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Ur(i){if(!di(i))throw new Error("Uint8Array expected")}function Wi(i,e){if(typeof e!="boolean")throw new Error(i+" boolean expected, got "+e)}const nb=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function Gi(i){Ur(i);let e="";for(let t=0;t<i.length;t++)e+=nb[i[t]];return e}function Li(i){const e=i.toString(16);return e.length&1?"0"+e:e}function Oo(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);return i===""?Ss:BigInt("0x"+i)}const Ot={_0:48,_9:57,A:65,F:70,a:97,f:102};function ec(i){if(i>=Ot._0&&i<=Ot._9)return i-Ot._0;if(i>=Ot.A&&i<=Ot.F)return i-(Ot.A-10);if(i>=Ot.a&&i<=Ot.f)return i-(Ot.a-10)}function Yi(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);const e=i.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const o=ec(i.charCodeAt(n)),a=ec(i.charCodeAt(n+1));if(o===void 0||a===void 0){const c=i[n]+i[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[s]=o*16+a}return r}function ci(i){return Oo(Gi(i))}function Sr(i){return Ur(i),Oo(Gi(Uint8Array.from(i).reverse()))}function Ji(i,e){return Yi(i.toString(16).padStart(e*2,"0"))}function Os(i,e){return Ji(i,e).reverse()}function ob(i){return Yi(Li(i))}function We(i,e,t){let r;if(typeof e=="string")try{r=Yi(e)}catch(n){throw new Error(i+" must be hex string or Uint8Array, cause: "+n)}else if(di(e))r=Uint8Array.from(e);else throw new Error(i+" must be hex string or Uint8Array");const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(i+" of length "+t+" expected, got "+s);return r}function Pr(...i){let e=0;for(let r=0;r<i.length;r++){const s=i[r];Ur(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<i.length;r++){const n=i[r];t.set(n,s),s+=n.length}return t}function ab(i,e){if(i.length!==e.length)return!1;let t=0;for(let r=0;r<i.length;r++)t|=i[r]^e[r];return t===0}function cb(i){if(typeof i!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(i))}const on=i=>typeof i=="bigint"&&Ss<=i;function Cs(i,e,t){return on(i)&&on(e)&&on(t)&&e<=i&&i<t}function Rt(i,e,t,r){if(!Cs(e,t,r))throw new Error("expected valid "+i+": "+t+" <= n < "+r+", got "+e)}function Ju(i){let e;for(e=0;i>Ss;i>>=Ps,e+=1);return e}function hb(i,e){return i>>BigInt(e)&Ps}function ub(i,e,t){return i|(t?Ps:Ss)<<BigInt(e)}const Co=i=>(sb<<BigInt(i-1))-Ps,an=i=>new Uint8Array(i),tc=i=>Uint8Array.from(i);function Zu(i,e,t){if(typeof i!="number"||i<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=an(i),s=an(i),n=0;const o=()=>{r.fill(1),s.fill(0),n=0},a=(...u)=>t(s,r,...u),c=(u=an())=>{s=a(tc([0]),u),r=a(),u.length!==0&&(s=a(tc([1]),u),r=a())},h=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const l=[];for(;u<e;){r=a();const d=r.slice();l.push(d),u+=r.length}return Pr(...l)};return(u,l)=>{o(),c(u);let d;for(;!(d=l(h()));)c();return o(),d}}const lb={bigint:i=>typeof i=="bigint",function:i=>typeof i=="function",boolean:i=>typeof i=="boolean",string:i=>typeof i=="string",stringOrUint8Array:i=>typeof i=="string"||di(i),isSafeInteger:i=>Number.isSafeInteger(i),array:i=>Array.isArray(i),field:(i,e)=>e.Fp.isValid(i),hash:i=>typeof i=="function"&&Number.isSafeInteger(i.outputLen)};function ir(i,e,t={}){const r=(s,n,o)=>{const a=lb[n];if(typeof a!="function")throw new Error("invalid validator function");const c=i[s];if(!(o&&c===void 0)&&!a(c,i))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))r(s,n,!1);for(const[s,n]of Object.entries(t))r(s,n,!0);return i}const db=()=>{throw new Error("not implemented")};function Kn(i){const e=new WeakMap;return(t,...r)=>{const s=e.get(t);if(s!==void 0)return s;const n=i(t,...r);return e.set(t,n),n}}var pb=Object.freeze({__proto__:null,isBytes:di,abytes:Ur,abool:Wi,bytesToHex:Gi,numberToHexUnpadded:Li,hexToNumber:Oo,hexToBytes:Yi,bytesToNumberBE:ci,bytesToNumberLE:Sr,numberToBytesBE:Ji,numberToBytesLE:Os,numberToVarBytesBE:ob,ensureBytes:We,concatBytes:Pr,equalBytes:ab,utf8ToBytes:cb,inRange:Cs,aInRange:Rt,bitLen:Ju,bitGet:hb,bitSet:ub,bitMask:Co,createHmacDrbg:Zu,validateObject:ir,notImplemented:db,memoized:Kn});const Ee=BigInt(0),ue=BigInt(1),ri=BigInt(2),fb=BigInt(3),Wn=BigInt(4),ic=BigInt(5),rc=BigInt(8);function ke(i,e){const t=i%e;return t>=Ee?t:e+t}function Qu(i,e,t){if(e<Ee)throw new Error("invalid exponent, negatives unsupported");if(t<=Ee)throw new Error("invalid modulus");if(t===ue)return Ee;let r=ue;for(;e>Ee;)e&ue&&(r=r*i%t),i=i*i%t,e>>=ue;return r}function ut(i,e,t){let r=i;for(;e-- >Ee;)r*=r,r%=t;return r}function Gn(i,e){if(i===Ee)throw new Error("invert: expected non-zero number");if(e<=Ee)throw new Error("invert: expected positive modulus, got "+e);let t=ke(i,e),r=e,s=Ee,n=ue;for(;t!==Ee;){const o=r/t,a=r%t,c=s-n*o;r=t,t=a,s=n,n=c}if(r!==ue)throw new Error("invert: does not exist");return ke(s,e)}function gb(i){const e=(i-ue)/ri;let t,r,s;for(t=i-ue,r=0;t%ri===Ee;t/=ri,r++);for(s=ri;s<i&&Qu(s,e,i)!==i-ue;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(i+ue)/Wn;return function(a,c){const h=a.pow(c,o);if(!a.eql(a.sqr(h),c))throw new Error("Cannot find square root");return h}}const n=(t+ue)/ri;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,h=o.pow(o.mul(o.ONE,s),t),u=o.pow(a,n),l=o.pow(a,t);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(l);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(h,ue<<BigInt(c-d-1));h=o.sqr(f),u=o.mul(u,f),l=o.mul(l,h),c=d}return u}}function yb(i){if(i%Wn===fb){const e=(i+ue)/Wn;return function(t,r){const s=t.pow(r,e);if(!t.eql(t.sqr(s),r))throw new Error("Cannot find square root");return s}}if(i%rc===ic){const e=(i-ic)/rc;return function(t,r){const s=t.mul(r,ri),n=t.pow(s,e),o=t.mul(r,n),a=t.mul(t.mul(o,ri),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),r))throw new Error("Cannot find square root");return c}}return gb(i)}const mb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wb(i){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=mb.reduce((r,s)=>(r[s]="function",r),e);return ir(i,t)}function bb(i,e,t){if(t<Ee)throw new Error("invalid exponent, negatives unsupported");if(t===Ee)return i.ONE;if(t===ue)return e;let r=i.ONE,s=e;for(;t>Ee;)t&ue&&(r=i.mul(r,s)),s=i.sqr(s),t>>=ue;return r}function vb(i,e){const t=new Array(e.length),r=e.reduce((n,o,a)=>i.is0(o)?n:(t[a]=n,i.mul(n,o)),i.ONE),s=i.inv(r);return e.reduceRight((n,o,a)=>i.is0(o)?n:(t[a]=i.mul(n,t[a]),i.mul(n,o)),s),t}function Xu(i,e){const t=e!==void 0?e:i.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function el(i,e,t=!1,r={}){if(i<=Ee)throw new Error("invalid field: expected ORDER > 0, got "+i);const{nBitLength:s,nByteLength:n}=Xu(i,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:i,isLE:t,BITS:s,BYTES:n,MASK:Co(s),ZERO:Ee,ONE:ue,create:c=>ke(c,i),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ee<=c&&c<i},is0:c=>c===Ee,isOdd:c=>(c&ue)===ue,neg:c=>ke(-c,i),eql:(c,h)=>c===h,sqr:c=>ke(c*c,i),add:(c,h)=>ke(c+h,i),sub:(c,h)=>ke(c-h,i),mul:(c,h)=>ke(c*h,i),pow:(c,h)=>bb(a,c,h),div:(c,h)=>ke(c*Gn(h,i),i),sqrN:c=>c*c,addN:(c,h)=>c+h,subN:(c,h)=>c-h,mulN:(c,h)=>c*h,inv:c=>Gn(c,i),sqrt:r.sqrt||(c=>(o||(o=yb(i)),o(a,c))),invertBatch:c=>vb(a,c),cmov:(c,h,u)=>u?h:c,toBytes:c=>t?Os(c,n):Ji(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?Sr(c):ci(c)}});return Object.freeze(a)}function tl(i){if(typeof i!="bigint")throw new Error("field order must be bigint");const e=i.toString(2).length;return Math.ceil(e/8)}function il(i){const e=tl(i);return e+Math.ceil(e/2)}function Eb(i,e,t=!1){const r=i.length,s=tl(e),n=il(e);if(r<16||r<n||r>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+r);const o=t?Sr(i):ci(i),a=ke(o,e-ue)+ue;return t?Os(a,s):Ji(a,s)}const sc=BigInt(0),Wr=BigInt(1);function cn(i,e){const t=e.negate();return i?t:e}function rl(i,e){if(!Number.isSafeInteger(i)||i<=0||i>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+i)}function hn(i,e){rl(i,e);const t=Math.ceil(e/i)+1,r=2**(i-1);return{windows:t,windowSize:r}}function _b(i,e){if(!Array.isArray(i))throw new Error("array expected");i.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function Ib(i,e){if(!Array.isArray(i))throw new Error("array of scalars expected");i.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const un=new WeakMap,sl=new WeakMap;function ln(i){return sl.get(i)||1}function Db(i,e){return{constTimeNegate:cn,hasPrecomputes(t){return ln(t)!==1},unsafeLadder(t,r,s=i.ZERO){let n=t;for(;r>sc;)r&Wr&&(s=s.add(n)),n=n.double(),r>>=Wr;return s},precomputeWindow(t,r){const{windows:s,windowSize:n}=hn(r,e),o=[];let a=t,c=a;for(let h=0;h<s;h++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,r,s){const{windows:n,windowSize:o}=hn(t,e);let a=i.ZERO,c=i.BASE;const h=BigInt(2**t-1),u=2**t,l=BigInt(t);for(let d=0;d<n;d++){const f=d*o;let p=Number(s&h);s>>=l,p>o&&(p-=u,s+=Wr);const g=f,y=f+Math.abs(p)-1,v=d%2!==0,m=p<0;p===0?c=c.add(cn(v,r[g])):a=a.add(cn(m,r[y]))}return{p:a,f:c}},wNAFUnsafe(t,r,s,n=i.ZERO){const{windows:o,windowSize:a}=hn(t,e),c=BigInt(2**t-1),h=2**t,u=BigInt(t);for(let l=0;l<o;l++){const d=l*a;if(s===sc)break;let f=Number(s&c);if(s>>=u,f>a&&(f-=h,s+=Wr),f===0)continue;let p=r[d+Math.abs(f)-1];f<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(t,r,s){let n=un.get(r);return n||(n=this.precomputeWindow(r,t),t!==1&&un.set(r,s(n))),n},wNAFCached(t,r,s){const n=ln(t);return this.wNAF(n,this.getPrecomputes(n,t,s),r)},wNAFCachedUnsafe(t,r,s,n){const o=ln(t);return o===1?this.unsafeLadder(t,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),r,n)},setWindowSize(t,r){rl(r,e),sl.set(t,r),un.delete(t)}}}function $b(i,e,t,r){if(_b(t,i),Ib(r,e),t.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const s=i.ZERO,n=Ju(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),h=Math.floor((e.BITS-1)/o)*o;let u=s;for(let l=h;l>=0;l-=o){c.fill(s);for(let f=0;f<r.length;f++){const p=r[f],g=Number(p>>BigInt(l)&BigInt(a));c[g]=c[g].add(t[f])}let d=s;for(let f=c.length-1,p=s;f>0;f--)p=p.add(c[f]),d=d.add(p);if(u=u.add(d),l!==0)for(let f=0;f<o;f++)u=u.double()}return u}function nl(i){return wb(i.Fp),ir(i,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Xu(i.n,i.nBitLength),...i,p:i.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Di=BigInt(0),dn=BigInt(1);function Sb(i){return ir(i,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...i})}function Pb(i){const e=Sb(i),{P:t}=e,r=m=>ke(m,t),s=e.montgomeryBits,n=Math.ceil(s/8),o=e.nByteLength,a=e.adjustScalarBytes||(m=>m),c=e.powPminus2||(m=>Qu(m,t-BigInt(2),t));function h(m,b,P){const A=r(m*(b-P));return b=r(b-A),P=r(P+A),[b,P]}const u=(e.a-BigInt(2))/BigInt(4);function l(m,b){Rt("u",m,Di,t),Rt("scalar",b,Di,t);const P=b,A=m;let w=dn,_=Di,D=m,I=dn,j=Di,R;for(let k=BigInt(s-1);k>=Di;k--){const $=P>>k&dn;j^=$,R=h(j,w,D),w=R[0],D=R[1],R=h(j,_,I),_=R[0],I=R[1],j=$;const S=w+_,E=r(S*S),C=w-_,x=r(C*C),O=E-x,N=D+I,B=D-I,L=r(B*S),M=r(N*C),z=L+M,K=L-M;D=r(z*z),I=r(A*r(K*K)),w=r(E*x),_=r(O*(E+r(u*O)))}R=h(j,w,D),w=R[0],D=R[1],R=h(j,_,I),_=R[0],I=R[1];const U=c(_);return r(w*U)}function d(m){return Os(r(m),n)}function f(m){const b=We("u coordinate",m,n);return o===32&&(b[31]&=127),Sr(b)}function p(m){const b=We("scalar",m),P=b.length;if(P!==n&&P!==o){let A=""+n+" or "+o;throw new Error("invalid scalar, expected "+A+" bytes, got "+P)}return Sr(a(b))}function g(m,b){const P=f(b),A=p(m),w=l(P,A);if(w===Di)throw new Error("invalid private or public key received");return d(w)}const y=d(e.Gu);function v(m){return g(m,y)}return{scalarMult:g,scalarMultBase:v,getSharedSecret:(m,b)=>g(m,b),getPublicKey:m=>v(m),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:y}}const Yn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const Ob=BigInt(1),nc=BigInt(2),Cb=BigInt(3),Ab=BigInt(5);BigInt(8);function xb(i){const e=BigInt(10),t=BigInt(20),r=BigInt(40),s=BigInt(80),n=Yn,o=i*i%n*i%n,a=ut(o,nc,n)*o%n,c=ut(a,Ob,n)*i%n,h=ut(c,Ab,n)*c%n,u=ut(h,e,n)*h%n,l=ut(u,t,n)*u%n,d=ut(l,r,n)*l%n,f=ut(d,s,n)*d%n,p=ut(f,s,n)*d%n,g=ut(p,e,n)*h%n;return{pow_p_5_8:ut(g,nc,n)*i%n,b2:o}}function Nb(i){return i[0]&=248,i[31]&=127,i[31]|=64,i}const Jn=Pb({P:Yn,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:i=>{const e=Yn,{pow_p_5_8:t,b2:r}=xb(i);return ke(ut(t,Cb,e)*r,e)},adjustScalarBytes:Nb,randomBytes:tr});function oc(i){i.lowS!==void 0&&Wi("lowS",i.lowS),i.prehash!==void 0&&Wi("prehash",i.prehash)}function Tb(i){const e=nl(i);ir(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:s}=e;if(t){if(!r.eql(s,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:Rb,hexToBytes:jb}=pb;class Ub extends Error{constructor(e=""){super(e)}}const Nt={Err:Ub,_tlv:{encode:(i,e)=>{const{Err:t}=Nt;if(i<0||i>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,s=Li(r);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const n=r>127?Li(s.length/2|128):"";return Li(i)+n+s+e},decode(i,e){const{Err:t}=Nt;let r=0;if(i<0||i>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==i)throw new t("tlv.decode: wrong tlv");const s=e[r++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const h=e.subarray(r,r+c);if(h.length!==c)throw new t("tlv.decode: length bytes not complete");if(h[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of h)o=o<<8|u;if(r+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(i){const{Err:e}=Nt;if(i<Tt)throw new e("integer: negative integers are not allowed");let t=Li(i);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(i){const{Err:e}=Nt;if(i[0]&128)throw new e("invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Rb(i)}},toSig(i){const{Err:e,_int:t,_tlv:r}=Nt,s=typeof i=="string"?jb(i):i;Ur(s);const{v:n,l:o}=r.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,n),{v:h,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(h)}},hexFromSig(i){const{_tlv:e,_int:t}=Nt,r=e.encode(2,t.encode(i.r)),s=e.encode(2,t.encode(i.s)),n=r+s;return e.encode(48,n)}},Tt=BigInt(0),we=BigInt(1);BigInt(2);const ac=BigInt(3);BigInt(4);function qb(i){const e=Tb(i),{Fp:t}=e,r=el(e.n,e.nBitLength),s=e.toBytes||((g,y,v)=>{const m=y.toAffine();return Pr(Uint8Array.from([4]),t.toBytes(m.x),t.toBytes(m.y))}),n=e.fromBytes||(g=>{const y=g.subarray(1),v=t.fromBytes(y.subarray(0,t.BYTES)),m=t.fromBytes(y.subarray(t.BYTES,2*t.BYTES));return{x:v,y:m}});function o(g){const{a:y,b:v}=e,m=t.sqr(g),b=t.mul(m,g);return t.add(t.add(b,t.mul(g,y)),v)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return Cs(g,we,e.n)}function c(g){const{allowedPrivateKeyLengths:y,nByteLength:v,wrapPrivateKey:m,n:b}=e;if(y&&typeof g!="bigint"){if(di(g)&&(g=Gi(g)),typeof g!="string"||!y.includes(g.length))throw new Error("invalid private key");g=g.padStart(v*2,"0")}let P;try{P=typeof g=="bigint"?g:ci(We("private key",g,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof g)}return m&&(P=ke(P,b)),Rt("private key",P,we,b),P}function h(g){if(!(g instanceof d))throw new Error("ProjectivePoint expected")}const u=Kn((g,y)=>{const{px:v,py:m,pz:b}=g;if(t.eql(b,t.ONE))return{x:v,y:m};const P=g.is0();y==null&&(y=P?t.ONE:t.inv(b));const A=t.mul(v,y),w=t.mul(m,y),_=t.mul(b,y);if(P)return{x:t.ZERO,y:t.ZERO};if(!t.eql(_,t.ONE))throw new Error("invZ was invalid");return{x:A,y:w}}),l=Kn(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:y,y:v}=g.toAffine();if(!t.isValid(y)||!t.isValid(v))throw new Error("bad point: x or y not FE");const m=t.sqr(v),b=o(y);if(!t.eql(m,b))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(y,v,m){if(this.px=y,this.py=v,this.pz=m,y==null||!t.isValid(y))throw new Error("x required");if(v==null||!t.isValid(v))throw new Error("y required");if(m==null||!t.isValid(m))throw new Error("z required");Object.freeze(this)}static fromAffine(y){const{x:v,y:m}=y||{};if(!y||!t.isValid(v)||!t.isValid(m))throw new Error("invalid affine point");if(y instanceof d)throw new Error("projective point not allowed");const b=P=>t.eql(P,t.ZERO);return b(v)&&b(m)?d.ZERO:new d(v,m,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){const v=t.invertBatch(y.map(m=>m.pz));return y.map((m,b)=>m.toAffine(v[b])).map(d.fromAffine)}static fromHex(y){const v=d.fromAffine(n(We("pointHex",y)));return v.assertValidity(),v}static fromPrivateKey(y){return d.BASE.multiply(c(y))}static msm(y,v){return $b(d,r,y,v)}_setWindowSize(y){p.setWindowSize(this,y)}assertValidity(){l(this)}hasEvenY(){const{y}=this.toAffine();if(t.isOdd)return!t.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){h(y);const{px:v,py:m,pz:b}=this,{px:P,py:A,pz:w}=y,_=t.eql(t.mul(v,w),t.mul(P,b)),D=t.eql(t.mul(m,w),t.mul(A,b));return _&&D}negate(){return new d(this.px,t.neg(this.py),this.pz)}double(){const{a:y,b:v}=e,m=t.mul(v,ac),{px:b,py:P,pz:A}=this;let w=t.ZERO,_=t.ZERO,D=t.ZERO,I=t.mul(b,b),j=t.mul(P,P),R=t.mul(A,A),U=t.mul(b,P);return U=t.add(U,U),D=t.mul(b,A),D=t.add(D,D),w=t.mul(y,D),_=t.mul(m,R),_=t.add(w,_),w=t.sub(j,_),_=t.add(j,_),_=t.mul(w,_),w=t.mul(U,w),D=t.mul(m,D),R=t.mul(y,R),U=t.sub(I,R),U=t.mul(y,U),U=t.add(U,D),D=t.add(I,I),I=t.add(D,I),I=t.add(I,R),I=t.mul(I,U),_=t.add(_,I),R=t.mul(P,A),R=t.add(R,R),I=t.mul(R,U),w=t.sub(w,I),D=t.mul(R,j),D=t.add(D,D),D=t.add(D,D),new d(w,_,D)}add(y){h(y);const{px:v,py:m,pz:b}=this,{px:P,py:A,pz:w}=y;let _=t.ZERO,D=t.ZERO,I=t.ZERO;const j=e.a,R=t.mul(e.b,ac);let U=t.mul(v,P),k=t.mul(m,A),$=t.mul(b,w),S=t.add(v,m),E=t.add(P,A);S=t.mul(S,E),E=t.add(U,k),S=t.sub(S,E),E=t.add(v,b);let C=t.add(P,w);return E=t.mul(E,C),C=t.add(U,$),E=t.sub(E,C),C=t.add(m,b),_=t.add(A,w),C=t.mul(C,_),_=t.add(k,$),C=t.sub(C,_),I=t.mul(j,E),_=t.mul(R,$),I=t.add(_,I),_=t.sub(k,I),I=t.add(k,I),D=t.mul(_,I),k=t.add(U,U),k=t.add(k,U),$=t.mul(j,$),E=t.mul(R,E),k=t.add(k,$),$=t.sub(U,$),$=t.mul(j,$),E=t.add(E,$),U=t.mul(k,E),D=t.add(D,U),U=t.mul(C,E),_=t.mul(S,_),_=t.sub(_,U),U=t.mul(S,k),I=t.mul(C,I),I=t.add(I,U),new d(_,D,I)}subtract(y){return this.add(y.negate())}is0(){return this.equals(d.ZERO)}wNAF(y){return p.wNAFCached(this,y,d.normalizeZ)}multiplyUnsafe(y){const{endo:v,n:m}=e;Rt("scalar",y,Tt,m);const b=d.ZERO;if(y===Tt)return b;if(this.is0()||y===we)return this;if(!v||p.hasPrecomputes(this))return p.wNAFCachedUnsafe(this,y,d.normalizeZ);let{k1neg:P,k1:A,k2neg:w,k2:_}=v.splitScalar(y),D=b,I=b,j=this;for(;A>Tt||_>Tt;)A&we&&(D=D.add(j)),_&we&&(I=I.add(j)),j=j.double(),A>>=we,_>>=we;return P&&(D=D.negate()),w&&(I=I.negate()),I=new d(t.mul(I.px,v.beta),I.py,I.pz),D.add(I)}multiply(y){const{endo:v,n:m}=e;Rt("scalar",y,we,m);let b,P;if(v){const{k1neg:A,k1:w,k2neg:_,k2:D}=v.splitScalar(y);let{p:I,f:j}=this.wNAF(w),{p:R,f:U}=this.wNAF(D);I=p.constTimeNegate(A,I),R=p.constTimeNegate(_,R),R=new d(t.mul(R.px,v.beta),R.py,R.pz),b=I.add(R),P=j.add(U)}else{const{p:A,f:w}=this.wNAF(y);b=A,P=w}return d.normalizeZ([b,P])[0]}multiplyAndAddUnsafe(y,v,m){const b=d.BASE,P=(w,_)=>_===Tt||_===we||!w.equals(b)?w.multiplyUnsafe(_):w.multiply(_),A=P(this,v).add(P(y,m));return A.is0()?void 0:A}toAffine(y){return u(this,y)}isTorsionFree(){const{h:y,isTorsionFree:v}=e;if(y===we)return!0;if(v)return v(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:y,clearCofactor:v}=e;return y===we?this:v?v(d,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return Wi("isCompressed",y),this.assertValidity(),s(d,this,y)}toHex(y=!0){return Wi("isCompressed",y),Gi(this.toRawBytes(y))}}d.BASE=new d(e.Gx,e.Gy,t.ONE),d.ZERO=new d(t.ZERO,t.ONE,t.ZERO);const f=e.nBitLength,p=Db(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Fb(i){const e=nl(i);return ir(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Bb(i){const e=Fb(i),{Fp:t,n:r}=e,s=t.BYTES+1,n=2*t.BYTES+1;function o($){return ke($,r)}function a($){return Gn($,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:u,isWithinCurveOrder:l}=qb({...e,toBytes($,S,E){const C=S.toAffine(),x=t.toBytes(C.x),O=Pr;return Wi("isCompressed",E),E?O(Uint8Array.from([S.hasEvenY()?2:3]),x):O(Uint8Array.from([4]),x,t.toBytes(C.y))},fromBytes($){const S=$.length,E=$[0],C=$.subarray(1);if(S===s&&(E===2||E===3)){const x=ci(C);if(!Cs(x,we,t.ORDER))throw new Error("Point is not on curve");const O=u(x);let N;try{N=t.sqrt(O)}catch(L){const M=L instanceof Error?": "+L.message:"";throw new Error("Point is not on curve"+M)}const B=(N&we)===we;return(E&1)===1!==B&&(N=t.neg(N)),{x,y:N}}else if(S===n&&E===4){const x=t.fromBytes(C.subarray(0,t.BYTES)),O=t.fromBytes(C.subarray(t.BYTES,2*t.BYTES));return{x,y:O}}else{const x=s,O=n;throw new Error("invalid Point, expected length of "+x+", or uncompressed "+O+", got "+S)}}}),d=$=>Gi(Ji($,e.nByteLength));function f($){const S=r>>we;return $>S}function p($){return f($)?o(-$):$}const g=($,S,E)=>ci($.slice(S,E));class y{constructor(S,E,C){this.r=S,this.s=E,this.recovery=C,this.assertValidity()}static fromCompact(S){const E=e.nByteLength;return S=We("compactSignature",S,E*2),new y(g(S,0,E),g(S,E,2*E))}static fromDER(S){const{r:E,s:C}=Nt.toSig(We("DER",S));return new y(E,C)}assertValidity(){Rt("r",this.r,we,r),Rt("s",this.s,we,r)}addRecoveryBit(S){return new y(this.r,this.s,S)}recoverPublicKey(S){const{r:E,s:C,recovery:x}=this,O=w(We("msgHash",S));if(x==null||![0,1,2,3].includes(x))throw new Error("recovery id invalid");const N=x===2||x===3?E+e.n:E;if(N>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const B=(x&1)===0?"02":"03",L=c.fromHex(B+d(N)),M=a(N),z=o(-O*M),K=o(C*M),V=c.BASE.multiplyAndAddUnsafe(L,z,K);if(!V)throw new Error("point at infinify");return V.assertValidity(),V}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Yi(this.toDERHex())}toDERHex(){return Nt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Yi(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const v={isValidPrivateKey($){try{return h($),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const $=il(e.n);return Eb(e.randomBytes($),e.n)},precompute($=8,S=c.BASE){return S._setWindowSize($),S.multiply(BigInt(3)),S}};function m($,S=!0){return c.fromPrivateKey($).toRawBytes(S)}function b($){const S=di($),E=typeof $=="string",C=(S||E)&&$.length;return S?C===s||C===n:E?C===2*s||C===2*n:$ instanceof c}function P($,S,E=!0){if(b($))throw new Error("first arg must be private key");if(!b(S))throw new Error("second arg must be public key");return c.fromHex(S).multiply(h($)).toRawBytes(E)}const A=e.bits2int||function($){if($.length>8192)throw new Error("input is too large");const S=ci($),E=$.length*8-e.nBitLength;return E>0?S>>BigInt(E):S},w=e.bits2int_modN||function($){return o(A($))},_=Co(e.nBitLength);function D($){return Rt("num < 2^"+e.nBitLength,$,Tt,_),Ji($,e.nByteLength)}function I($,S,E=j){if(["recovered","canonical"].some(te=>te in E))throw new Error("sign() legacy options not supported");const{hash:C,randomBytes:x}=e;let{lowS:O,prehash:N,extraEntropy:B}=E;O==null&&(O=!0),$=We("msgHash",$),oc(E),N&&($=We("prehashed msgHash",C($)));const L=w($),M=h(S),z=[D(M),D(L)];if(B!=null&&B!==!1){const te=B===!0?x(t.BYTES):B;z.push(We("extraEntropy",te))}const K=Pr(...z),V=L;function oe(te){const J=A(te);if(!l(J))return;const xe=a(J),Ie=c.BASE.multiply(J).toAffine(),Te=o(Ie.x);if(Te===Tt)return;const Ze=o(xe*o(V+Te*M));if(Ze===Tt)return;let Dt=(Ie.x===Te?0:2)|Number(Ie.y&we),bi=Ze;return O&&f(Ze)&&(bi=p(Ze),Dt^=1),new y(Te,bi,Dt)}return{seed:K,k2sig:oe}}const j={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};function U($,S,E=j){const{seed:C,k2sig:x}=I($,S,E),O=e;return Zu(O.hash.outputLen,O.nByteLength,O.hmac)(C,x)}c.BASE._setWindowSize(8);function k($,S,E,C=R){const x=$;S=We("msgHash",S),E=We("publicKey",E);const{lowS:O,prehash:N,format:B}=C;if(oc(C),"strict"in C)throw new Error("options.strict was renamed to lowS");if(B!==void 0&&B!=="compact"&&B!=="der")throw new Error("format must be compact or der");const L=typeof x=="string"||di(x),M=!L&&!B&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!L&&!M)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let z,K;try{if(M&&(z=new y(x.r,x.s)),L){try{B!=="compact"&&(z=y.fromDER(x))}catch(Ze){if(!(Ze instanceof Nt.Err))throw Ze}!z&&B!=="der"&&(z=y.fromCompact(x))}K=c.fromHex(E)}catch{return!1}if(!z||O&&z.hasHighS())return!1;N&&(S=e.hash(S));const{r:V,s:oe}=z,te=w(S),J=a(oe),xe=o(te*J),Ie=o(V*J),Te=c.BASE.multiplyAndAddUnsafe(K,xe,Ie)?.toAffine();return Te?o(Te.x)===V:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:P,sign:U,verify:k,ProjectivePoint:c,Signature:y,utils:v}}function Lb(i){return{hash:i,hmac:(e,...t)=>$s(i,e,Hm(...t)),randomBytes:tr}}function kb(i,e){const t=r=>Bb({...i,...Lb(r)});return{...t(e),create:t}}const ol=el(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Mb=ol.create(BigInt("-3")),zb=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Hb=kb({a:Mb,b:zb,Fp:ol,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},jr),al="base10",je="base16",lt="base64pad",zt="base64url",qr="utf8",cl=0,jt=1,Fr=2,Vb=0,cc=1,wr=12,Ao=32;function Kb(){const i=Jn.utils.randomPrivateKey(),e=Jn.getPublicKey(i);return{privateKey:Me(i,je),publicKey:Me(e,je)}}function Zn(){const i=tr(Ao);return Me(i,je)}function Wb(i,e){const t=Jn.getSharedSecret(it(i,je),it(e,je)),r=Zw(jr,t,void 0,void 0,Ao);return Me(r,je)}function ns(i){const e=jr(it(i,je));return Me(e,je)}function Et(i){const e=jr(it(i,qr));return Me(e,je)}function hl(i){return it(`${i}`,al)}function pi(i){return Number(Me(i,al))}function ul(i){return i.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ll(i){const e=i.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function Gb(i){const e=hl(typeof i.type<"u"?i.type:cl);if(pi(e)===jt&&typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof i.senderPublicKey<"u"?it(i.senderPublicKey,je):void 0,r=typeof i.iv<"u"?it(i.iv,je):tr(wr),s=it(i.symKey,je),n=Gu(s,r).encrypt(it(i.message,qr)),o=dl({type:e,sealed:n,iv:r,senderPublicKey:t});return i.encoding===zt?ul(o):o}function Yb(i){const e=it(i.symKey,je),{sealed:t,iv:r}=Or({encoded:i.encoded,encoding:i.encoding}),s=Gu(e,r).decrypt(t);if(s===null)throw new Error("Failed to decrypt");return Me(s,qr)}function Jb(i,e){const t=hl(Fr),r=tr(wr),s=it(i,qr),n=dl({type:t,sealed:s,iv:r});return e===zt?ul(n):n}function Zb(i,e){const{sealed:t}=Or({encoded:i,encoding:e});return Me(t,qr)}function dl(i){if(pi(i.type)===Fr)return Me(mr([i.type,i.sealed]),lt);if(pi(i.type)===jt){if(typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Me(mr([i.type,i.senderPublicKey,i.iv,i.sealed]),lt)}return Me(mr([i.type,i.iv,i.sealed]),lt)}function Or(i){const e=(i.encoding||lt)===zt?ll(i.encoded):i.encoded,t=it(e,lt),r=t.slice(Vb,cc),s=cc;if(pi(r)===jt){const c=s+Ao,h=c+wr,u=t.slice(s,c),l=t.slice(c,h),d=t.slice(h);return{type:r,sealed:d,iv:l,senderPublicKey:u}}if(pi(r)===Fr){const c=t.slice(s),h=tr(wr);return{type:r,sealed:c,iv:h}}const n=s+wr,o=t.slice(s,n),a=t.slice(n);return{type:r,sealed:a,iv:o}}function Qb(i,e){const t=Or({encoded:i,encoding:e?.encoding});return pl({type:pi(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Me(t.senderPublicKey,je):void 0,receiverPublicKey:e?.receiverPublicKey})}function pl(i){const e=i?.type||cl;if(e===jt){if(typeof i?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof i?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:i?.senderPublicKey,receiverPublicKey:i?.receiverPublicKey}}function hc(i){return i.type===jt&&typeof i.senderPublicKey=="string"&&typeof i.receiverPublicKey=="string"}function uc(i){return i.type===Fr}function Xb(i){const e=_e.from(i.x,"base64"),t=_e.from(i.y,"base64");return mr([new Uint8Array([4]),e,t])}function ev(i,e){const[t,r,s]=i.split("."),n=_e.from(ll(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${t}.${r}`,h=jr(c),u=Xb(e);if(!Hb.verify(mr([o,a]),h,u))throw new Error("Invalid signature");return Bn(i).payload}const tv="irn";function fs(i){return i?.relay||{protocol:tv}}function gr(i){const e=om[i];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${i}`);return e}function iv(i,e="-"){const t={},r="relay"+e;return Object.keys(i).forEach(s=>{if(s.startsWith(r)){const n=s.replace(r,""),o=i[s];t[n]=o}}),t}function lc(i){if(!i.includes("wc:")){const h=ju(i);h!=null&&h.includes("wc:")&&(i=h)}i=i.includes("wc://")?i.replace("wc://",""):i,i=i.includes("wc:")?i.replace("wc:",""):i;const e=i.indexOf(":"),t=i.indexOf("?")!==-1?i.indexOf("?"):void 0,r=i.substring(0,e),s=i.substring(e+1,t).split("@"),n=typeof t<"u"?i.substring(t):"",o=new URLSearchParams(n),a={};o.forEach((h,u)=>{a[u]=h});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:rv(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:iv(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function rv(i){return i.startsWith("//")?i.substring(2):i}function sv(i,e="-"){const t="relay",r={};return Object.keys(i).forEach(s=>{const n=s,o=t+e+n;i[n]&&(r[o]=i[n])}),r}function dc(i){const e=new URLSearchParams,t=sv(i.relay);Object.keys(t).sort().forEach(s=>{e.set(s,t[s])}),e.set("symKey",i.symKey),i.expiryTimestamp&&e.set("expiryTimestamp",i.expiryTimestamp.toString()),i.methods&&e.set("methods",i.methods.join(","));const r=e.toString();return`${i.protocol}:${i.topic}@${i.version}?${r}`}function Gr(i,e,t){return`${i}?wc_ev=${t}&topic=${e}`}var nv=Object.defineProperty,ov=Object.defineProperties,av=Object.getOwnPropertyDescriptors,pc=Object.getOwnPropertySymbols,cv=Object.prototype.hasOwnProperty,hv=Object.prototype.propertyIsEnumerable,fc=(i,e,t)=>e in i?nv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,uv=(i,e)=>{for(var t in e||(e={}))cv.call(e,t)&&fc(i,t,e[t]);if(pc)for(var t of pc(e))hv.call(e,t)&&fc(i,t,e[t]);return i},lv=(i,e)=>ov(i,av(e));function rr(i){const e=[];return i.forEach(t=>{const[r,s]=t.split(":");e.push(`${r}:${s}`)}),e}function dv(i){const e=[];return Object.values(i).forEach(t=>{e.push(...rr(t.accounts))}),e}function pv(i,e){const t=[];return Object.values(i).forEach(r=>{rr(r.accounts).includes(e)&&t.push(...r.methods)}),t}function fv(i,e){const t=[];return Object.values(i).forEach(r=>{rr(r.accounts).includes(e)&&t.push(...r.events)}),t}function As(i){return i.includes(":")}function ki(i){return As(i)?i.split(":")[0]:i}function gc(i){var e,t,r;const s={};if(!Gt(i))return s;for(const[n,o]of Object.entries(i)){const a=As(n)?[n]:o.chains,c=o.methods||[],h=o.events||[],u=ki(n);s[u]=lv(uv({},s[u]),{chains:_t(a,(e=s[u])==null?void 0:e.chains),methods:_t(c,(t=s[u])==null?void 0:t.methods),events:_t(h,(r=s[u])==null?void 0:r.events)})}return s}function gv(i){const e={};return i?.forEach(t=>{var r;const[s,n]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),(r=e[s].chains)==null||r.push(`${s}:${n}`)}),e}function yc(i,e){e=e.map(r=>r.replace("did:pkh:",""));const t=gv(e);for(const[r,s]of Object.entries(t))s.methods?s.methods=_t(s.methods,i):s.methods=i,s.events=["chainChanged","accountsChanged"];return t}function yv(i,e){var t,r,s,n,o,a;const c=gc(i),h=gc(e),u={},l=Object.keys(c).concat(Object.keys(h));for(const d of l)u[d]={chains:_t((t=c[d])==null?void 0:t.chains,(r=h[d])==null?void 0:r.chains),methods:_t((s=c[d])==null?void 0:s.methods,(n=h[d])==null?void 0:n.methods),events:_t((o=c[d])==null?void 0:o.events,(a=h[d])==null?void 0:a.events)};return u}const mv={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},wv={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function F(i,e){const{message:t,code:r}=wv[i];return{message:e?`${t} ${e}`:t,code:r}}function ie(i,e){const{message:t,code:r}=mv[i];return{message:e?`${t} ${e}`:t,code:r}}function dt(i,e){return!!Array.isArray(i)}function Gt(i){return Object.getPrototypeOf(i)===Object.prototype&&Object.keys(i).length}function Pe(i){return typeof i>"u"}function de(i,e){return e&&Pe(i)?!0:typeof i=="string"&&!!i.trim().length}function xo(i,e){return e&&Pe(i)?!0:typeof i=="number"&&!isNaN(i)}function bv(i,e){const{requiredNamespaces:t}=e,r=Object.keys(i.namespaces),s=Object.keys(t);let n=!0;return oi(s,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:h}=i.namespaces[o],u=rr(a),l=t[o];(!oi(Au(o,l),u)||!oi(l.methods,c)||!oi(l.events,h))&&(n=!1)}),n):!1}function gs(i){return de(i,!1)&&i.includes(":")?i.split(":").length===2:!1}function vv(i){if(de(i,!1)&&i.includes(":")){const e=i.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&gs(t)}}return!1}function Ev(i){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(de(i,!1)){if(e(i))return!0;const t=ju(i);return e(t)}}catch{}return!1}function _v(i){var e;return(e=i?.proposer)==null?void 0:e.publicKey}function Iv(i){return i?.topic}function Dv(i,e){let t=null;return de(i?.publicKey,!1)||(t=F("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function mc(i){let e=!0;return dt(i)?i.length&&(e=i.every(t=>de(t,!1))):e=!1,e}function $v(i,e,t){let r=null;return dt(e)&&e.length?e.forEach(s=>{r||gs(s)||(r=ie("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):gs(i)||(r=ie("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function Sv(i,e,t){let r=null;return Object.entries(i).forEach(([s,n])=>{if(r)return;const o=$v(s,Au(s,n),`${e} ${t}`);o&&(r=o)}),r}function Pv(i,e){let t=null;return dt(i)?i.forEach(r=>{t||vv(r)||(t=ie("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=ie("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Ov(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=Pv(r?.accounts,`${e} namespace`);s&&(t=s)}),t}function Cv(i,e){let t=null;return mc(i?.methods)?mc(i?.events)||(t=ie("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=ie("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function fl(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=Cv(r,`${e}, namespace`);s&&(t=s)}),t}function Av(i,e,t){let r=null;if(i&&Gt(i)){const s=fl(i,e);s&&(r=s);const n=Sv(i,e,t);n&&(r=n)}else r=F("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return r}function pn(i,e){let t=null;if(i&&Gt(i)){const r=fl(i,e);r&&(t=r);const s=Ov(i,e);s&&(t=s)}else t=F("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function gl(i){return de(i.protocol,!0)}function xv(i,e){let t=!1;return i?i&&dt(i)&&i.length&&i.forEach(r=>{t=gl(r)}):t=!0,t}function Nv(i){return typeof i=="number"}function Le(i){return typeof i<"u"&&typeof i!==null}function Tv(i){return!(!i||typeof i!="object"||!i.code||!xo(i.code,!1)||!i.message||!de(i.message,!1))}function Rv(i){return!(Pe(i)||!de(i.method,!1))}function jv(i){return!(Pe(i)||Pe(i.result)&&Pe(i.error)||!xo(i.id,!1)||!de(i.jsonrpc,!1))}function Uv(i){return!(Pe(i)||!de(i.name,!1))}function wc(i,e){return!(!gs(e)||!dv(i).includes(e))}function qv(i,e,t){return de(t,!1)?pv(i,e).includes(t):!1}function Fv(i,e,t){return de(t,!1)?fv(i,e).includes(t):!1}function bc(i,e,t){let r=null;const s=Bv(i),n=Lv(e),o=Object.keys(s),a=Object.keys(n),c=vc(Object.keys(i)),h=vc(Object.keys(e)),u=c.filter(l=>!h.includes(l));return u.length&&(r=F("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),oi(o,a)||(r=F("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||r)return;const d=rr(e[l].accounts);d.includes(l)||(r=F("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${d.toString()}`))}),o.forEach(l=>{r||(oi(s[l].methods,n[l].methods)?oi(s[l].events,n[l].events)||(r=F("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${l}`)):r=F("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${l}`))}),r}function Bv(i){const e={};return Object.keys(i).forEach(t=>{var r;t.includes(":")?e[t]=i[t]:(r=i[t].chains)==null||r.forEach(s=>{e[s]={methods:i[t].methods,events:i[t].events}})}),e}function vc(i){return[...new Set(i.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Lv(i){const e={};return Object.keys(i).forEach(t=>{t.includes(":")?e[t]=i[t]:rr(i[t].accounts)?.forEach(s=>{e[s]={accounts:i[t].accounts.filter(n=>n.includes(`${s}:`)),methods:i[t].methods,events:i[t].events}})}),e}function kv(i,e){return xo(i,!1)&&i<=e.max&&i>=e.min}function Ec(){const i=Tr();return new Promise(e=>{switch(i){case Ye.browser:e(Mv());break;case Ye.reactNative:e(zv());break;case Ye.node:e(Hv());break;default:e(!0)}})}function Mv(){return er()&&navigator?.onLine}async function zv(){return Yt()&&typeof H<"u"&&H!=null&&H.NetInfo?(await(H==null?void 0:H.NetInfo.fetch()))?.isConnected:!0}function Hv(){return!0}function Vv(i){switch(Tr()){case Ye.browser:Kv(i);break;case Ye.reactNative:Wv(i);break}}function Kv(i){!Yt()&&er()&&(window.addEventListener("online",()=>i(!0)),window.addEventListener("offline",()=>i(!1)))}function Wv(i){Yt()&&typeof H<"u"&&H!=null&&H.NetInfo&&H?.NetInfo.addEventListener(e=>i(e?.isConnected))}function Gv(){var i;return er()&&Ut.getDocument()?((i=Ut.getDocument())==null?void 0:i.visibilityState)==="visible":!0}const fn={};class hr{static get(e){return fn[e]}static set(e,t){fn[e]=t}static delete(e){delete fn[e]}}class gi{}let Yv=class extends gi{constructor(e){super()}};const _c=q.FIVE_SECONDS,yi={pulse:"heartbeat_pulse"};let Jv=class yl extends Yv{constructor(e){super(e),this.events=new rt.EventEmitter,this.interval=_c,this.interval=e?.interval||_c}static async init(e){const t=new yl(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),q.toMiliseconds(this.interval))}pulse(){this.events.emit(yi.pulse)}};const Zv=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Qv=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Xv=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function e0(i,e){if(i==="__proto__"||i==="constructor"&&e&&typeof e=="object"&&"prototype"in e){t0(i);return}return e}function t0(i){console.warn(`[destr] Dropping "${i}" key to prevent prototype pollution.`)}function Yr(i,e={}){if(typeof i!="string")return i;if(i[0]==='"'&&i[i.length-1]==='"'&&i.indexOf("\\")===-1)return i.slice(1,-1);const t=i.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Xv.test(i)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return i}try{if(Zv.test(i)||Qv.test(i)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(i,e0)}return JSON.parse(i)}catch(r){if(e.strict)throw r;return i}}function i0(i){return!i||typeof i.then!="function"?Promise.resolve(i):i}function me(i,...e){try{return i0(i(...e))}catch(t){return Promise.reject(t)}}function r0(i){const e=typeof i;return i===null||e!=="object"&&e!=="function"}function s0(i){const e=Object.getPrototypeOf(i);return!e||e.isPrototypeOf(Object)}function os(i){if(r0(i))return String(i);if(s0(i)||Array.isArray(i))return JSON.stringify(i);if(typeof i.toJSON=="function")return os(i.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Qn="base64:";function n0(i){return typeof i=="string"?i:Qn+c0(i)}function o0(i){return typeof i!="string"||!i.startsWith(Qn)?i:a0(i.slice(Qn.length))}function a0(i){return globalThis.Buffer?_e.from(i,"base64"):Uint8Array.from(globalThis.atob(i),e=>e.codePointAt(0))}function c0(i){return globalThis.Buffer?_e.from(i).toString("base64"):globalThis.btoa(String.fromCodePoint(...i))}function Be(i){return i&&i.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function h0(...i){return Be(i.join(":"))}function Jr(i){return i=Be(i),i?i+":":""}function u0(i,e){if(e===void 0)return!0;let t=0,r=i.indexOf(":");for(;r>-1;)t++,r=i.indexOf(":",r+1);return t<=e}function l0(i,e){return e?i.startsWith(e)&&i[i.length-1]!=="$":i[i.length-1]!=="$"}const d0="memory",p0=()=>{const i=new Map;return{name:d0,getInstance:()=>i,hasItem(e){return i.has(e)},getItem(e){return i.get(e)??null},getItemRaw(e){return i.get(e)??null},setItem(e,t){i.set(e,t)},setItemRaw(e,t){i.set(e,t)},removeItem(e){i.delete(e)},getKeys(){return[...i.keys()]},clear(){i.clear()},dispose(){i.clear()}}};function f0(i={}){const e={mounts:{"":i.driver||p0()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=h=>{for(const u of e.mountpoints)if(h.startsWith(u))return{base:u,relativeKey:h.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:h,driver:e.mounts[""]}},r=(h,u)=>e.mountpoints.filter(l=>l.startsWith(h)||u&&h.startsWith(l)).map(l=>({relativeBase:h.length>l.length?h.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),s=(h,u)=>{if(e.watching){u=Be(u);for(const l of e.watchListeners)l(h,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const h in e.mounts)e.unwatch[h]=await Ic(e.mounts[h],s,h)}},o=async()=>{if(e.watching){for(const h in e.unwatch)await e.unwatch[h]();e.unwatch={},e.watching=!1}},a=(h,u,l)=>{const d=new Map,f=p=>{let g=d.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},d.set(p.base,g)),g};for(const p of h){const g=typeof p=="string",y=Be(g?p:p.key),v=g?void 0:p.value,m=g||!p.options?u:{...u,...p.options},b=t(y);f(b).items.push({key:y,value:v,relativeKey:b.relativeKey,options:m})}return Promise.all([...d.values()].map(p=>l(p))).then(p=>p.flat())},c={hasItem(h,u={}){h=Be(h);const{relativeKey:l,driver:d}=t(h);return me(d.hasItem,l,u)},getItem(h,u={}){h=Be(h);const{relativeKey:l,driver:d}=t(h);return me(d.getItem,l,u).then(f=>Yr(f))},getItems(h,u={}){return a(h,u,l=>l.driver.getItems?me(l.driver.getItems,l.items.map(d=>({key:d.relativeKey,options:d.options})),u).then(d=>d.map(f=>({key:h0(l.base,f.key),value:Yr(f.value)}))):Promise.all(l.items.map(d=>me(l.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:Yr(f)})))))},getItemRaw(h,u={}){h=Be(h);const{relativeKey:l,driver:d}=t(h);return d.getItemRaw?me(d.getItemRaw,l,u):me(d.getItem,l,u).then(f=>o0(f))},async setItem(h,u,l={}){if(u===void 0)return c.removeItem(h);h=Be(h);const{relativeKey:d,driver:f}=t(h);f.setItem&&(await me(f.setItem,d,os(u),l),f.watch||s("update",h))},async setItems(h,u){await a(h,u,async l=>{if(l.driver.setItems)return me(l.driver.setItems,l.items.map(d=>({key:d.relativeKey,value:os(d.value),options:d.options})),u);l.driver.setItem&&await Promise.all(l.items.map(d=>me(l.driver.setItem,d.relativeKey,os(d.value),d.options)))})},async setItemRaw(h,u,l={}){if(u===void 0)return c.removeItem(h,l);h=Be(h);const{relativeKey:d,driver:f}=t(h);if(f.setItemRaw)await me(f.setItemRaw,d,u,l);else if(f.setItem)await me(f.setItem,d,n0(u),l);else return;f.watch||s("update",h)},async removeItem(h,u={}){typeof u=="boolean"&&(u={removeMeta:u}),h=Be(h);const{relativeKey:l,driver:d}=t(h);d.removeItem&&(await me(d.removeItem,l,u),(u.removeMeta||u.removeMata)&&await me(d.removeItem,l+"$",u),d.watch||s("remove",h))},async getMeta(h,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),h=Be(h);const{relativeKey:l,driver:d}=t(h),f=Object.create(null);if(d.getMeta&&Object.assign(f,await me(d.getMeta,l,u)),!u.nativeOnly){const p=await me(d.getItem,l+"$",u).then(g=>Yr(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(f,p))}return f},setMeta(h,u,l={}){return this.setItem(h+"$",u,l)},removeMeta(h,u={}){return this.removeItem(h+"$",u)},async getKeys(h,u={}){h=Jr(h);const l=r(h,!0);let d=[];const f=[];let p=!0;for(const y of l){y.driver.flags?.maxDepth||(p=!1);const v=await me(y.driver.getKeys,y.relativeBase,u);for(const m of v){const b=y.mountpoint+Be(m);d.some(P=>b.startsWith(P))||f.push(b)}d=[y.mountpoint,...d.filter(m=>!m.startsWith(y.mountpoint))]}const g=u.maxDepth!==void 0&&!p;return f.filter(y=>(!g||u0(y,u.maxDepth))&&l0(y,h))},async clear(h,u={}){h=Jr(h),await Promise.all(r(h,!1).map(async l=>{if(l.driver.clear)return me(l.driver.clear,l.relativeBase,u);if(l.driver.removeItem){const d=await l.driver.getKeys(l.relativeBase||"",u);return Promise.all(d.map(f=>l.driver.removeItem(f,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(h=>Dc(h)))},async watch(h){return await n(),e.watchListeners.push(h),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==h),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(h,u){if(h=Jr(h),h&&e.mounts[h])throw new Error(`already mounted at ${h}`);return h&&(e.mountpoints.push(h),e.mountpoints.sort((l,d)=>d.length-l.length)),e.mounts[h]=u,e.watching&&Promise.resolve(Ic(u,s,h)).then(l=>{e.unwatch[h]=l}).catch(console.error),c},async unmount(h,u=!0){h=Jr(h),!(!h||!e.mounts[h])&&(e.watching&&h in e.unwatch&&(e.unwatch[h]?.(),delete e.unwatch[h]),u&&await Dc(e.mounts[h]),e.mountpoints=e.mountpoints.filter(l=>l!==h),delete e.mounts[h])},getMount(h=""){h=Be(h)+":";const u=t(h);return{driver:u.driver,base:u.base}},getMounts(h="",u={}){return h=Be(h),r(h,u.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(h,u={})=>c.getKeys(h,u),get:(h,u={})=>c.getItem(h,u),set:(h,u,l={})=>c.setItem(h,u,l),has:(h,u={})=>c.hasItem(h,u),del:(h,u={})=>c.removeItem(h,u),remove:(h,u={})=>c.removeItem(h,u)};return c}function Ic(i,e,t){return i.watch?i.watch((r,s)=>e(r,t+s)):()=>{}}async function Dc(i){typeof i.dispose=="function"&&await me(i.dispose)}const g0="idb-keyval";var y0=(i={})=>{const e=i.base&&i.base.length>0?`${i.base}:`:"",t=s=>e+s;let r;return i.dbName&&i.storeName&&(r=Fh(i.dbName,i.storeName)),{name:g0,options:i,async hasItem(s){return!(typeof await Ko(t(s),r)>"u")},async getItem(s){return await Ko(t(s),r)??null},setItem(s,n){return fd(t(s),n,r)},removeItem(s){return gd(t(s),r)},getKeys(){return wd(r)},clear(){return yd(r)}}};const m0="WALLET_CONNECT_V2_INDEXED_DB",w0="keyvaluestorage";let b0=class{constructor(){this.indexedDb=f0({driver:y0({dbName:m0,storeName:w0})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,qt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var gn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof H<"u"?H:typeof self<"u"?self:{},as={exports:{}};(function(){let i;function e(){}i=e,i.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},i.prototype.setItem=function(t,r){this[t]=String(r)},i.prototype.removeItem=function(t){delete this[t]},i.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(r){t[r]=void 0,delete t[r]})},i.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof gn<"u"&&gn.localStorage?as.exports=gn.localStorage:typeof window<"u"&&window.localStorage?as.exports=window.localStorage:as.exports=new e})();function v0(i){var e;return[i[0],ui((e=i[1])!=null?e:"")]}let E0=class{constructor(){this.localStorage=as.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(v0)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return ui(t)}async setItem(e,t){this.localStorage.setItem(e,qt(t))}async removeItem(e){this.localStorage.removeItem(e)}};const _0="wc_storage_version",$c=1,I0=async(i,e,t)=>{const r=_0,s=await e.getItem(r);if(s&&s>=$c){t(e);return}const n=await i.getKeys();if(!n.length){t(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const h=await i.getItem(a);await e.setItem(a,h),o.push(a)}}await e.setItem(r,$c),t(e),D0(i,o)},D0=async(i,e)=>{e.length&&e.forEach(async t=>{await i.removeItem(t)})};let $0=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new E0;this.storage=e;try{const t=new b0;I0(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var yn,Sc;function S0(){if(Sc)return yn;Sc=1;function i(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}yn=e;function e(t,r,s){var n=s&&s.stringify||i,o=1;if(typeof t=="object"&&t!==null){var a=r.length+o;if(a===1)return t;var c=new Array(a);c[0]=n(t);for(var h=1;h<a;h++)c[h]=n(r[h]);return c.join(" ")}if(typeof t!="string")return t;var u=r.length;if(u===0)return t;for(var l="",d=1-o,f=-1,p=t&&t.length||0,g=0;g<p;){if(t.charCodeAt(g)===37&&g+1<p){switch(f=f>-1?f:0,t.charCodeAt(g+1)){case 100:case 102:if(d>=u||r[d]==null)break;f<g&&(l+=t.slice(f,g)),l+=Number(r[d]),f=g+2,g++;break;case 105:if(d>=u||r[d]==null)break;f<g&&(l+=t.slice(f,g)),l+=Math.floor(Number(r[d])),f=g+2,g++;break;case 79:case 111:case 106:if(d>=u||r[d]===void 0)break;f<g&&(l+=t.slice(f,g));var y=typeof r[d];if(y==="string"){l+="'"+r[d]+"'",f=g+2,g++;break}if(y==="function"){l+=r[d].name||"<anonymous>",f=g+2,g++;break}l+=n(r[d]),f=g+2,g++;break;case 115:if(d>=u)break;f<g&&(l+=t.slice(f,g)),l+=String(r[d]),f=g+2,g++;break;case 37:f<g&&(l+=t.slice(f,g)),l+="%",f=g+2,g++,d--;break}++d}++g}return f===-1?t:(f<p&&(l+=t.slice(f)),l)}return yn}var mn,Pc;function P0(){if(Pc)return mn;Pc=1;const i=S0();mn=s;const e=A().console||{},t={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:d};function r(w,_){return Array.isArray(w)?w.filter(function(I){return I!=="!stdSerializers.err"}):w===!0?Object.keys(_):!1}function s(w){w=w||{},w.browser=w.browser||{};const _=w.browser.transmit;if(_&&typeof _.send!="function")throw Error("pino: transmit option must have a send function");const D=w.browser.write||e;w.browser.write&&(w.browser.asObject=!0);const I=w.serializers||{},j=r(w.browser.serialize,I);let R=w.browser.serialize;Array.isArray(w.browser.serialize)&&w.browser.serialize.indexOf("!stdSerializers.err")>-1&&(R=!1);const U=["error","fatal","warn","info","debug","trace"];typeof D=="function"&&(D.error=D.fatal=D.warn=D.info=D.debug=D.trace=D),w.enabled===!1&&(w.level="silent");const k=w.level||"info",$=Object.create(D);$.log||($.log=y),Object.defineProperty($,"levelVal",{get:E}),Object.defineProperty($,"level",{get:C,set:x});const S={transmit:_,serialize:j,asObject:w.browser.asObject,levels:U,timestamp:f(w)};$.levels=s.levels,$.level=k,$.setMaxListeners=$.getMaxListeners=$.emit=$.addListener=$.on=$.prependListener=$.once=$.prependOnceListener=$.removeListener=$.removeAllListeners=$.listeners=$.listenerCount=$.eventNames=$.write=$.flush=y,$.serializers=I,$._serialize=j,$._stdErrSerialize=R,$.child=O,_&&($._logEvent=l());function E(){return this.level==="silent"?1/0:this.levels.values[this.level]}function C(){return this._level}function x(N){if(N!=="silent"&&!this.levels.values[N])throw Error("unknown level "+N);this._level=N,n(S,$,"error","log"),n(S,$,"fatal","error"),n(S,$,"warn","error"),n(S,$,"info","log"),n(S,$,"debug","log"),n(S,$,"trace","log")}function O(N,B){if(!N)throw new Error("missing bindings for child Pino");B=B||{},j&&N.serializers&&(B.serializers=N.serializers);const L=B.serializers;if(j&&L){var M=Object.assign({},I,L),z=w.browser.serialize===!0?Object.keys(M):j;delete N.serializers,c([N],z,M,this._stdErrSerialize)}function K(V){this._childLevel=(V._childLevel|0)+1,this.error=h(V,N,"error"),this.fatal=h(V,N,"fatal"),this.warn=h(V,N,"warn"),this.info=h(V,N,"info"),this.debug=h(V,N,"debug"),this.trace=h(V,N,"trace"),M&&(this.serializers=M,this._serialize=z),_&&(this._logEvent=l([].concat(V._logEvent.bindings,N)))}return K.prototype=this,new K(this)}return $}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:v,epochTime:m,unixTime:b,isoTime:P});function n(w,_,D,I){const j=Object.getPrototypeOf(_);_[D]=_.levelVal>_.levels.values[D]?y:j[D]?j[D]:e[D]||e[I]||y,o(w,_,D)}function o(w,_,D){!w.transmit&&_[D]===y||(_[D]=(function(I){return function(){const R=w.timestamp(),U=new Array(arguments.length),k=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var $=0;$<U.length;$++)U[$]=arguments[$];if(w.serialize&&!w.asObject&&c(U,this._serialize,this.serializers,this._stdErrSerialize),w.asObject?I.call(k,a(this,D,U,R)):I.apply(k,U),w.transmit){const S=w.transmit.level||_.level,E=s.levels.values[S],C=s.levels.values[D];if(C<E)return;u(this,{ts:R,methodLevel:D,methodValue:C,transmitValue:s.levels.values[w.transmit.level||_.level],send:w.transmit.send,val:_.levelVal},U)}}})(_[D]))}function a(w,_,D,I){w._serialize&&c(D,w._serialize,w.serializers,w._stdErrSerialize);const j=D.slice();let R=j[0];const U={};I&&(U.time=I),U.level=s.levels.values[_];let k=(w._childLevel|0)+1;if(k<1&&(k=1),R!==null&&typeof R=="object"){for(;k--&&typeof j[0]=="object";)Object.assign(U,j.shift());R=j.length?i(j.shift(),j):void 0}else typeof R=="string"&&(R=i(j.shift(),j));return R!==void 0&&(U.msg=R),U}function c(w,_,D,I){for(const j in w)if(I&&w[j]instanceof Error)w[j]=s.stdSerializers.err(w[j]);else if(typeof w[j]=="object"&&!Array.isArray(w[j]))for(const R in w[j])_&&_.indexOf(R)>-1&&R in D&&(w[j][R]=D[R](w[j][R]))}function h(w,_,D){return function(){const I=new Array(1+arguments.length);I[0]=_;for(var j=1;j<I.length;j++)I[j]=arguments[j-1];return w[D].apply(this,I)}}function u(w,_,D){const I=_.send,j=_.ts,R=_.methodLevel,U=_.methodValue,k=_.val,$=w._logEvent.bindings;c(D,w._serialize||Object.keys(w.serializers),w.serializers,w._stdErrSerialize===void 0?!0:w._stdErrSerialize),w._logEvent.ts=j,w._logEvent.messages=D.filter(function(S){return $.indexOf(S)===-1}),w._logEvent.level.label=R,w._logEvent.level.value=U,I(R,w._logEvent,k),w._logEvent=l($)}function l(w){return{ts:0,messages:[],bindings:w||[],level:{label:"",value:0}}}function d(w){const _={type:w.constructor.name,msg:w.message,stack:w.stack};for(const D in w)_[D]===void 0&&(_[D]=w[D]);return _}function f(w){return typeof w.timestamp=="function"?w.timestamp:w.timestamp===!1?v:m}function p(){return{}}function g(w){return w}function y(){}function v(){return!1}function m(){return Date.now()}function b(){return Math.round(Date.now()/1e3)}function P(){return new Date(Date.now()).toISOString()}function A(){function w(_){return typeof _<"u"&&_}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return w(self)||w(window)||w(this)||{}}}return mn}var Fi=P0();const Br=pd(Fi),O0={level:"info"},Lr="custom_context",No=1e3*1024;let C0=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Oc=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new C0(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},ml=class{constructor(e,t=No){this.level=e??"error",this.levelValue=Fi.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new Oc(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Fi.levels.values.error?console.error(e):t===Fi.levels.values.warn?console.warn(e):t===Fi.levels.values.debug?console.debug(e):t===Fi.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(qt({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new Oc(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(qt({extraMetadata:e})),new Blob(t,{type:"application/json"})}},A0=class{constructor(e,t=No){this.baseChunkLogger=new ml(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=t,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}},x0=class{constructor(e,t=No){this.baseChunkLogger=new ml(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var N0=Object.defineProperty,T0=Object.defineProperties,R0=Object.getOwnPropertyDescriptors,Cc=Object.getOwnPropertySymbols,j0=Object.prototype.hasOwnProperty,U0=Object.prototype.propertyIsEnumerable,Ac=(i,e,t)=>e in i?N0(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ys=(i,e)=>{for(var t in e||(e={}))j0.call(e,t)&&Ac(i,t,e[t]);if(Cc)for(var t of Cc(e))U0.call(e,t)&&Ac(i,t,e[t]);return i},ms=(i,e)=>T0(i,R0(e));function xs(i){return ms(ys({},i),{level:i?.level||O0.level})}function q0(i,e=Lr){return i[e]||""}function F0(i,e,t=Lr){return i[t]=e,i}function ze(i,e=Lr){let t="";return typeof i.bindings>"u"?t=q0(i,e):t=i.bindings().context||"",t}function B0(i,e,t=Lr){const r=ze(i,t);return r.trim()?`${r}/${e}`:e}function Ue(i,e,t=Lr){const r=B0(i,e,t),s=i.child({context:r});return F0(s,r,t)}function L0(i){var e,t;const r=new A0((e=i.opts)==null?void 0:e.level,i.maxSizeInBytes);return{logger:Br(ms(ys({},i.opts),{level:"trace",browser:ms(ys({},(t=i.opts)==null?void 0:t.browser),{write:s=>r.write(s)})})),chunkLoggerController:r}}function k0(i){var e;const t=new x0((e=i.opts)==null?void 0:e.level,i.maxSizeInBytes);return{logger:Br(ms(ys({},i.opts),{level:"trace"}),t),chunkLoggerController:t}}function M0(i){return typeof i.loggerOverride<"u"&&typeof i.loggerOverride!="string"?{logger:i.loggerOverride,chunkLoggerController:null}:typeof window<"u"?L0(i):k0(i)}var z0=Object.defineProperty,H0=(i,e,t)=>e in i?z0(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,xc=(i,e,t)=>H0(i,typeof e!="symbol"?e+"":e,t);let V0=class extends gi{constructor(e){super(),this.opts=e,xc(this,"protocol","wc"),xc(this,"version",2)}};var K0=Object.defineProperty,W0=(i,e,t)=>e in i?K0(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,G0=(i,e,t)=>W0(i,e+"",t);let Y0=class extends gi{constructor(e,t){super(),this.core=e,this.logger=t,G0(this,"records",new Map)}},J0=class{constructor(e,t){this.logger=e,this.core=t}};class Z0 extends gi{constructor(e,t){super(),this.relayer=e,this.logger=t}}let Q0=class extends gi{constructor(e){super()}},X0=class{constructor(e,t,r,s){this.core=e,this.logger=t,this.name=r}},eE=class extends gi{constructor(e,t){super(),this.relayer=e,this.logger=t}},tE=class extends gi{constructor(e,t){super(),this.core=e,this.logger=t}},iE=class{constructor(e,t,r){this.core=e,this.logger=t,this.store=r}},rE=class{constructor(e,t){this.projectId=e,this.logger=t}},sE=class{constructor(e,t,r){this.core=e,this.logger=t,this.telemetryEnabled=r}};var nE=Object.defineProperty,oE=(i,e,t)=>e in i?nE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Nc=(i,e,t)=>oE(i,typeof e!="symbol"?e+"":e,t);let aE=class{constructor(e){this.opts=e,Nc(this,"protocol","wc"),Nc(this,"version",2)}},cE=class{constructor(e){this.client=e}};const hE="PARSE_ERROR",uE="INVALID_REQUEST",lE="METHOD_NOT_FOUND",dE="INVALID_PARAMS",wl="INTERNAL_ERROR",To="SERVER_ERROR",pE=[-32700,-32600,-32601,-32602,-32603],br={[hE]:{code:-32700,message:"Parse error"},[uE]:{code:-32600,message:"Invalid Request"},[lE]:{code:-32601,message:"Method not found"},[dE]:{code:-32602,message:"Invalid params"},[wl]:{code:-32603,message:"Internal error"},[To]:{code:-32e3,message:"Server error"}},bl=To;function fE(i){return pE.includes(i)}function Tc(i){return Object.keys(br).includes(i)?br[i]:br[bl]}function gE(i){const e=Object.values(br).find(t=>t.code===i);return e||br[bl]}function vl(i,e,t){return i.message.includes("getaddrinfo ENOTFOUND")||i.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):i}var wn={},Ct={},Rc;function yE(){if(Rc)return Ct;Rc=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.isBrowserCryptoAvailable=Ct.getSubtleCrypto=Ct.getBrowerCrypto=void 0;function i(){return(vi===null||vi===void 0?void 0:vi.crypto)||(vi===null||vi===void 0?void 0:vi.msCrypto)||{}}Ct.getBrowerCrypto=i;function e(){const r=i();return r.subtle||r.webkitSubtle}Ct.getSubtleCrypto=e;function t(){return!!i()&&!!e()}return Ct.isBrowserCryptoAvailable=t,Ct}var At={},jc;function mE(){if(jc)return At;jc=1,Object.defineProperty(At,"__esModule",{value:!0}),At.isBrowser=At.isNode=At.isReactNative=void 0;function i(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}At.isReactNative=i;function e(){return typeof Kt<"u"&&typeof Kt.versions<"u"&&typeof Kt.versions.node<"u"}At.isNode=e;function t(){return!i()&&!e()}return At.isBrowser=t,At}var Uc;function wE(){return Uc||(Uc=1,(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=Ar;e.__exportStar(yE(),i),e.__exportStar(mE(),i)})(wn)),wn}var bE=wE();function bt(i=3){const e=Date.now()*Math.pow(10,i),t=Math.floor(Math.random()*Math.pow(10,i));return e+t}function ai(i=6){return BigInt(bt(i))}function Vt(i,e,t){return{id:t||bt(),jsonrpc:"2.0",method:i,params:e}}function Ns(i,e){return{id:i,jsonrpc:"2.0",result:e}}function Ts(i,e,t){return{id:i,jsonrpc:"2.0",error:vE(e)}}function vE(i,e){return typeof i>"u"?Tc(wl):(typeof i=="string"&&(i=Object.assign(Object.assign({},Tc(To)),{message:i})),fE(i.code)&&(i=gE(i.code)),i)}class EE{}class _E extends EE{constructor(){super()}}class IE extends _E{constructor(e){super()}}const DE="^https?:",$E="^wss?:";function SE(i){const e=i.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function El(i,e){const t=SE(i);return typeof t>"u"?!1:new RegExp(e).test(t)}function qc(i){return El(i,DE)}function Fc(i){return El(i,$E)}function PE(i){return new RegExp("wss?://localhost(:d{2,5})?").test(i)}function _l(i){return typeof i=="object"&&"id"in i&&"jsonrpc"in i&&i.jsonrpc==="2.0"}function Ro(i){return _l(i)&&"method"in i}function Rs(i){return _l(i)&&(vt(i)||tt(i))}function vt(i){return"result"in i}function tt(i){return"error"in i}class st extends IE{constructor(e){super(e),this.events=new rt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Vt(e.method,e.params||[],e.id||ai().toString()),t)}async requestStrict(e,t){return new Promise(async(r,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{tt(n)?s(n.error):r(n.result)});try{await this.connection.send(e,t)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Rs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const OE=()=>typeof WebSocket<"u"?WebSocket:typeof H<"u"&&typeof H.WebSocket<"u"?H.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),CE=()=>typeof WebSocket<"u"||typeof H<"u"&&typeof H.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Bc=i=>i.split("?")[0],Lc=10,AE=OE();let xE=class{constructor(e){if(this.url=e,this.events=new rt.EventEmitter,this.registering=!1,!Fc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(qt(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Fc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((r,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,r)=>{const s=bE.isReactNative()?void 0:{rejectUnauthorized:!PE(e)},n=new AE(e,[],s);CE()?n.onerror=o=>{const a=o;r(this.emitError(a.error))}:n.on("error",o=>{r(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),t(n)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?ui(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),s=r.message||r.toString(),n=Ts(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return vl(e,Bc(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Lc&&this.events.setMaxListeners(Lc)}emitError(e){const t=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Bc(this.url)}`));return this.events.emit("register_error",t),t}};var NE={};const Il="wc",Dl=2,Xn="core",It=`${Il}@2:${Xn}:`,TE={logger:"error"},RE={database:":memory:"},jE="crypto",kc="client_ed25519_seed",UE=q.ONE_DAY,qE="keychain",FE="0.3",BE="messages",LE="0.3",Mc=q.SIX_HOURS,kE="publisher",$l="irn",ME="error",Sl="wss://relay.walletconnect.org",zE="relayer",be={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},HE="_subscription",Qe={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},VE=.1,eo="2.21.1",ce={link_mode:"link_mode",relay:"relay"},cs={inbound:"inbound",outbound:"outbound"},KE="0.3",WE="WALLETCONNECT_CLIENT_ID",zc="WALLETCONNECT_LINK_MODE_APPS",Ke={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},GE="subscription",YE="0.3",JE="pairing",ZE="0.3",ur={wc_pairingDelete:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:q.ONE_DAY,prompt:!1,tag:0},res:{ttl:q.ONE_DAY,prompt:!1,tag:0}}},si={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},at={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},QE="history",XE="0.3",e1="expirer",et={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},t1="0.3",i1="verify-api",r1="https://verify.walletconnect.com",Pl="https://verify.walletconnect.org",vr=Pl,s1=`${vr}/v3`,n1=[r1,Pl],o1="echo",a1="https://echo.walletconnect.com",wt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},xt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},ct={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Qt={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Xt={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},lr={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},c1=.1,h1="event-client",u1=86400,l1="https://pulse.walletconnect.org/batch";function d1(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var n=i.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=i.length,c=i.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,v=0,m=p.length;v!==m&&p[v]===0;)v++,g++;for(var b=(m-v)*u+1>>>0,P=new Uint8Array(b);v!==m;){for(var A=p[v],w=0,_=b-1;(A!==0||w<y)&&_!==-1;_--,w++)A+=256*P[_]>>>0,P[_]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");y=w,v++}for(var D=b-y;D!==b&&P[D]===0;)D++;for(var I=c.repeat(g);D<b;++D)I+=i.charAt(P[D]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,v=0;p[g]===c;)y++,g++;for(var m=(p.length-g)*h+1>>>0,b=new Uint8Array(m);p[g];){var P=t[p.charCodeAt(g)];if(P===255)return;for(var A=0,w=m-1;(P!==0||A<v)&&w!==-1;w--,A++)P+=a*b[w]>>>0,b[w]=P%256>>>0,P=P/256>>>0;if(P!==0)throw new Error("Non-zero carry");v=A,g++}if(p[g]!==" "){for(var _=m-v;_!==m&&b[_]===0;)_++;for(var D=new Uint8Array(y+(m-_)),I=y;_!==m;)D[I++]=b[_++];return D}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:d,decode:f}}var p1=d1,f1=p1;const Ol=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},g1=i=>new TextEncoder().encode(i),y1=i=>new TextDecoder().decode(i);class m1{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class w1{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Cl(this,e)}}class b1{constructor(e){this.decoders=e}or(e){return Cl(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Cl=(i,e)=>new b1({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class v1{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new m1(e,t,r),this.decoder=new w1(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const js=({name:i,prefix:e,encode:t,decode:r})=>new v1(i,e,t,r),kr=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=f1(t,e);return js({prefix:i,name:e,encode:r,decode:n=>Ol(s(n))})},E1=(i,e,t,r)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=i.length;for(;i[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,h=0;for(let u=0;u<n;++u){const l=s[i[u]];if(l===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},_1=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<i.length;++c)for(a=a<<8|i[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),r)for(;n.length*t&7;)n+="=";return n},Ae=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>js({prefix:e,name:i,encode(s){return _1(s,r,t)},decode(s){return E1(s,r,t,i)}}),I1=js({prefix:"\0",name:"identity",encode:i=>y1(i),decode:i=>g1(i)});var D1=Object.freeze({__proto__:null,identity:I1});const $1=Ae({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var S1=Object.freeze({__proto__:null,base2:$1});const P1=Ae({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var O1=Object.freeze({__proto__:null,base8:P1});const C1=kr({prefix:"9",name:"base10",alphabet:"0123456789"});var A1=Object.freeze({__proto__:null,base10:C1});const x1=Ae({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),N1=Ae({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var T1=Object.freeze({__proto__:null,base16:x1,base16upper:N1});const R1=Ae({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),j1=Ae({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),U1=Ae({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),q1=Ae({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),F1=Ae({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),B1=Ae({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),L1=Ae({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),k1=Ae({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),M1=Ae({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var z1=Object.freeze({__proto__:null,base32:R1,base32upper:j1,base32pad:U1,base32padupper:q1,base32hex:F1,base32hexupper:B1,base32hexpad:L1,base32hexpadupper:k1,base32z:M1});const H1=kr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),V1=kr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var K1=Object.freeze({__proto__:null,base36:H1,base36upper:V1});const W1=kr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),G1=kr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Y1=Object.freeze({__proto__:null,base58btc:W1,base58flickr:G1});const J1=Ae({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Z1=Ae({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Q1=Ae({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),X1=Ae({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var e_=Object.freeze({__proto__:null,base64:J1,base64pad:Z1,base64url:Q1,base64urlpad:X1});const Al=Array.from(""),t_=Al.reduce((i,e,t)=>(i[t]=e,i),[]),i_=Al.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function r_(i){return i.reduce((e,t)=>(e+=t_[t],e),"")}function s_(i){const e=[];for(const t of i){const r=i_[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const n_=js({prefix:"",name:"base256emoji",encode:r_,decode:s_});var o_=Object.freeze({__proto__:null,base256emoji:n_}),a_=xl,Hc=128,c_=-128,h_=Math.pow(2,31);function xl(i,e,t){e=e||[],t=t||0;for(var r=t;i>=h_;)e[t++]=i&255|Hc,i/=128;for(;i&c_;)e[t++]=i&255|Hc,i>>>=7;return e[t]=i|0,xl.bytes=t-r+1,e}var u_=to,l_=128,Vc=127;function to(i,r){var t=0,r=r||0,s=0,n=r,o,a=i.length;do{if(n>=a)throw to.bytes=0,new RangeError("Could not decode varint");o=i[n++],t+=s<28?(o&Vc)<<s:(o&Vc)*Math.pow(2,s),s+=7}while(o>=l_);return to.bytes=n-r,t}var d_=Math.pow(2,7),p_=Math.pow(2,14),f_=Math.pow(2,21),g_=Math.pow(2,28),y_=Math.pow(2,35),m_=Math.pow(2,42),w_=Math.pow(2,49),b_=Math.pow(2,56),v_=Math.pow(2,63),E_=function(i){return i<d_?1:i<p_?2:i<f_?3:i<g_?4:i<y_?5:i<m_?6:i<w_?7:i<b_?8:i<v_?9:10},__={encode:a_,decode:u_,encodingLength:E_},Nl=__;const Kc=(i,e,t=0)=>(Nl.encode(i,e,t),e),Wc=i=>Nl.encodingLength(i),io=(i,e)=>{const t=e.byteLength,r=Wc(i),s=r+Wc(t),n=new Uint8Array(s+t);return Kc(i,n,0),Kc(t,n,r),n.set(e,s),new I_(i,t,e,n)};class I_{constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}}const Tl=({name:i,code:e,encode:t})=>new D_(i,e,t);class D_{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?io(this.code,t):t.then(r=>io(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Rl=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),$_=Tl({name:"sha2-256",code:18,encode:Rl("SHA-256")}),S_=Tl({name:"sha2-512",code:19,encode:Rl("SHA-512")});var P_=Object.freeze({__proto__:null,sha256:$_,sha512:S_});const jl=0,O_="identity",Ul=Ol,C_=i=>io(jl,Ul(i)),A_={code:jl,name:O_,encode:Ul,digest:C_};var x_=Object.freeze({__proto__:null,identity:A_});new TextEncoder,new TextDecoder;const Gc={...D1,...S1,...O1,...A1,...T1,...z1,...K1,...Y1,...e_,...o_};({...P_,...x_});function N_(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function ql(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const Yc=ql("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),bn=ql("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=N_(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),T_={utf8:Yc,"utf-8":Yc,hex:Gc.base16,latin1:bn,ascii:bn,binary:bn,...Gc};function R_(i,e="utf8"){const t=T_[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}var j_=Object.defineProperty,U_=(i,e,t)=>e in i?j_(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,yt=(i,e,t)=>U_(i,typeof e!="symbol"?e+"":e,t);class q_{constructor(e,t){this.core=e,this.logger=t,yt(this,"keychain",new Map),yt(this,"name",qE),yt(this,"version",FE),yt(this,"initialized",!1),yt(this,"storagePrefix",It),yt(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),yt(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),yt(this,"set",async(r,s)=>{this.isInitialized(),this.keychain.set(r,s),await this.persist()}),yt(this,"get",r=>{this.isInitialized();const s=this.keychain.get(r);if(typeof s>"u"){const{message:n}=F("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return s}),yt(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=Ue(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ln(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?kn(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var F_=Object.defineProperty,B_=(i,e,t)=>e in i?F_(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$e=(i,e,t)=>B_(i,typeof e!="symbol"?e+"":e,t);class L_{constructor(e,t,r){this.core=e,this.logger=t,$e(this,"name",jE),$e(this,"keychain"),$e(this,"randomSessionIdentifier",Zn()),$e(this,"initialized",!1),$e(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),$e(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),$e(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=Sa(s);return Du(n.publicKey)}),$e(this,"generateKeyPair",()=>{this.isInitialized();const s=Kb();return this.setPrivateKey(s.publicKey,s.privateKey)}),$e(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=Sa(n),a=this.randomSessionIdentifier;return await hy(a,s,UE,o)}),$e(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=Wb(a,n);return this.setSymKey(c,o)}),$e(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||ns(s);return await this.keychain.set(o,s),o}),$e(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),$e(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),$e(this,"encode",async(s,n,o)=>{this.isInitialized();const a=pl(o),c=qt(n);if(uc(a))return Jb(c,o?.encoding);if(hc(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;s=await this.generateSharedKey(d,f)}const h=this.getSymKey(s),{type:u,senderPublicKey:l}=a;return Gb({type:u,symKey:h,message:c,senderPublicKey:l,encoding:o?.encoding})}),$e(this,"decode",async(s,n,o)=>{this.isInitialized();const a=Qb(n,o);if(uc(a)){const c=Zb(n,o?.encoding);return ui(c)}if(hc(a)){const c=a.receiverPublicKey,h=a.senderPublicKey;s=await this.generateSharedKey(c,h)}try{const c=this.getSymKey(s),h=Yb({symKey:c,encoded:n,encoding:o?.encoding});return ui(h)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),$e(this,"getPayloadType",(s,n=lt)=>{const o=Or({encoded:s,encoding:n});return pi(o.type)}),$e(this,"getPayloadSenderPublicKey",(s,n=lt)=>{const o=Or({encoded:s,encoding:n});return o.senderPublicKey?Me(o.senderPublicKey,je):void 0}),this.core=e,this.logger=Ue(t,this.name),this.keychain=r||new q_(this.core,this.logger)}get context(){return ze(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(kc)}catch{e=Zn(),await this.keychain.set(kc,e)}return R_(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var k_=Object.defineProperty,M_=Object.defineProperties,z_=Object.getOwnPropertyDescriptors,Jc=Object.getOwnPropertySymbols,H_=Object.prototype.hasOwnProperty,V_=Object.prototype.propertyIsEnumerable,ro=(i,e,t)=>e in i?k_(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,K_=(i,e)=>{for(var t in e||(e={}))H_.call(e,t)&&ro(i,t,e[t]);if(Jc)for(var t of Jc(e))V_.call(e,t)&&ro(i,t,e[t]);return i},W_=(i,e)=>M_(i,z_(e)),He=(i,e,t)=>ro(i,typeof e!="symbol"?e+"":e,t);class G_ extends J0{constructor(e,t){super(e,t),this.logger=e,this.core=t,He(this,"messages",new Map),He(this,"messagesWithoutClientAck",new Map),He(this,"name",BE),He(this,"version",LE),He(this,"initialized",!1),He(this,"storagePrefix",It),He(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),He(this,"set",async(r,s,n)=>{this.isInitialized();const o=Et(s);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(r,a),n===cs.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,W_(K_({},c),{[o]:s}))}return await this.persist(),o}),He(this,"get",r=>{this.isInitialized();let s=this.messages.get(r);return typeof s>"u"&&(s={}),s}),He(this,"getWithoutAck",r=>{this.isInitialized();const s={};for(const n of r){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),He(this,"has",(r,s)=>{this.isInitialized();const n=this.get(r),o=Et(s);return typeof n[o]<"u"}),He(this,"ack",async(r,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(r);if(typeof n>"u")return;const o=Et(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,n),await this.persist()}),He(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=Ue(e,this.name),this.core=t}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ln(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Ln(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?kn(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?kn(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Y_=Object.defineProperty,J_=Object.defineProperties,Z_=Object.getOwnPropertyDescriptors,Zc=Object.getOwnPropertySymbols,Q_=Object.prototype.hasOwnProperty,X_=Object.prototype.propertyIsEnumerable,so=(i,e,t)=>e in i?Y_(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Zr=(i,e)=>{for(var t in e||(e={}))Q_.call(e,t)&&so(i,t,e[t]);if(Zc)for(var t of Zc(e))X_.call(e,t)&&so(i,t,e[t]);return i},vn=(i,e)=>J_(i,Z_(e)),ht=(i,e,t)=>so(i,typeof e!="symbol"?e+"":e,t);class eI extends Z0{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,ht(this,"events",new rt.EventEmitter),ht(this,"name",kE),ht(this,"queue",new Map),ht(this,"publishTimeout",q.toMiliseconds(q.ONE_MINUTE)),ht(this,"initialPublishTimeout",q.toMiliseconds(q.ONE_SECOND*15)),ht(this,"needsTransportRestart",!1),ht(this,"publish",async(r,s,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:n}});const a=n?.ttl||Mc,c=fs(n),h=n?.prompt||!1,u=n?.tag||0,l=n?.id||ai().toString(),d={topic:r,message:s,opts:{ttl:a,relay:c,prompt:h,tag:u,id:l,attestation:n?.attestation,tvf:n?.tvf}},f=`Failed to publish payload, please try again. id:${l} tag:${u}`;try{const p=new Promise(async g=>{const y=({id:m})=>{d.opts.id===m&&(this.removeRequestFromQueue(m),this.relayer.events.removeListener(be.publish,y),g(d))};this.relayer.events.on(be.publish,y);const v=Ht(new Promise((m,b)=>{this.rpcPublish({topic:r,message:s,ttl:a,prompt:h,tag:u,id:l,attestation:n?.attestation,tvf:n?.tvf}).then(m).catch(P=>{this.logger.warn(P,P?.message),b(P)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${u}`);try{await v,this.events.removeListener(be.publish,y)}catch(m){this.queue.set(l,vn(Zr({},d),{attempt:1})),this.logger.warn(m,m?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:r,message:s,opts:n}}),await Ht(p,this.publishTimeout,f)}catch(p){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(p),(o=n?.internal)!=null&&o.throwOnFailedPublish)throw p}finally{this.queue.delete(l)}}),ht(this,"on",(r,s)=>{this.events.on(r,s)}),ht(this,"once",(r,s)=>{this.events.once(r,s)}),ht(this,"off",(r,s)=>{this.events.off(r,s)}),ht(this,"removeListener",(r,s)=>{this.events.removeListener(r,s)}),this.relayer=e,this.logger=Ue(t,this.name),this.registerEventListeners()}get context(){return ze(this.logger)}async rpcPublish(e){var t,r,s,n;const{topic:o,message:a,ttl:c=Mc,prompt:h,tag:u,id:l,attestation:d,tvf:f}=e,p={method:gr(fs().protocol).publish,params:Zr({topic:o,message:a,ttl:c,prompt:h,tag:u,attestation:d},f),id:l};Pe((t=p.params)==null?void 0:t.prompt)&&((r=p.params)==null||delete r.prompt),Pe((s=p.params)==null?void 0:s.tag)&&((n=p.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(be.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const r=e.attempt+1;this.queue.set(t,vn(Zr({},e),{attempt:r}));const{topic:s,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${r}`),await this.rpcPublish(vn(Zr({},e),{topic:s,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(yi.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(be.connection_stalled);return}this.checkQueue()}),this.relayer.on(be.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var tI=Object.defineProperty,iI=(i,e,t)=>e in i?tI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$i=(i,e,t)=>iI(i,typeof e!="symbol"?e+"":e,t);class rI{constructor(){$i(this,"map",new Map),$i(this,"set",(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])}),$i(this,"get",e=>this.map.get(e)||[]),$i(this,"exists",(e,t)=>this.get(e).includes(t)),$i(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const s=r.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),$i(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var sI=Object.defineProperty,nI=Object.defineProperties,oI=Object.getOwnPropertyDescriptors,Qc=Object.getOwnPropertySymbols,aI=Object.prototype.hasOwnProperty,cI=Object.prototype.propertyIsEnumerable,no=(i,e,t)=>e in i?sI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,dr=(i,e)=>{for(var t in e||(e={}))aI.call(e,t)&&no(i,t,e[t]);if(Qc)for(var t of Qc(e))cI.call(e,t)&&no(i,t,e[t]);return i},En=(i,e)=>nI(i,oI(e)),se=(i,e,t)=>no(i,typeof e!="symbol"?e+"":e,t);class hI extends eE{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,se(this,"subscriptions",new Map),se(this,"topicMap",new rI),se(this,"events",new rt.EventEmitter),se(this,"name",GE),se(this,"version",YE),se(this,"pending",new Map),se(this,"cached",[]),se(this,"initialized",!1),se(this,"storagePrefix",It),se(this,"subscribeTimeout",q.toMiliseconds(q.ONE_MINUTE)),se(this,"initialSubscribeTimeout",q.toMiliseconds(q.ONE_SECOND*15)),se(this,"clientId"),se(this,"batchSubscribeTopicsLimit",500),se(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),se(this,"subscribe",async(r,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}});try{const n=fs(s),o={topic:r,relay:n,transportType:s?.transportType};this.pending.set(r,o);const a=await this.rpcSubscribe(r,n,s);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),se(this,"unsubscribe",async(r,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(r,s.id,s):await this.unsubscribeByTopic(r,s)}),se(this,"isSubscribed",r=>new Promise(s=>{s(this.topicMap.topics.includes(r))})),se(this,"isKnownTopic",r=>new Promise(s=>{s(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(n=>n.topic===r))})),se(this,"on",(r,s)=>{this.events.on(r,s)}),se(this,"once",(r,s)=>{this.events.once(r,s)}),se(this,"off",(r,s)=>{this.events.off(r,s)}),se(this,"removeListener",(r,s)=>{this.events.removeListener(r,s)}),se(this,"start",async()=>{await this.onConnect()}),se(this,"stop",async()=>{await this.onDisconnect()}),se(this,"restart",async()=>{await this.restore(),await this.onRestart()}),se(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(s=>{r.push(s)}),await this.batchSubscribe(r)}),se(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(yi.pulse,async()=>{await this.checkPending()}),this.events.on(Ke.created,async r=>{const s=Ke.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()}),this.events.on(Ke.deleted,async r=>{const s=Ke.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()})}),this.relayer=e,this.logger=Ue(t,this.name),this.clientId=""}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const r=this.topicMap.get(e);await Promise.all(r.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const s=fs(r);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=ie("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,r){var s;(!r||r?.transportType===ce.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:gr(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(s=r?.internal)==null?void 0:s.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(r?.transportType===ce.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(u=>this.logger.warn(u))},q.toMiliseconds(q.ONE_SECOND)),a;const c=new Promise(async u=>{const l=d=>{d.topic===e&&(this.events.removeListener(Ke.created,l),u(d.id))};this.events.on(Ke.created,l);try{const d=await Ht(new Promise((f,p)=>{this.relayer.request(n).catch(g=>{this.logger.warn(g,g?.message),p(g)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ke.created,l),u(d)}catch{}}),h=await Ht(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!h&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return h?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(be.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,r={method:gr(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Ht(new Promise(s=>{this.relayer.request(r).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,r={method:gr(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let s;try{s=await await Ht(new Promise((n,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}return s}rpcUnsubscribe(e,t,r){const s={method:gr(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,En(dr({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,dr({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,dr({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ke.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:r}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Ke.deleted,En(dr({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ke.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Ke.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>En(dr({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await Tm(q.toMiliseconds(q.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Et(e+await this.getClientId())}}var uI=Object.defineProperty,Xc=Object.getOwnPropertySymbols,lI=Object.prototype.hasOwnProperty,dI=Object.prototype.propertyIsEnumerable,oo=(i,e,t)=>e in i?uI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,eh=(i,e)=>{for(var t in e||(e={}))lI.call(e,t)&&oo(i,t,e[t]);if(Xc)for(var t of Xc(e))dI.call(e,t)&&oo(i,t,e[t]);return i},Q=(i,e,t)=>oo(i,typeof e!="symbol"?e+"":e,t);class pI extends Q0{constructor(e){super(e),Q(this,"protocol","wc"),Q(this,"version",2),Q(this,"core"),Q(this,"logger"),Q(this,"events",new rt.EventEmitter),Q(this,"provider"),Q(this,"messages"),Q(this,"subscriber"),Q(this,"publisher"),Q(this,"name",zE),Q(this,"transportExplicitlyClosed",!1),Q(this,"initialized",!1),Q(this,"connectionAttemptInProgress",!1),Q(this,"relayUrl"),Q(this,"projectId"),Q(this,"packageName"),Q(this,"bundleId"),Q(this,"hasExperiencedNetworkDisruption",!1),Q(this,"pingTimeout"),Q(this,"heartBeatTimeout",q.toMiliseconds(q.THIRTY_SECONDS+q.FIVE_SECONDS)),Q(this,"reconnectTimeout"),Q(this,"connectPromise"),Q(this,"reconnectInProgress",!1),Q(this,"requestsInFlight",[]),Q(this,"connectTimeout",q.toMiliseconds(q.ONE_SECOND*15)),Q(this,"request",async t=>{var r,s;this.logger.debug("Publishing Request Payload");const n=t.id||ai().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(r=t.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${n}:${((s=t.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),Q(this,"resetPingTimeout",()=>{ds()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,r,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(r=(t=this.provider)==null?void 0:t.connection)==null?void 0:r.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),Q(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),Q(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(be.connect)}),Q(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),Q(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(be.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Q(this,"registerProviderListeners",()=>{this.provider.on(Qe.payload,this.onPayloadHandler),this.provider.on(Qe.connect,this.onConnectHandler),this.provider.on(Qe.disconnect,this.onDisconnectHandler),this.provider.on(Qe.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ue(e.logger,this.name):Br(xs({level:e.logger||ME})),this.messages=new G_(this.logger,e.core),this.subscriber=new hI(this,this.logger),this.publisher=new eI(this,this.logger),this.relayUrl=e?.relayUrl||Sl,this.projectId=e.projectId,mm()?this.packageName=Ta():wm()&&(this.bundleId=Ta()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return ze(this.logger)}get connected(){var e,t,r;return((r=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,t,r;return((r=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ce.relay},cs.outbound)}async subscribe(e,t){var r,s,n;this.isInitialized(),(!(t!=null&&t.transportType)||t?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((r=t?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(s=t?.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const h=u=>{u.topic===e&&(this.subscriber.off(Ke.created,h),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Ke.created,h)}),new Promise(async(u,l)=>{a=await this.subscriber.subscribe(e,eh({internal:{throwOnFailedPublish:o}},t)).catch(d=>{o&&l(d)})||a,u()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Ht(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,r)=>{await this.connect(e).then(t).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ec())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((r,s)=>r.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const r of t)try{await this.onMessageEvent(r)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:r}=e;if(!t.sessionExists){const s=pe(q.FIVE_MINUTES),n={topic:r,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,n)}this.events.emit(be.message,e),await this.recordMessageEvent(e,cs.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(r,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Qe.disconnect,n),await Ht(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(Qe.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Qe.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Qe.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const s=r;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(r=>setTimeout(r,q.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,r,s,n;if(ds())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new st(new xE(Im({sdkVersion:eo,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:r,message:s}=e;await this.messages.set(r,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const s=this.messages.has(t,r);return s&&this.logger.warn(`Ignoring duplicate message: ${r}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ro(e)){if(!e.method.endsWith(HE))return;const t=e.params,{topic:r,message:s,publishedAt:n,attestation:o}=t.data,a={topic:r,message:s,publishedAt:n,transportType:ce.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(eh({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Rs(e)&&this.events.emit(be.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,cs.inbound),this.events.emit(be.message,e))}async acknowledgePayload(e){const t=Ns(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Qe.payload,this.onPayloadHandler),this.provider.off(Qe.connect,this.onConnectHandler),this.provider.off(Qe.disconnect,this.onDisconnectHandler),this.provider.off(Qe.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Ec();Vv(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(yi.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&Gv())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(be.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},q.toMiliseconds(VE)))))}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function fI(){}function th(i){if(!i||typeof i!="object")return!1;const e=Object.getPrototypeOf(i);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(i)==="[object Object]":!1}function ih(i){return Object.getOwnPropertySymbols(i).filter(e=>Object.prototype.propertyIsEnumerable.call(i,e))}function rh(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}const gI="[object RegExp]",yI="[object String]",mI="[object Number]",wI="[object Boolean]",sh="[object Arguments]",bI="[object Symbol]",vI="[object Date]",EI="[object Map]",_I="[object Set]",II="[object Array]",DI="[object Function]",$I="[object ArrayBuffer]",_n="[object Object]",SI="[object Error]",PI="[object DataView]",OI="[object Uint8Array]",CI="[object Uint8ClampedArray]",AI="[object Uint16Array]",xI="[object Uint32Array]",NI="[object BigUint64Array]",TI="[object Int8Array]",RI="[object Int16Array]",jI="[object Int32Array]",UI="[object BigInt64Array]",qI="[object Float32Array]",FI="[object Float64Array]";function BI(i,e){return i===e||Number.isNaN(i)&&Number.isNaN(e)}function LI(i,e,t){return yr(i,e,void 0,void 0,void 0,void 0,t)}function yr(i,e,t,r,s,n,o){const a=o(i,e,t,r,s,n);if(a!==void 0)return a;if(typeof i==typeof e)switch(typeof i){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return i===e;case"number":return i===e||Object.is(i,e);case"function":return i===e;case"object":return Er(i,e,n,o)}return Er(i,e,n,o)}function Er(i,e,t,r){if(Object.is(i,e))return!0;let s=rh(i),n=rh(e);if(s===sh&&(s=_n),n===sh&&(n=_n),s!==n)return!1;switch(s){case yI:return i.toString()===e.toString();case mI:{const c=i.valueOf(),h=e.valueOf();return BI(c,h)}case wI:case vI:case bI:return Object.is(i.valueOf(),e.valueOf());case gI:return i.source===e.source&&i.flags===e.flags;case DI:return i===e}t=t??new Map;const o=t.get(i),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(i,e),t.set(e,i);try{switch(s){case EI:{if(i.size!==e.size)return!1;for(const[c,h]of i.entries())if(!e.has(c)||!yr(h,e.get(c),c,i,e,t,r))return!1;return!0}case _I:{if(i.size!==e.size)return!1;const c=Array.from(i.values()),h=Array.from(e.values());for(let u=0;u<c.length;u++){const l=c[u],d=h.findIndex(f=>yr(l,f,void 0,i,e,t,r));if(d===-1)return!1;h.splice(d,1)}return!0}case II:case OI:case CI:case AI:case xI:case NI:case TI:case RI:case jI:case UI:case qI:case FI:{if(typeof _e<"u"&&_e.isBuffer(i)!==_e.isBuffer(e)||i.length!==e.length)return!1;for(let c=0;c<i.length;c++)if(!yr(i[c],e[c],c,i,e,t,r))return!1;return!0}case $I:return i.byteLength!==e.byteLength?!1:Er(new Uint8Array(i),new Uint8Array(e),t,r);case PI:return i.byteLength!==e.byteLength||i.byteOffset!==e.byteOffset?!1:Er(new Uint8Array(i),new Uint8Array(e),t,r);case SI:return i.name===e.name&&i.message===e.message;case _n:{if(!(Er(i.constructor,e.constructor,t,r)||th(i)&&th(e)))return!1;const c=[...Object.keys(i),...ih(i)],h=[...Object.keys(e),...ih(e)];if(c.length!==h.length)return!1;for(let u=0;u<c.length;u++){const l=c[u],d=i[l];if(!Object.hasOwn(e,l))return!1;const f=e[l];if(!yr(d,f,l,i,e,t,r))return!1}return!0}default:return!1}}finally{t.delete(i),t.delete(e)}}function kI(i,e){return LI(i,e,fI)}var MI=Object.defineProperty,nh=Object.getOwnPropertySymbols,zI=Object.prototype.hasOwnProperty,HI=Object.prototype.propertyIsEnumerable,ao=(i,e,t)=>e in i?MI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,oh=(i,e)=>{for(var t in e||(e={}))zI.call(e,t)&&ao(i,t,e[t]);if(nh)for(var t of nh(e))HI.call(e,t)&&ao(i,t,e[t]);return i},Fe=(i,e,t)=>ao(i,typeof e!="symbol"?e+"":e,t);class mi extends X0{constructor(e,t,r,s=It,n=void 0){super(e,t,r,s),this.core=e,this.logger=t,this.name=r,Fe(this,"map",new Map),Fe(this,"version",KE),Fe(this,"cached",[]),Fe(this,"initialized",!1),Fe(this,"getKey"),Fe(this,"storagePrefix",It),Fe(this,"recentlyDeleted",[]),Fe(this,"recentlyDeletedLimit",200),Fe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Pe(o)?this.map.set(this.getKey(o),o):_v(o)?this.map.set(o.id,o):Iv(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Fe(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Fe(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Fe(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>kI(a[c],o[c]))):this.values)),Fe(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=oh(oh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Fe(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ue(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=F("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:r}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var VI=Object.defineProperty,KI=(i,e,t)=>e in i?VI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,G=(i,e,t)=>KI(i,typeof e!="symbol"?e+"":e,t);class WI{constructor(e,t){this.core=e,this.logger=t,G(this,"name",JE),G(this,"version",ZE),G(this,"events",new yo),G(this,"pairings"),G(this,"initialized",!1),G(this,"storagePrefix",It),G(this,"ignoredPayloadTypes",[jt]),G(this,"registeredMethods",[]),G(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),G(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),G(this,"create",async r=>{this.isInitialized();const s=Zn(),n=await this.core.crypto.setSymKey(s),o=pe(q.FIVE_MINUTES),a={protocol:$l},c={topic:n,expiry:o,relay:a,active:!1,methods:r?.methods},h=dc({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(si.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:r?.transportType}),{topic:n,uri:h}}),G(this,"pair",async r=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[wt.pairing_started]}});this.isValidPair(r,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:h}=lc(r.uri);s.props.properties.topic=n,s.addTrace(wt.pairing_uri_validation_success),s.addTrace(wt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),s.addTrace(wt.existing_pairing),u.active)throw s.setError(xt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(wt.pairing_not_expired)}const l=c||pe(q.FIVE_MINUTES),d={topic:n,relay:a,expiry:l,active:!1,methods:h};this.core.expirer.set(n,l),await this.pairings.set(n,d),s.addTrace(wt.store_new_pairing),r.activatePairing&&await this.activate({topic:n}),this.events.emit(si.create,d),s.addTrace(wt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(wt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(xt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw s.setError(xt.subscribe_pairing_topic_failure),f}return s.addTrace(wt.subscribe_pairing_topic_success),d}),G(this,"activate",async({topic:r})=>{this.isInitialized();const s=pe(q.FIVE_MINUTES);this.core.expirer.set(r,s),await this.pairings.update(r,{active:!0,expiry:s})}),G(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=r;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=ei();this.events.once(ee("pairing_ping",n),({error:h})=>{h?c(h):a()}),await o()}}),G(this,"updateExpiry",async({topic:r,expiry:s})=>{this.isInitialized(),await this.pairings.update(r,{expiry:s})}),G(this,"updateMetadata",async({topic:r,metadata:s})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:s})}),G(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),G(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",ie("USER_DISCONNECTED")),await this.deletePairing(s))}),G(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(s);return dc({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),G(this,"sendRequest",async(r,s,n)=>{const o=Vt(s,n),a=await this.core.crypto.encode(r,o),c=ur[s].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),G(this,"sendResult",async(r,s,n)=>{const o=Ns(r,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,r)).request.method,h=ur[c].res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),G(this,"sendError",async(r,s,n)=>{const o=Ts(r,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,r)).request.method,h=ur[c]?ur[c].res:ur.unregistered_method.res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),G(this,"deletePairing",async(r,s)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,ie("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),s?Promise.resolve():this.core.expirer.del(r)])}),G(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(s=>Mt(s.expiry));await Promise.all(r.map(s=>this.deletePairing(s.topic)))}),G(this,"onRelayEventRequest",async r=>{const{topic:s,payload:n}=r;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),G(this,"onRelayEventResponse",async r=>{const{topic:s,payload:n}=r,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),G(this,"onPairingPingRequest",async(r,s)=>{const{id:n}=s;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.events.emit(si.ping,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),G(this,"onPairingPingResponse",(r,s)=>{const{id:n}=s;setTimeout(()=>{vt(s)?this.events.emit(ee("pairing_ping",n),{}):tt(s)&&this.events.emit(ee("pairing_ping",n),{error:s.error})},500)}),G(this,"onPairingDeleteRequest",async(r,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(si.delete,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),G(this,"onUnknownRpcMethodRequest",async(r,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=ie("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,r,a),this.logger.error(a)}catch(a){await this.sendError(n,r,a),this.logger.error(a)}}),G(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(ie("WC_METHOD_UNSUPPORTED",r))}),G(this,"isValidPair",(r,s)=>{var n;if(!Le(r)){const{message:a}=F("MISSING_OR_INVALID",`pair() params: ${r}`);throw s.setError(xt.malformed_pairing_uri),new Error(a)}if(!Ev(r.uri)){const{message:a}=F("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw s.setError(xt.malformed_pairing_uri),new Error(a)}const o=lc(r?.uri);if(!((n=o?.relay)!=null&&n.protocol)){const{message:a}=F("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(xt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=F("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(xt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&q.toMiliseconds(o?.expiryTimestamp)<Date.now()){s.setError(xt.pairing_expired);const{message:a}=F("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),G(this,"isValidPing",async r=>{if(!Le(r)){const{message:n}=F("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:s}=r;await this.isValidPairingTopic(s)}),G(this,"isValidDisconnect",async r=>{if(!Le(r)){const{message:n}=F("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:s}=r;await this.isValidPairingTopic(s)}),G(this,"isValidPairingTopic",async r=>{if(!de(r,!1)){const{message:s}=F("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.pairings.keys.includes(r)){const{message:s}=F("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if(Mt(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:s}=F("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}}),this.core=e,this.logger=Ue(t,this.name),this.pairings=new mi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ze(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(be.message,async e=>{const{topic:t,message:r,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==ce.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const n=await this.core.crypto.decode(t,r);Ro(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):Rs(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,r)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(et.expired,async e=>{const{topic:t}=Ru(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(si.expire,{topic:t}))})}}var GI=Object.defineProperty,YI=(i,e,t)=>e in i?GI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Se=(i,e,t)=>YI(i,typeof e!="symbol"?e+"":e,t);class JI extends Y0{constructor(e,t){super(e,t),this.core=e,this.logger=t,Se(this,"records",new Map),Se(this,"events",new rt.EventEmitter),Se(this,"name",QE),Se(this,"version",XE),Se(this,"cached",[]),Se(this,"initialized",!1),Se(this,"storagePrefix",It),Se(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Se(this,"set",(r,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:r,request:{method:s.method,params:s.params||null},chainId:n,expiry:pe(q.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(at.created,o)}),Se(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const s=await this.getRecord(r.id);typeof s.response>"u"&&(s.response=tt(r)?{error:r.error}:{result:r.result},this.records.set(s.id,s),this.persist(),this.events.emit(at.updated,s))}),Se(this,"get",async(r,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:s}),await this.getRecord(s))),Se(this,"delete",(r,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===r){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(at.deleted,n)}}),this.persist()}),Se(this,"exists",async(r,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===r:!1)),Se(this,"on",(r,s)=>{this.events.on(r,s)}),Se(this,"once",(r,s)=>{this.events.once(r,s)}),Se(this,"off",(r,s)=>{this.events.off(r,s)}),Se(this,"removeListener",(r,s)=>{this.events.removeListener(r,s)}),this.logger=Ue(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:Vt(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:r}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(at.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(at.created,e=>{const t=at.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(at.updated,e=>{const t=at.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(at.deleted,e=>{const t=at.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(yi.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{q.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(at.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var ZI=Object.defineProperty,QI=(i,e,t)=>e in i?ZI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ne=(i,e,t)=>QI(i,typeof e!="symbol"?e+"":e,t);class XI extends tE{constructor(e,t){super(e,t),this.core=e,this.logger=t,Ne(this,"expirations",new Map),Ne(this,"events",new rt.EventEmitter),Ne(this,"name",e1),Ne(this,"version",t1),Ne(this,"cached",[]),Ne(this,"initialized",!1),Ne(this,"storagePrefix",It),Ne(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ne(this,"has",r=>{try{const s=this.formatTarget(r);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Ne(this,"set",(r,s)=>{this.isInitialized();const n=this.formatTarget(r),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(et.created,{target:n,expiration:o})}),Ne(this,"get",r=>{this.isInitialized();const s=this.formatTarget(r);return this.getExpiration(s)}),Ne(this,"del",r=>{if(this.isInitialized(),this.has(r)){const s=this.formatTarget(r),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(et.deleted,{target:s,expiration:n})}}),Ne(this,"on",(r,s)=>{this.events.on(r,s)}),Ne(this,"once",(r,s)=>{this.events.once(r,s)}),Ne(this,"off",(r,s)=>{this.events.off(r,s)}),Ne(this,"removeListener",(r,s)=>{this.events.removeListener(r,s)}),this.logger=Ue(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Dm(e);if(typeof e=="number")return $m(e);const{message:t}=F("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(et.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:r}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return t}checkExpiry(e,t){const{expiry:r}=t;q.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(et.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(yi.pulse,()=>this.checkExpirations()),this.events.on(et.created,e=>{const t=et.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(et.expired,e=>{const t=et.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(et.deleted,e=>{const t=et.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var e2=Object.defineProperty,t2=(i,e,t)=>e in i?e2(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,le=(i,e,t)=>t2(i,typeof e!="symbol"?e+"":e,t);class i2 extends iE{constructor(e,t,r){super(e,t,r),this.core=e,this.logger=t,this.store=r,le(this,"name",i1),le(this,"abortController"),le(this,"isDevEnv"),le(this,"verifyUrlV3",s1),le(this,"storagePrefix",It),le(this,"version",Dl),le(this,"publicKey"),le(this,"fetchPromise"),le(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&q.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),le(this,"register",async s=>{if(!er()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const h=Ut.getDocument(),u=this.startAbortTimer(q.ONE_SECOND*5),l=await new Promise((d,f)=>{const p=()=>{window.removeEventListener("message",y),h.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=h.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const y=v=>{if(v.data&&typeof v.data=="string")try{const m=JSON.parse(v.data);if(m.type==="verify_attestation"){if(Bn(m.attestation).payload.id!==o)return;clearInterval(u),h.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",y),d(m.attestation===null?"":m.attestation)}}catch(m){this.logger.warn(m)}};h.body.appendChild(g),window.addEventListener("message",y,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(h){this.logger.warn(h)}return""}),le(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Bn(n).payload.id!==a)return;const h=await this.isValidJwtAttestation(n);if(h){if(!h.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return h}}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),le(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(q.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),le(this,"getVerifyUrl",s=>{let n=s||vr;return n1.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${vr}`),n=vr),n}),le(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(q.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),le(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),le(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),le(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),le(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),le(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),le(this,"validateAttestation",(s,n)=>{const o=ev(s,n.publicKey),a={hasExpired:q.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ue(t,this.name),this.abortController=new AbortController,this.isDevEnv=Do(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ze(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),q.toMiliseconds(e))}}var r2=Object.defineProperty,s2=(i,e,t)=>e in i?r2(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ah=(i,e,t)=>s2(i,typeof e!="symbol"?e+"":e,t);class n2 extends rE{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,ah(this,"context",o1),ah(this,"registerDeviceToken",async r=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=r,c=`${a1}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=Ue(t,this.context)}}var o2=Object.defineProperty,ch=Object.getOwnPropertySymbols,a2=Object.prototype.hasOwnProperty,c2=Object.prototype.propertyIsEnumerable,co=(i,e,t)=>e in i?o2(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pr=(i,e)=>{for(var t in e||(e={}))a2.call(e,t)&&co(i,t,e[t]);if(ch)for(var t of ch(e))c2.call(e,t)&&co(i,t,e[t]);return i},ge=(i,e,t)=>co(i,typeof e!="symbol"?e+"":e,t);class h2 extends sE{constructor(e,t,r=!0){super(e,t,r),this.core=e,this.logger=t,ge(this,"context",h1),ge(this,"storagePrefix",It),ge(this,"storageVersion",c1),ge(this,"events",new Map),ge(this,"shouldPersist",!1),ge(this,"init",async()=>{if(!Do())try{const s={eventId:ja(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Nu(this.core.relayer.protocol,this.core.relayer.version,eo)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),ge(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,h=ja(),u=this.core.projectId||"",l=Date.now(),d=pr({eventId:h,timestamp:l,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,d),this.shouldPersist=!0),d}),ge(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return pr(pr({},a),this.setMethods(a.eventId))}),ge(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),ge(this,"setEventListeners",()=>{this.core.heartbeat.on(yi.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{q.fromMiliseconds(Date.now())-q.fromMiliseconds(s.timestamp)>u1&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),ge(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),ge(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),ge(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),ge(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ge(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,pr(pr({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),ge(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),ge(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${l1}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${eo}${n}`,{method:"POST",body:JSON.stringify(s)})}),ge(this,"getAppDomain",()=>xu().url),this.logger=Ue(t,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var u2=Object.defineProperty,hh=Object.getOwnPropertySymbols,l2=Object.prototype.hasOwnProperty,d2=Object.prototype.propertyIsEnumerable,ho=(i,e,t)=>e in i?u2(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,uh=(i,e)=>{for(var t in e||(e={}))l2.call(e,t)&&ho(i,t,e[t]);if(hh)for(var t of hh(e))d2.call(e,t)&&ho(i,t,e[t]);return i},ae=(i,e,t)=>ho(i,typeof e!="symbol"?e+"":e,t);let p2=class Fl extends V0{constructor(e){var t;super(e),ae(this,"protocol",Il),ae(this,"version",Dl),ae(this,"name",Xn),ae(this,"relayUrl"),ae(this,"projectId"),ae(this,"customStoragePrefix"),ae(this,"events",new rt.EventEmitter),ae(this,"logger"),ae(this,"heartbeat"),ae(this,"relayer"),ae(this,"crypto"),ae(this,"storage"),ae(this,"history"),ae(this,"expirer"),ae(this,"pairing"),ae(this,"verify"),ae(this,"echoClient"),ae(this,"linkModeSupportedApps"),ae(this,"eventClient"),ae(this,"initialized",!1),ae(this,"logChunkController"),ae(this,"on",(a,c)=>this.events.on(a,c)),ae(this,"once",(a,c)=>this.events.once(a,c)),ae(this,"off",(a,c)=>this.events.off(a,c)),ae(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ae(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:h})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ce.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:h})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Sl,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=xs({level:typeof e?.logger=="string"&&e.logger?e.logger:TE.logger,name:Xn}),{logger:n,chunkLoggerController:o}=M0({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ue(n,this.name),this.heartbeat=new Jv,this.crypto=new L_(this,this.logger,e?.keychain),this.history=new JI(this,this.logger),this.expirer=new XI(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new $0(uh(uh({},RE),e?.storageOptions)),this.relayer=new pI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new WI(this,this.logger),this.verify=new i2(this,this.logger,this.storage),this.echoClient=new n2(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new h2(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new Fl(e);await t.initialize();const r=await t.crypto.getClientId();return await t.storage.setItem(WE,r),t}get context(){return ze(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(zc,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(zc)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,r=`${t}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof Kt<"u"&&NE.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const f2=p2,Bl="wc",Ll=2,kl="client",jo=`${Bl}@${Ll}:${kl}:`,In={name:kl,logger:"error"},lh="WALLETCONNECT_DEEPLINK_CHOICE",g2="proposal",dh="Proposal expired",y2="session",Si=q.SEVEN_DAYS,m2="engine",ye={wc_sessionPropose:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1114},res:{ttl:q.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:q.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:q.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1119}}},Dn={min:q.FIVE_MINUTES,max:q.SEVEN_DAYS},mt={idle:"IDLE",active:"ACTIVE"},ph={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},w2="request",b2=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],v2="wc",E2="auth",_2="authKeys",I2="pairingTopics",D2="requests",Us=`${v2}@${1.5}:${E2}:`,hs=`${Us}:PUB_KEY`;var $2=Object.defineProperty,S2=Object.defineProperties,P2=Object.getOwnPropertyDescriptors,fh=Object.getOwnPropertySymbols,O2=Object.prototype.hasOwnProperty,C2=Object.prototype.propertyIsEnumerable,uo=(i,e,t)=>e in i?$2(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ne=(i,e)=>{for(var t in e||(e={}))O2.call(e,t)&&uo(i,t,e[t]);if(fh)for(var t of fh(e))C2.call(e,t)&&uo(i,t,e[t]);return i},Re=(i,e)=>S2(i,P2(e)),T=(i,e,t)=>uo(i,typeof e!="symbol"?e+"":e,t);class A2 extends cE{constructor(e){super(e),T(this,"name",m2),T(this,"events",new yo),T(this,"initialized",!1),T(this,"requestQueue",{state:mt.idle,queue:[]}),T(this,"sessionRequestQueue",{state:mt.idle,queue:[]}),T(this,"requestQueueDelay",q.ONE_SECOND),T(this,"expectedPairingMethodMap",new Map),T(this,"recentlyDeletedMap",new Map),T(this,"recentlyDeletedLimit",200),T(this,"relayMessageCache",[]),T(this,"pendingSessions",new Map),T(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ye)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},q.toMiliseconds(this.requestQueueDelay)))}),T(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=Re(ne({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(r),r.optionalNamespaces=yv(r.requiredNamespaces,r.optionalNamespaces),r.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:h}=r;let u=s,l,d=!1;try{if(u){const w=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=w.active}}catch(w){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),w}if(!u||!d){const{topic:w,uri:_}=await this.client.core.pairing.create();u=w,l=_}if(!u){const{message:w}=F("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(w)}const f=await this.client.core.crypto.generateKeyPair(),p=ye.wc_sessionPropose.req.ttl||q.FIVE_MINUTES,g=pe(p),y=Re(ne(ne({requiredNamespaces:n,optionalNamespaces:o,relays:h??[{protocol:$l}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:bt()}),v=ee("session_connect",y.id),{reject:m,resolve:b,done:P}=ei(p,dh),A=({id:w})=>{w===y.id&&(this.client.events.off("proposal_expire",A),this.pendingSessions.delete(y.id),this.events.emit(v,{error:{message:dh,code:0}}))};return this.client.events.on("proposal_expire",A),this.events.once(v,({error:w,session:_})=>{this.client.events.off("proposal_expire",A),w?m(w):_&&b(_)}),await this.sendRequest({topic:u,method:"wc_sessionPropose",params:y,throwOnFailedPublish:!0,clientRpcId:y.id}),await this.setProposal(y.id,y),{uri:l,approval:P}}),T(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(r){throw this.client.logger.error("pair() failed"),r}}),T(this,"approve",async t=>{var r,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=t?.id)==null?void 0:r.toString(),trace:[ct.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(I){throw o.setError(Qt.no_internet_connection),I}try{await this.isValidProposalId(t?.id)}catch(I){throw this.client.logger.error(`approve() -> proposal.get(${t?.id}) failed`),o.setError(Qt.proposal_not_found),I}try{await this.isValidApprove(t)}catch(I){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Qt.session_approve_namespace_validation_failure),I}const{id:a,relayProtocol:c,namespaces:h,sessionProperties:u,scopedProperties:l,sessionConfig:d}=t,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:g,requiredNamespaces:y,optionalNamespaces:v}=f;let m=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:p});m||(m=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:ct.session_approve_started,properties:{topic:p,trace:[ct.session_approve_started,ct.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),P=g.publicKey,A=await this.client.core.crypto.generateSharedKey(b,P),w=ne(ne(ne({relay:{protocol:c??"irn"},namespaces:h,controller:{publicKey:b,metadata:this.client.metadata},expiry:pe(Si)},u&&{sessionProperties:u}),l&&{scopedProperties:l}),d&&{sessionConfig:d}),_=ce.relay;m.addTrace(ct.subscribing_session_topic);try{await this.client.core.relayer.subscribe(A,{transportType:_})}catch(I){throw m.setError(Qt.subscribe_session_topic_failure),I}m.addTrace(ct.subscribe_session_topic_success);const D=Re(ne({},w),{topic:A,requiredNamespaces:y,optionalNamespaces:v,pairingTopic:p,acknowledged:!1,self:w.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:b,transportType:ce.relay});await this.client.session.set(A,D),m.addTrace(ct.store_session);try{m.addTrace(ct.publishing_session_settle),await this.sendRequest({topic:A,method:"wc_sessionSettle",params:w,throwOnFailedPublish:!0}).catch(I=>{throw m?.setError(Qt.session_settle_publish_failure),I}),m.addTrace(ct.session_settle_publish_success),m.addTrace(ct.publishing_session_approve),await this.sendResult({id:a,topic:p,result:{relay:{protocol:c??"irn"},responderPublicKey:b},throwOnFailedPublish:!0}).catch(I=>{throw m?.setError(Qt.session_approve_publish_failure),I}),m.addTrace(ct.session_approve_publish_success)}catch(I){throw this.client.logger.error(I),this.client.session.delete(A,ie("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(A),I}return this.client.core.eventClient.deleteEvent({eventId:m.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.client.proposal.delete(a,ie("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(A,pe(Si)),{topic:A,acknowledged:()=>Promise.resolve(this.client.session.get(A))}}),T(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:s}=t;let n;try{n=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}n&&(await this.sendError({id:r,topic:n,error:s,rpcOpts:ye.wc_sessionPropose.reject}),await this.client.proposal.delete(r,ie("USER_DISCONNECTED")))}),T(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:r,namespaces:s}=t,{done:n,resolve:o,reject:a}=ei(),c=bt(),h=ai().toString(),u=this.client.session.get(r).namespaces;return this.events.once(ee("session_update",c),({error:l})=>{l?a(l):o()}),await this.client.session.update(r,{namespaces:s}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:h}).catch(l=>{this.client.logger.error(l),this.client.session.update(r,{namespaces:u}),a(l)}),{acknowledged:n}}),T(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=t,s=bt(),{done:n,resolve:o,reject:a}=ei();return this.events.once(ee("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,pe(Si)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),T(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(v){throw this.client.logger.error("request() -> isValidRequest() failed"),v}const{chainId:r,request:s,topic:n,expiry:o=ye.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(n);a?.transportType===ce.relay&&await this.confirmOnlineStateOrThrow();const c=bt(),h=ai().toString(),{done:u,resolve:l,reject:d}=ei(o,"Request expired. Please try again.");this.events.once(ee("session_request",c),({error:v,result:m})=>{v?d(v):l(m)});const f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:f,params:{request:Re(ne({},s),{expiryTimestamp:pe(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(v=>d(v)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:r,id:c}),await u();const g={request:Re(ne({},s),{expiryTimestamp:pe(o)}),chainId:r},y=this.shouldSetTVF(f,g);return await Promise.all([new Promise(async v=>{await this.sendRequest(ne({clientRpcId:c,relayRpcId:h,topic:n,method:f,params:g,expiry:o,throwOnFailedPublish:!0},y&&{tvf:this.getTVFParams(c,g)})).catch(m=>d(m)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:r,id:c}),v()}),new Promise(async v=>{var m;if(!((m=a.sessionConfig)!=null&&m.disableDeepLink)){const b=await Cm(this.client.core.storage,lh);await Sm({id:c,topic:n,wcDeepLink:b})}v()}),u()]).then(v=>v[2])}),T(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:r,response:s}=t,{id:n}=s,o=this.client.session.get(r);o.transportType===ce.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);vt(s)?await this.sendResult({id:n,topic:r,result:s.result,throwOnFailedPublish:!0,appLink:a}):tt(s)&&await this.sendError({id:n,topic:r,error:s.error,appLink:a}),this.cleanupAfterResponse(t)}),T(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:r}=t;if(this.client.session.keys.includes(r)){const s=bt(),n=ai().toString(),{done:o,resolve:a,reject:c}=ei();this.events.once(ee("session_ping",s),({error:h})=>{h?c(h):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),T(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:r,event:s,chainId:n}=t,o=ai().toString(),a=bt();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),T(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:r}=t;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:ie("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:s}=F("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(s)}}),T(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(r=>bv(r,t)))),T(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),T(this,"authenticate",async(t,r)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const n=r&&this.client.core.linkModeSupportedApps.includes(r)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ce.link_mode:ce.relay;o===ce.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:h,domain:u,nonce:l,type:d,exp:f,nbf:p,methods:g=[],expiry:y}=t,v=[...t.resources||[]],{topic:m,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:m,uri:b}});const P=await this.client.core.crypto.generateKeyPair(),A=ns(P);if(await Promise.all([this.client.auth.authKeys.set(hs,{responseTopic:A,publicKey:P}),this.client.auth.pairingTopics.set(A,{topic:A,pairingTopic:m})]),await this.client.core.relayer.subscribe(A,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${m}`),g.length>0){const{namespace:O}=zi(a[0]);let N=Ew(O,"request",g);ss(v)&&(N=Iw(N,v.pop())),v.push(N)}const w=y&&y>ye.wc_sessionAuthenticate.req.ttl?y:ye.wc_sessionAuthenticate.req.ttl,_={authPayload:{type:d??"caip122",chains:a,statement:c,aud:h,domain:u,version:"1",nonce:l,iat:new Date().toISOString(),exp:f,nbf:p,resources:v},requester:{publicKey:P,metadata:this.client.metadata},expiryTimestamp:pe(w)},D={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},I={requiredNamespaces:{},optionalNamespaces:D,relays:[{protocol:"irn"}],pairingTopic:m,proposer:{publicKey:P,metadata:this.client.metadata},expiryTimestamp:pe(ye.wc_sessionPropose.req.ttl),id:bt()},{done:j,resolve:R,reject:U}=ei(w,"Request expired"),k=bt(),$=ee("session_connect",I.id),S=ee("session_request",k),E=async({error:O,session:N})=>{this.events.off(S,C),O?U(O):N&&R({session:N})},C=async O=>{var N,B,L;if(await this.deletePendingAuthRequest(k,{message:"fulfilled",code:0}),O.error){const J=ie("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return O.error.code===J.code?void 0:(this.events.off($,E),U(O.error.message))}await this.deleteProposal(I.id),this.events.off($,E);const{cacaos:M,responder:z}=O.result,K=[],V=[];for(const J of M){await za({cacao:J,projectId:this.client.core.projectId})||(this.client.logger.error(J,"Signature verification failed"),U(ie("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:xe}=J,Ie=ss(xe.resources),Te=[Mn(xe.iss)],Ze=ps(xe.iss);if(Ie){const Dt=Ha(Ie),bi=Va(Ie);K.push(...Dt),Te.push(...bi)}for(const Dt of Te)V.push(`${Dt}:${Ze}`)}const oe=await this.client.core.crypto.generateSharedKey(P,z.publicKey);let te;K.length>0&&(te={topic:oe,acknowledged:!0,self:{publicKey:P,metadata:this.client.metadata},peer:z,controller:z.publicKey,expiry:pe(Si),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:m,namespaces:yc([...new Set(K)],[...new Set(V)]),transportType:o},await this.client.core.relayer.subscribe(oe,{transportType:o}),await this.client.session.set(oe,te),m&&await this.client.core.pairing.updateMetadata({topic:m,metadata:z.metadata}),te=this.client.session.get(oe)),(N=this.client.metadata.redirect)!=null&&N.linkMode&&(B=z.metadata.redirect)!=null&&B.linkMode&&(L=z.metadata.redirect)!=null&&L.universal&&r&&(this.client.core.addLinkModeSupportedApp(z.metadata.redirect.universal),this.client.session.update(oe,{transportType:ce.link_mode})),R({auths:M,session:te})};this.events.once($,E),this.events.once(S,C);let x;try{if(n){const O=Vt("wc_sessionAuthenticate",_,k);this.client.core.history.set(m,O);const N=await this.client.core.crypto.encode("",O,{type:Fr,encoding:zt});x=Gr(r,m,N)}else await Promise.all([this.sendRequest({topic:m,method:"wc_sessionAuthenticate",params:_,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:k}),this.sendRequest({topic:m,method:"wc_sessionPropose",params:I,expiry:ye.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:I.id})])}catch(O){throw this.events.off($,E),this.events.off(S,C),O}return await this.setProposal(I.id,I),await this.setAuthRequest(k,{request:Re(ne({},_),{verifyContext:{}}),pairingTopic:m,transportType:o}),{uri:x??b,response:j}}),T(this,"approveSessionAuthenticate",async t=>{const{id:r,auths:s}=t,n=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[Xt.authenticated_session_approve_started]}});try{this.isInitialized()}catch(y){throw n.setError(lr.no_internet_connection),y}const o=this.getPendingAuthRequest(r);if(!o)throw n.setError(lr.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||ce.relay;a===ce.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),u=ns(c),l={type:jt,receiverPublicKey:c,senderPublicKey:h},d=[],f=[];for(const y of s){if(!await za({cacao:y,projectId:this.client.core.projectId})){n.setError(lr.invalid_cacao);const A=ie("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:u,error:A,encodeOpts:l}),new Error(A.message)}n.addTrace(Xt.cacaos_verified);const{p:v}=y,m=ss(v.resources),b=[Mn(v.iss)],P=ps(v.iss);if(m){const A=Ha(m),w=Va(m);d.push(...A),b.push(...w)}for(const A of b)f.push(`${A}:${P}`)}const p=await this.client.core.crypto.generateSharedKey(h,c);n.addTrace(Xt.create_authenticated_session_topic);let g;if(d?.length>0){g={topic:p,acknowledged:!0,self:{publicKey:h,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:pe(Si),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:yc([...new Set(d)],[...new Set(f)]),transportType:a},n.addTrace(Xt.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(y){throw n.setError(lr.subscribe_authenticated_session_topic_failure),y}n.addTrace(Xt.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),n.addTrace(Xt.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Xt.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:r,result:{cacaos:s,responder:{publicKey:h,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(y){throw n.setError(lr.authenticated_session_approve_publish_failure),y}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),T(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:r,reason:s}=t,n=this.getPendingAuthRequest(r);if(!n)throw new Error(`Could not find pending auth request with id ${r}`);n.transportType===ce.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=ns(o),h={type:jt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:s,encodeOpts:h,rpcOpts:ye.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.client.proposal.delete(r,ie("USER_DISCONNECTED"))}),T(this,"formatAuthMessage",t=>{this.isInitialized();const{request:r,iss:s}=t;return zu(r,s)}),T(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),T(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const r=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&n.topic&&n.topic!==r.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),T(this,"deleteSession",async t=>{var r;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,ie("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(lh).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===s&&this.deletePendingSessionRequest(h.id,ie("USER_DISCONNECTED"))}),s===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=mt.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),T(this,"deleteProposal",async(t,r)=>{if(r)try{const s=this.client.proposal.get(t);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Qt.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,ie("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),T(this,"deletePendingSessionRequest",async(t,r,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,r),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),s&&(this.sessionRequestQueue.state=mt.idle,this.client.events.emit("session_request_expire",{id:t}))}),T(this,"deletePendingAuthRequest",async(t,r,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,r),s?Promise.resolve():this.client.core.expirer.del(t)])}),T(this,"setExpiry",async(t,r)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,r),await this.client.session.update(t,{expiry:r}))}),T(this,"setProposal",async(t,r)=>{this.client.core.expirer.set(t,pe(ye.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,r)}),T(this,"setAuthRequest",async(t,r)=>{const{request:s,pairingTopic:n,transportType:o=ce.relay}=r;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),T(this,"setPendingSessionRequest",async t=>{const{id:r,topic:s,params:n,verifyContext:o}=t,a=n.request.expiryTimestamp||pe(ye.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:s,params:n,verifyContext:o})}),T(this,"sendRequest",async t=>{const{topic:r,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:h,appLink:u,tvf:l}=t,d=Vt(s,n,c);let f;const p=!!u;try{const v=p?zt:lt;f=await this.client.core.crypto.encode(r,d,{encoding:v})}catch(v){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),v}let g;if(b2.includes(s)){const v=Et(JSON.stringify(d)),m=Et(f);g=await this.client.core.verify.register({id:m,decryptedId:v})}const y=ye[s].req;if(y.attestation=g,o&&(y.ttl=o),a&&(y.id=a),this.client.core.history.set(r,d),p){const v=Gr(u,r,f);await H.Linking.openURL(v,this.client.name)}else{const v=ye[s].req;o&&(v.ttl=o),a&&(v.id=a),v.tvf=Re(ne({},l),{correlationId:d.id}),h?(v.internal=Re(ne({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,f,v)):this.client.core.relayer.publish(r,f,v).catch(m=>this.client.logger.error(m))}return d.id}),T(this,"sendResult",async t=>{const{id:r,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,h=Ns(r,n);let u;const l=c&&typeof(H==null?void 0:H.Linking)<"u";try{const p=l?zt:lt;u=await this.client.core.crypto.encode(s,h,Re(ne({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let d,f;try{d=await this.client.core.history.get(s,r);const p=d.request;try{this.shouldSetTVF(p.method,p.params)&&(f=this.getTVFParams(r,p.params,n))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${r}) failed`),p}if(l){const p=Gr(c,s,u);await H.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=ye[p].res;g.tvf=Re(ne({},f),{correlationId:r}),o?(g.internal=Re(ne({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,g)):this.client.core.relayer.publish(s,u,g).catch(y=>this.client.logger.error(y))}await this.client.core.history.resolve(h)}),T(this,"sendError",async t=>{const{id:r,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=t,h=Ts(r,n);let u;const l=c&&typeof(H==null?void 0:H.Linking)<"u";try{const f=l?zt:lt;u=await this.client.core.crypto.encode(s,h,Re(ne({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),f}let d;try{d=await this.client.core.history.get(s,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${s}, ${r}) failed`),f}if(l){const f=Gr(c,s,u);await H.Linking.openURL(f,this.client.name)}else{const f=d.request.method,p=a||ye[f].res;this.client.core.relayer.publish(s,u,p)}await this.client.core.history.resolve(h)}),T(this,"cleanup",async()=>{const t=[],r=[];this.client.session.getAll().forEach(s=>{let n=!1;Mt(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Mt(s.expiryTimestamp)&&r.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...r.map(s=>this.deleteProposal(s))])}),T(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),T(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),T(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===mt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=mt.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=mt.idle}),T(this,"processRequest",async t=>{const{topic:r,payload:s,attestation:n,transportType:o,encryptedId:a}=t,c=s.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,s);case"wc_sessionPing":return await this.onSessionPingRequest(r,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),T(this,"onRelayEventResponse",async t=>{const{topic:r,payload:s,transportType:n}=t,o=(await this.client.core.history.get(r,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(r,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,s);case"wc_sessionExtend":return this.onSessionExtendResponse(r,s);case"wc_sessionPing":return this.onSessionPingResponse(r,s);case"wc_sessionRequest":return this.onSessionRequestResponse(r,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),T(this,"onRelayEventUnknownPayload",t=>{const{topic:r}=t,{message:s}=F("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),T(this,"shouldIgnorePairingRequest",t=>{const{topic:r,requestMethod:s}=t,n=this.expectedPairingMethodMap.get(r);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),T(this,"onSessionProposeRequest",async t=>{const{topic:r,payload:s,attestation:n,encryptedId:o}=t,{params:a,id:c}=s;try{const h=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),h?.setError(xt.proposal_listener_not_found)),this.isValidConnect(ne({},s.params));const u=a.expiryTimestamp||pe(ye.wc_sessionPropose.req.ttl),l=ne({id:c,pairingTopic:r,expiryTimestamp:u},a);await this.setProposal(c,l);const d=await this.getVerifyContext({attestationId:n,hash:Et(JSON.stringify(s)),encryptedId:o,metadata:l.proposer.metadata});h?.addTrace(wt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:l,verifyContext:d})}catch(h){await this.sendError({id:c,topic:r,error:h,rpcOpts:ye.wc_sessionPropose.autoReject}),this.client.logger.error(h)}}),T(this,"onSessionProposeResponse",async(t,r,s)=>{const{id:n}=r;if(vt(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const u=await this.client.core.crypto.generateSharedKey(c,h);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:t,proposalId:n,publicKey:c});const l=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:t})}else if(tt(r)){await this.client.proposal.delete(n,ie("USER_DISCONNECTED"));const o=ee("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),T(this,"onSessionSettleRequest",async(t,r)=>{const{id:s,params:n}=r;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:h,sessionProperties:u,scopedProperties:l,sessionConfig:d}=r.params,f=[...this.pendingSessions.values()].find(y=>y.sessionTopic===t);if(!f)return this.client.logger.error(`Pending session not found for topic ${t}`);const p=this.client.proposal.get(f.proposalId),g=Re(ne(ne(ne({topic:t,relay:o,expiry:c,namespaces:h,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),l&&{scopedProperties:l}),d&&{sessionConfig:d}),{transportType:ce.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(ee("session_connect",f.proposalId),{session:g}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:r.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),T(this,"onSessionSettleResponse",async(t,r)=>{const{id:s}=r;vt(r)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(ee("session_approve",s),{})):tt(r)&&(await this.client.session.delete(t,ie("USER_DISCONNECTED")),this.events.emit(ee("session_approve",s),{error:r.error}))}),T(this,"onSessionUpdateRequest",async(t,r)=>{const{params:s,id:n}=r;try{const o=`${t}_session_update`,a=hr.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:ie("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ne({topic:t},s));try{hr.set(o,n),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(c){throw hr.delete(o),c}this.client.events.emit("session_update",{id:n,topic:t,params:s})}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),T(this,"isRequestOutOfSync",(t,r)=>r.toString().slice(0,-3)<t.toString().slice(0,-3)),T(this,"onSessionUpdateResponse",(t,r)=>{const{id:s}=r,n=ee("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(r)?this.events.emit(ee("session_update",s),{}):tt(r)&&this.events.emit(ee("session_update",s),{error:r.error})}),T(this,"onSessionExtendRequest",async(t,r)=>{const{id:s}=r;try{this.isValidExtend({topic:t}),await this.setExpiry(t,pe(Si)),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),T(this,"onSessionExtendResponse",(t,r)=>{const{id:s}=r,n=ee("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(r)?this.events.emit(ee("session_extend",s),{}):tt(r)&&this.events.emit(ee("session_extend",s),{error:r.error})}),T(this,"onSessionPingRequest",async(t,r)=>{const{id:s}=r;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),T(this,"onSessionPingResponse",(t,r)=>{const{id:s}=r,n=ee("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);vt(r)?this.events.emit(ee("session_ping",s),{}):tt(r)&&this.events.emit(ee("session_ping",s),{error:r.error})},500)}),T(this,"onSessionDeleteRequest",async(t,r)=>{const{id:s}=r;try{this.isValidDisconnect({topic:t,reason:r.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(be.publish,async()=>{n(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:ie("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),T(this,"onSessionRequest",async t=>{var r,s,n;const{topic:o,payload:a,attestation:c,encryptedId:h,transportType:u}=t,{id:l,params:d}=a;try{await this.isValidRequest(ne({topic:o},d));const f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Et(JSON.stringify(Vt("wc_sessionRequest",d,l))),encryptedId:h,metadata:f.peer.metadata,transportType:u}),g={id:l,topic:o,params:d,verifyContext:p};await this.setPendingSessionRequest(g),u===ce.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((s=f.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:l,topic:o,error:f}),this.client.logger.error(f)}}),T(this,"onSessionRequestResponse",(t,r)=>{const{id:s}=r,n=ee("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(r)?this.events.emit(ee("session_request",s),{result:r.result}):tt(r)&&this.events.emit(ee("session_request",s),{error:r.error})}),T(this,"onSessionEventRequest",async(t,r)=>{const{id:s,params:n}=r;try{const o=`${t}_session_event_${n.event.name}`,a=hr.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ne({topic:t},n)),this.client.events.emit("session_event",{id:s,topic:t,params:n}),hr.set(o,s)}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),T(this,"onSessionAuthenticateResponse",(t,r)=>{const{id:s}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:r}),vt(r)?this.events.emit(ee("session_request",s),{result:r.result}):tt(r)&&this.events.emit(ee("session_request",s),{error:r.error})}),T(this,"onSessionAuthenticateRequest",async t=>{var r;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=t;try{const{requester:h,authPayload:u,expiryTimestamp:l}=n.params,d=await this.getVerifyContext({attestationId:o,hash:Et(JSON.stringify(n)),encryptedId:a,metadata:h.metadata,transportType:c}),f={requester:h,pairingTopic:s,id:n.id,authPayload:u,verifyContext:d,expiryTimestamp:l};await this.setAuthRequest(n.id,{request:f,pairingTopic:s,transportType:c}),c===ce.link_mode&&(r=h.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:d})}catch(h){this.client.logger.error(h);const u=n.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:jt,receiverPublicKey:u,senderPublicKey:l};await this.sendError({id:n.id,topic:s,error:h,encodeOpts:f,rpcOpts:ye.wc_sessionAuthenticate.autoReject,appLink:d})}}),T(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),T(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=mt.idle,this.processSessionRequestQueue()},q.toMiliseconds(this.requestQueueDelay))}),T(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:r})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=ee("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ee("session_request",n.request.id),{error:r})})}),T(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===mt.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=mt.active,this.emitSessionRequest(t)}catch(r){this.client.logger.error(r)}}),T(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),T(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const r=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);r&&this.onSessionProposeRequest({topic:t.topic,payload:Vt("wc_sessionPropose",Re(ne({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id)})}),T(this,"isValidConnect",async t=>{if(!Le(t)){const{message:h}=F("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(h)}const{pairingTopic:r,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=t;if(Pe(r)||await this.isValidPairingTopic(r),!xv(c)){const{message:h}=F("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}if(!Pe(s)&&Gt(s)!==0){const h="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(h):this.client.logger.warn(h),this.validateNamespaces(s,"requiredNamespaces")}if(!Pe(n)&&Gt(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Pe(o)||this.validateSessionProps(o,"sessionProperties"),!Pe(a)){this.validateSessionProps(a,"scopedProperties");const h=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>h.includes(u)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(h)}`)}}),T(this,"validateNamespaces",(t,r)=>{const s=Av(t,"connect()",r);if(s)throw new Error(s.message)}),T(this,"isValidApprove",async t=>{if(!Le(t))throw new Error(F("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:r,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),h=pn(s,"approve()");if(h)throw new Error(h.message);const u=bc(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!de(n,!0)){const{message:l}=F("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(l)}if(Pe(o)||this.validateSessionProps(o,"sessionProperties"),!Pe(a)){this.validateSessionProps(a,"scopedProperties");const l=new Set(Object.keys(s));if(!Object.keys(a).every(d=>l.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(l).join(", ")}`)}}),T(this,"isValidReject",async t=>{if(!Le(t)){const{message:n}=F("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:r,reason:s}=t;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!Tv(s)){const{message:n}=F("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),T(this,"isValidSessionSettleRequest",t=>{if(!Le(t)){const{message:h}=F("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(h)}const{relay:r,controller:s,namespaces:n,expiry:o}=t;if(!gl(r)){const{message:h}=F("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}const a=Dv(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=pn(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Mt(o)){const{message:h}=F("EXPIRED","onSessionSettleRequest()");throw new Error(h)}}),T(this,"isValidUpdate",async t=>{if(!Le(t)){const{message:c}=F("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:r,namespaces:s}=t;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const n=this.client.session.get(r),o=pn(s,"update()");if(o)throw new Error(o.message);const a=bc(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),T(this,"isValidExtend",async t=>{if(!Le(t)){const{message:s}=F("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:r}=t;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),T(this,"isValidRequest",async t=>{if(!Le(t)){const{message:c}=F("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:r,request:s,chainId:n,expiry:o}=t;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!wc(a,n)){const{message:c}=F("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!Rv(s)){const{message:c}=F("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!qv(a,n,s.method)){const{message:c}=F("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!kv(o,Dn)){const{message:c}=F("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Dn.min} and ${Dn.max}`);throw new Error(c)}}),T(this,"isValidRespond",async t=>{var r;if(!Le(t)){const{message:o}=F("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:s,response:n}=t;try{await this.isValidSessionTopic(s)}catch(o){throw(r=t?.response)!=null&&r.id&&this.cleanupAfterResponse(t),o}if(!jv(n)){const{message:o}=F("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),T(this,"isValidPing",async t=>{if(!Le(t)){const{message:s}=F("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)}),T(this,"isValidEmit",async t=>{if(!Le(t)){const{message:a}=F("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}const{topic:r,event:s,chainId:n}=t;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!wc(o,n)){const{message:a}=F("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!Uv(s)){const{message:a}=F("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!Fv(o,n,s.name)){const{message:a}=F("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),T(this,"isValidDisconnect",async t=>{if(!Le(t)){const{message:s}=F("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)}),T(this,"isValidAuthenticate",t=>{const{chains:r,uri:s,domain:n,nonce:o}=t;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!de(s,!1))throw new Error("uri is required parameter");if(!de(n,!1))throw new Error("domain is required parameter");if(!de(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>zi(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=zi(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),T(this,"getVerifyContext",async t=>{const{attestationId:r,hash:s,encryptedId:n,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||vr,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ce.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const h=await this.client.core.verify.resolve({attestationId:r,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});h&&(c.verified.origin=h.origin,c.verified.isScam=h.isScam,c.verified.validation=h.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.warn(h)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),T(this,"validateSessionProps",(t,r)=>{Object.values(t).forEach((s,n)=>{if(s==null){const{message:o}=F("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${s} for key ${Object.keys(t)[n]}`);throw new Error(o)}})}),T(this,"getPendingAuthRequest",t=>{const r=this.client.auth.requests.get(t);return typeof r=="object"?r:void 0}),T(this,"addToRecentlyDeleted",(t,r)=>{if(this.recentlyDeletedMap.set(t,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),T(this,"checkRecentlyDeleted",t=>{const r=this.recentlyDeletedMap.get(t);if(r){const{message:s}=F("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${t}`);throw new Error(s)}}),T(this,"isLinkModeEnabled",(t,r)=>{var s,n,o,a,c,h,u,l,d;return!t||r!==ce.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((h=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:h.universal)!==""&&((u=t?.redirect)==null?void 0:u.universal)!==void 0&&((l=t?.redirect)==null?void 0:l.universal)!==""&&((d=t?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(H==null?void 0:H.Linking)<"u"}),T(this,"getAppLinkIfEnabled",(t,r)=>{var s;return this.isLinkModeEnabled(t,r)?(s=t?.redirect)==null?void 0:s.universal:void 0}),T(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const r=Ra(t,"topic")||"",s=decodeURIComponent(Ra(t,"wc_ev")||""),n=this.client.session.keys.includes(r);n&&this.client.session.update(r,{transportType:ce.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:s,sessionExists:n})}),T(this,"registerLinkModeListeners",async()=>{var t;if(Do()||Yt()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const r=H==null?void 0:H.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await r.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),T(this,"shouldSetTVF",(t,r)=>{if(!r||t!=="wc_sessionRequest")return!1;const{request:s}=r;return Object.keys(ph).includes(s.method)}),T(this,"getTVFParams",(t,r,s)=>{var n,o;try{const a=r.request.method,c=this.extractTxHashesFromResult(a,s);return Re(ne({correlationId:t,rpcMethods:[a],chainId:r.chainId},this.isValidContractData(r.request.params)&&{contractAddresses:[(o=(n=r.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),T(this,"isValidContractData",t=>{var r;if(!t)return!1;try{const s=t?.data||((r=t?.[0])==null?void 0:r.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),T(this,"extractTxHashesFromResult",(t,r)=>{try{const s=ph[t];if(typeof r=="string")return[r];const n=r[s.key];if(dt(n))return t==="solana_signAllTransactions"?n.map(o=>aw(o)):n;if(typeof n=="string")return[n]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,s]of Object.entries(t))for(const n of s)try{await this.onProviderMessageEvent({topic:r,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(be.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:r,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(hs)?this.client.auth.authKeys.get(hs):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(t,r,{receiverPublicKey:o,encoding:n===ce.link_mode?zt:lt});Ro(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:s,transportType:n,encryptedId:Et(r)})):Rs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:n}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(t,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(et.expired,async e=>{const{topic:t,id:r}=Ru(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,F("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,F("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(si.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(si.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!de(e,!1)){const{message:t}=F("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=F("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Mt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=F("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!de(e,!1)){const{message:t}=F("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=F("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Mt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=F("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=F("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(de(e,!1)){const{message:t}=F("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=F("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Nv(e)){const{message:t}=F("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=F("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Mt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=F("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class x2 extends mi{constructor(e,t){super(e,t,g2,jo),this.core=e,this.logger=t}}let N2=class extends mi{constructor(e,t){super(e,t,y2,jo),this.core=e,this.logger=t}};class T2 extends mi{constructor(e,t){super(e,t,w2,jo,r=>r.id),this.core=e,this.logger=t}}class R2 extends mi{constructor(e,t){super(e,t,_2,Us,()=>hs),this.core=e,this.logger=t}}class j2 extends mi{constructor(e,t){super(e,t,I2,Us),this.core=e,this.logger=t}}class U2 extends mi{constructor(e,t){super(e,t,D2,Us,r=>r.id),this.core=e,this.logger=t}}var q2=Object.defineProperty,F2=(i,e,t)=>e in i?q2(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$n=(i,e,t)=>F2(i,typeof e!="symbol"?e+"":e,t);class B2{constructor(e,t){this.core=e,this.logger=t,$n(this,"authKeys"),$n(this,"pairingTopics"),$n(this,"requests"),this.authKeys=new R2(this.core,this.logger),this.pairingTopics=new j2(this.core,this.logger),this.requests=new U2(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var L2=Object.defineProperty,k2=(i,e,t)=>e in i?L2(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Y=(i,e,t)=>k2(i,typeof e!="symbol"?e+"":e,t);let M2=class Ml extends aE{constructor(e){super(e),Y(this,"protocol",Bl),Y(this,"version",Ll),Y(this,"name",In.name),Y(this,"metadata"),Y(this,"core"),Y(this,"logger"),Y(this,"events",new rt.EventEmitter),Y(this,"engine"),Y(this,"session"),Y(this,"proposal"),Y(this,"pendingRequest"),Y(this,"auth"),Y(this,"signConfig"),Y(this,"on",(r,s)=>this.events.on(r,s)),Y(this,"once",(r,s)=>this.events.once(r,s)),Y(this,"off",(r,s)=>this.events.off(r,s)),Y(this,"removeListener",(r,s)=>this.events.removeListener(r,s)),Y(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),Y(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"update",async r=>{try{return await this.engine.update(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"request",async r=>{try{return await this.engine.request(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"find",r=>{try{return this.engine.find(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),Y(this,"authenticate",async(r,s)=>{try{return await this.engine.authenticate(r,s)}catch(n){throw this.logger.error(n.message),n}}),Y(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(s){throw this.logger.error(s.message),s}}),Y(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||In.name,this.metadata=vm(e?.metadata),this.signConfig=e?.signConfig;const t=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Br(xs({level:e?.logger||In.logger}));this.core=e?.core||new f2(e),this.logger=Ue(t,this.name),this.session=new N2(this.core,this.logger),this.proposal=new x2(this.core,this.logger),this.pendingRequest=new T2(this.core,this.logger),this.engine=new A2(this),this.auth=new B2(this.core,this.logger)}static async init(e){const t=new Ml(e);return await t.initialize(),t}get context(){return ze(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},q.toMiliseconds(q.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var z2=Object.defineProperty,H2=Object.defineProperties,V2=Object.getOwnPropertyDescriptors,gh=Object.getOwnPropertySymbols,K2=Object.prototype.hasOwnProperty,W2=Object.prototype.propertyIsEnumerable,yh=(i,e,t)=>e in i?z2(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,mh=(i,e)=>{for(var t in e||(e={}))K2.call(e,t)&&yh(i,t,e[t]);if(gh)for(var t of gh(e))W2.call(e,t)&&yh(i,t,e[t]);return i},wh=(i,e)=>H2(i,V2(e));const G2={Accept:"application/json","Content-Type":"application/json"},Y2="POST",bh={headers:G2,method:Y2},vh=10;let pt=class{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new rt.EventEmitter,this.isAvailable=!1,this.registering=!1,!qc(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=qt(e),r=await(await Vo(this.url,wh(mh({},bh),{body:t}))).json();this.onPayload({data:r})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!qc(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((r,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));r()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=qt({id:1,jsonrpc:"2.0",method:"test",params:[]});await Vo(e,wh(mh({},bh),{body:t}))}this.onOpen()}catch(t){const r=this.parseError(t);throw this.events.emit("register_error",r),this.onClose(),r}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?ui(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),s=r.message||r.toString(),n=Ts(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return vl(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>vh&&this.events.setMaxListeners(vh)}};const Eh="error",J2="wss://relay.walletconnect.org",Z2="wc",Q2="universal_provider",Qr=`${Z2}@2:${Q2}:`,zl="https://rpc.walletconnect.org/v1/",Bi="generic",X2=`${zl}bundler`,nt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function eD(){}function Uo(i){return i==null||typeof i!="object"&&typeof i!="function"}function qo(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function tD(i){if(Uo(i))return i;if(Array.isArray(i)||qo(i)||i instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&i instanceof SharedArrayBuffer)return i.slice(0);const e=Object.getPrototypeOf(i),t=e.constructor;if(i instanceof Date||i instanceof Map||i instanceof Set)return new t(i);if(i instanceof RegExp){const r=new t(i);return r.lastIndex=i.lastIndex,r}if(i instanceof DataView)return new t(i.buffer.slice(0));if(i instanceof Error){const r=new t(i.message);return r.stack=i.stack,r.name=i.name,r.cause=i.cause,r}if(typeof File<"u"&&i instanceof File)return new t([i],i.name,{type:i.type,lastModified:i.lastModified});if(typeof i=="object"){const r=Object.create(e);return Object.assign(r,i)}return i}function _h(i){return typeof i=="object"&&i!==null}function Hl(i){return Object.getOwnPropertySymbols(i).filter(e=>Object.prototype.propertyIsEnumerable.call(i,e))}function Vl(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}const iD="[object RegExp]",Kl="[object String]",Wl="[object Number]",Gl="[object Boolean]",Yl="[object Arguments]",rD="[object Symbol]",sD="[object Date]",nD="[object Map]",oD="[object Set]",aD="[object Array]",cD="[object ArrayBuffer]",hD="[object Object]",uD="[object DataView]",lD="[object Uint8Array]",dD="[object Uint8ClampedArray]",pD="[object Uint16Array]",fD="[object Uint32Array]",gD="[object Int8Array]",yD="[object Int16Array]",mD="[object Int32Array]",wD="[object Float32Array]",bD="[object Float64Array]";function vD(i,e){return Mi(i,void 0,i,new Map,e)}function Mi(i,e,t,r=new Map,s=void 0){const n=s?.(i,e,t,r);if(n!=null)return n;if(Uo(i))return i;if(r.has(i))return r.get(i);if(Array.isArray(i)){const o=new Array(i.length);r.set(i,o);for(let a=0;a<i.length;a++)o[a]=Mi(i[a],a,t,r,s);return Object.hasOwn(i,"index")&&(o.index=i.index),Object.hasOwn(i,"input")&&(o.input=i.input),o}if(i instanceof Date)return new Date(i.getTime());if(i instanceof RegExp){const o=new RegExp(i.source,i.flags);return o.lastIndex=i.lastIndex,o}if(i instanceof Map){const o=new Map;r.set(i,o);for(const[a,c]of i)o.set(a,Mi(c,a,t,r,s));return o}if(i instanceof Set){const o=new Set;r.set(i,o);for(const a of i)o.add(Mi(a,void 0,t,r,s));return o}if(typeof _e<"u"&&_e.isBuffer(i))return i.subarray();if(qo(i)){const o=new(Object.getPrototypeOf(i)).constructor(i.length);r.set(i,o);for(let a=0;a<i.length;a++)o[a]=Mi(i[a],a,t,r,s);return o}if(i instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&i instanceof SharedArrayBuffer)return i.slice(0);if(i instanceof DataView){const o=new DataView(i.buffer.slice(0),i.byteOffset,i.byteLength);return r.set(i,o),ni(o,i,t,r,s),o}if(typeof File<"u"&&i instanceof File){const o=new File([i],i.name,{type:i.type});return r.set(i,o),ni(o,i,t,r,s),o}if(i instanceof Blob){const o=new Blob([i],{type:i.type});return r.set(i,o),ni(o,i,t,r,s),o}if(i instanceof Error){const o=new i.constructor;return r.set(i,o),o.message=i.message,o.name=i.name,o.stack=i.stack,o.cause=i.cause,ni(o,i,t,r,s),o}if(typeof i=="object"&&ED(i)){const o=Object.create(Object.getPrototypeOf(i));return r.set(i,o),ni(o,i,t,r,s),o}return i}function ni(i,e,t=i,r,s){const n=[...Object.keys(e),...Hl(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(i,a);(c==null||c.writable)&&(i[a]=Mi(e[a],a,t,r,s))}}function ED(i){switch(Vl(i)){case Yl:case aD:case cD:case uD:case Gl:case sD:case wD:case bD:case gD:case yD:case mD:case nD:case Wl:case hD:case iD:case oD:case Kl:case rD:case lD:case dD:case pD:case fD:return!0;default:return!1}}function _D(i,e){return vD(i,(t,r,s,n)=>{if(typeof i=="object")switch(Object.prototype.toString.call(i)){case Wl:case Kl:case Gl:{const o=new i.constructor(i?.valueOf());return ni(o,i),o}case Yl:{const o={};return ni(o,i),o.length=i.length,o[Symbol.iterator]=i[Symbol.iterator],o}default:return}})}function Ih(i){return _D(i)}function Dh(i){return i!==null&&typeof i=="object"&&Vl(i)==="[object Arguments]"}function ID(i){return qo(i)}function DD(i){if(typeof i!="object"||i==null)return!1;if(Object.getPrototypeOf(i)===null)return!0;if(Object.prototype.toString.call(i)!=="[object Object]"){const t=i[Symbol.toStringTag];return t==null||!Object.getOwnPropertyDescriptor(i,Symbol.toStringTag)?.writable?!1:i.toString()===`[object ${t}]`}let e=i;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e}function $D(i,...e){const t=e.slice(0,-1),r=e[e.length-1];let s=i;for(let n=0;n<t.length;n++){const o=t[n];s=lo(s,o,r,new Map)}return s}function lo(i,e,t,r){if(Uo(i)&&(i=Object(i)),e==null||typeof e!="object")return i;if(r.has(e))return tD(r.get(e));if(r.set(e,i),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const s=[...Object.keys(e),...Hl(e)];for(let n=0;n<s.length;n++){const o=s[n];let a=e[o],c=i[o];if(Dh(a)&&(a={...a}),Dh(c)&&(c={...c}),typeof _e<"u"&&_e.isBuffer(a)&&(a=Ih(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],l=Reflect.ownKeys(c);for(let d=0;d<l.length;d++){const f=l[d];u[f]=c[f]}c=u}else c=[];const h=t(c,a,o,i,e,r);h!=null?i[o]=h:Array.isArray(a)||_h(c)&&_h(a)?i[o]=lo(c,a,t,r):c==null&&DD(a)?i[o]=lo({},a,t,r):c==null&&ID(a)?i[o]=Ih(a):(c===void 0||a!==void 0)&&(i[o]=a)}return i}function SD(i,...e){return $D(i,...e,eD)}var PD=Object.defineProperty,OD=Object.defineProperties,CD=Object.getOwnPropertyDescriptors,$h=Object.getOwnPropertySymbols,AD=Object.prototype.hasOwnProperty,xD=Object.prototype.propertyIsEnumerable,Sh=(i,e,t)=>e in i?PD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Xr=(i,e)=>{for(var t in e||(e={}))AD.call(e,t)&&Sh(i,t,e[t]);if($h)for(var t of $h(e))xD.call(e,t)&&Sh(i,t,e[t]);return i},ND=(i,e)=>OD(i,CD(e));function Je(i,e,t){var r;const s=zi(i);return((r=e.rpcMap)==null?void 0:r[s.reference])||`${zl}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function wi(i){return i.includes(":")?i.split(":")[1]:i}function Jl(i){return i.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function TD(i,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(i));if(!t.length)return[];const r=[];return t.forEach(s=>{const n=e.namespaces[s].accounts;r.push(...n)}),r}function es(i={},e={}){const t=Ph(i),r=Ph(e);return SD(t,r)}function Ph(i){var e,t,r,s,n;const o={};if(!Gt(i))return o;for(const[a,c]of Object.entries(i)){const h=As(a)?[a]:c.chains,u=c.methods||[],l=c.events||[],d=c.rpcMap||{},f=ki(a);o[f]=ND(Xr(Xr({},o[f]),c),{chains:_t(h,(e=o[f])==null?void 0:e.chains),methods:_t(u,(t=o[f])==null?void 0:t.methods),events:_t(l,(r=o[f])==null?void 0:r.events)}),(Gt(d)||Gt(((s=o[f])==null?void 0:s.rpcMap)||{}))&&(o[f].rpcMap=Xr(Xr({},d),(n=o[f])==null?void 0:n.rpcMap))}return o}function Oh(i){return i.includes(":")?i.split(":")[2]:i}function Ch(i){const e={};for(const[t,r]of Object.entries(i)){const s=r.methods||[],n=r.events||[],o=r.accounts||[],a=As(t)?[t]:r.chains?r.chains:Jl(r.accounts);e[t]={chains:a,methods:s,events:n,accounts:o}}return e}function Sn(i){return typeof i=="number"?i:i.includes("0x")?parseInt(i,16):(i=i.includes(":")?i.split(":")[1]:i,isNaN(Number(i))?i:Number(i))}const Zl={},X=i=>Zl[i],Pn=(i,e)=>{Zl[i]=e};var RD=Object.defineProperty,jD=(i,e,t)=>e in i?RD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Pi=(i,e,t)=>jD(i,typeof e!="symbol"?e+"":e,t);class UD{constructor(e){Pi(this,"name","polkadot"),Pi(this,"client"),Pi(this,"httpProviders"),Pi(this,"events"),Pi(this,"namespace"),Pi(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const s=wi(t);e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(r,X("disableProviderPing")))}}var qD=Object.defineProperty,FD=Object.defineProperties,BD=Object.getOwnPropertyDescriptors,Ah=Object.getOwnPropertySymbols,LD=Object.prototype.hasOwnProperty,kD=Object.prototype.propertyIsEnumerable,po=(i,e,t)=>e in i?qD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,xh=(i,e)=>{for(var t in e||(e={}))LD.call(e,t)&&po(i,t,e[t]);if(Ah)for(var t of Ah(e))kD.call(e,t)&&po(i,t,e[t]);return i},Nh=(i,e)=>FD(i,BD(e)),Oi=(i,e,t)=>po(i,typeof e!="symbol"?e+"":e,t);class MD{constructor(e){Oi(this,"name","eip155"),Oi(this,"client"),Oi(this,"chainId"),Oi(this,"namespace"),Oi(this,"httpProviders"),Oi(this,"events"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const r=t||Je(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(r,X("disableProviderPing")))}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const s=parseInt(wi(t));e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,r;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(r=this.namespace.chains)==null?void 0:r[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,r,s,n,o;const a=(r=(t=e.request)==null?void 0:t.params)==null?void 0:r[0],c=((n=(s=e.request)==null?void 0:s.params)==null?void 0:n[1])||[],h=`${a}${c.join(",")}`;if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const u=this.client.session.get(e.topic),l=((o=u?.sessionProperties)==null?void 0:o.capabilities)||{};if(l!=null&&l[h])return l?.[h];const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Nh(xh({},u.sessionProperties||{}),{capabilities:Nh(xh({},l||{}),{[h]:d})})})}catch(f){console.warn("Failed to update session with capabilities",f)}return d}async getCallStatus(e){var t,r;const s=this.client.session.get(e.topic),n=(t=s.sessionProperties)==null?void 0:t.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(r=s.sessionProperties)==null?void 0:r.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var r;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Vt("eth_getUserOperationReceipt",[(r=t.request.params)==null?void 0:r[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${X2}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var zD=Object.defineProperty,HD=(i,e,t)=>e in i?zD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ci=(i,e,t)=>HD(i,typeof e!="symbol"?e+"":e,t);class VD{constructor(e){Ci(this,"name","solana"),Ci(this,"client"),Ci(this,"httpProviders"),Ci(this,"events"),Ci(this,"namespace"),Ci(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const s=wi(t);e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(r,X("disableProviderPing")))}}var KD=Object.defineProperty,WD=(i,e,t)=>e in i?KD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ai=(i,e,t)=>WD(i,typeof e!="symbol"?e+"":e,t);class GD{constructor(e){Ai(this,"name","cosmos"),Ai(this,"client"),Ai(this,"httpProviders"),Ai(this,"events"),Ai(this,"namespace"),Ai(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const s=wi(t);e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(r,X("disableProviderPing")))}}var YD=Object.defineProperty,JD=(i,e,t)=>e in i?YD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,xi=(i,e,t)=>JD(i,typeof e!="symbol"?e+"":e,t);class ZD{constructor(e){xi(this,"name","algorand"),xi(this,"client"),xi(this,"httpProviders"),xi(this,"events"),xi(this,"namespace"),xi(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const r=t||Je(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;e[t]=this.createHttpProvider(t,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new st(new pt(r,X("disableProviderPing")))}}var QD=Object.defineProperty,XD=(i,e,t)=>e in i?QD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ni=(i,e,t)=>XD(i,typeof e!="symbol"?e+"":e,t);class e${constructor(e){Ni(this,"name","cip34"),Ni(this,"client"),Ni(this,"httpProviders"),Ni(this,"events"),Ni(this,"namespace"),Ni(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const r=this.getCardanoRPCUrl(t),s=wi(t);e[s]=this.createHttpProvider(s,r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||this.getCardanoRPCUrl(e);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(r,X("disableProviderPing")))}}var t$=Object.defineProperty,i$=(i,e,t)=>e in i?t$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ti=(i,e,t)=>i$(i,typeof e!="symbol"?e+"":e,t);class r${constructor(e){Ti(this,"name","elrond"),Ti(this,"client"),Ti(this,"httpProviders"),Ti(this,"events"),Ti(this,"namespace"),Ti(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const s=wi(t);e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(r,X("disableProviderPing")))}}var s$=Object.defineProperty,n$=(i,e,t)=>e in i?s$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ri=(i,e,t)=>n$(i,typeof e!="symbol"?e+"":e,t);class o${constructor(e){Ri(this,"name","multiversx"),Ri(this,"client"),Ri(this,"httpProviders"),Ri(this,"events"),Ri(this,"namespace"),Ri(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const s=wi(t);e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(r,X("disableProviderPing")))}}var a$=Object.defineProperty,c$=(i,e,t)=>e in i?a$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ji=(i,e,t)=>c$(i,typeof e!="symbol"?e+"":e,t);class h${constructor(e){ji(this,"name","near"),ji(this,"client"),ji(this,"httpProviders"),ji(this,"events"),ji(this,"namespace"),ji(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Je(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;e[t]=this.createHttpProvider(t,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace);return typeof r>"u"?void 0:new st(new pt(r,X("disableProviderPing")))}}var u$=Object.defineProperty,l$=(i,e,t)=>e in i?u$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ui=(i,e,t)=>l$(i,typeof e!="symbol"?e+"":e,t);class d${constructor(e){Ui(this,"name","tezos"),Ui(this,"client"),Ui(this,"httpProviders"),Ui(this,"events"),Ui(this,"namespace"),Ui(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Je(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace);return typeof r>"u"?void 0:new st(new pt(r))}}var p$=Object.defineProperty,f$=(i,e,t)=>e in i?p$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qi=(i,e,t)=>f$(i,typeof e!="symbol"?e+"":e,t);class g${constructor(e){qi(this,"name",Bi),qi(this,"client"),qi(this,"httpProviders"),qi(this,"events"),qi(this,"namespace"),qi(this,"chainId"),this.namespace=e.namespace,this.events=X("events"),this.client=X("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const r={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const n=zi(s);r[`${n.namespace}:${n.reference}`]=this.createHttpProvider(s)}),r}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Je(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(r,X("disableProviderPing")))}}var y$=Object.defineProperty,m$=Object.defineProperties,w$=Object.getOwnPropertyDescriptors,Th=Object.getOwnPropertySymbols,b$=Object.prototype.hasOwnProperty,v$=Object.prototype.propertyIsEnumerable,fo=(i,e,t)=>e in i?y$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ts=(i,e)=>{for(var t in e||(e={}))b$.call(e,t)&&fo(i,t,e[t]);if(Th)for(var t of Th(e))v$.call(e,t)&&fo(i,t,e[t]);return i},On=(i,e)=>m$(i,w$(e)),Xe=(i,e,t)=>fo(i,typeof e!="symbol"?e+"":e,t);let E$=class Ql{constructor(e){Xe(this,"client"),Xe(this,"namespaces"),Xe(this,"optionalNamespaces"),Xe(this,"sessionProperties"),Xe(this,"scopedProperties"),Xe(this,"events",new yo),Xe(this,"rpcProviders",{}),Xe(this,"session"),Xe(this,"providerOpts"),Xe(this,"logger"),Xe(this,"uri"),Xe(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Br(xs({level:e?.logger||Eh})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new Ql(e);return await t.initialize(),t}async request(e,t,r){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ts({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:r})}sendAsync(e,t,r,s){const n=new Date().getTime();this.request(e,r,s).then(o=>t(null,Ns(n,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ie("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:r,response:s}=await this.client.authenticate(e,t);r&&(this.uri=r,this.events.emit("display_uri",r));const n=await s();if(this.session=n.session,this.session){const o=Ch(this.session.namespaces);this.namespaces=es(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await r();this.session=s;const n=Ch(s.namespaces);return this.namespaces=es(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[r,s]=this.validateChain(e),n=this.getProvider(r);n.name===Bi?n.setDefaultChain(`${r}:${s}`,t):n.setDefaultChain(s,t)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(dt(t)){for(const r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await M2.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Eh,relayUrl:this.providerOpts.relayUrl||J2,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error("Failed to get session",r),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const r=this.client.session.getAll();this.session=r[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>ki(t)))];Pn("client",this.client),Pn("events",this.events),Pn("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const r=TD(t,this.session),s=Jl(r),n=es(this.namespaces,this.optionalNamespaces),o=On(ts({},n[t]),{accounts:r,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new MD({namespace:o});break;case"algorand":this.rpcProviders[t]=new ZD({namespace:o});break;case"solana":this.rpcProviders[t]=new VD({namespace:o});break;case"cosmos":this.rpcProviders[t]=new GD({namespace:o});break;case"polkadot":this.rpcProviders[t]=new UD({namespace:o});break;case"cip34":this.rpcProviders[t]=new e$({namespace:o});break;case"elrond":this.rpcProviders[t]=new r$({namespace:o});break;case"multiversx":this.rpcProviders[t]=new o$({namespace:o});break;case"near":this.rpcProviders[t]=new h$({namespace:o});break;case"tezos":this.rpcProviders[t]=new d$({namespace:o});break;default:this.rpcProviders[Bi]?this.rpcProviders[Bi].updateNamespace(o):this.rpcProviders[Bi]=new g$({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:r}=e;r===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:r,topic:s}=e;if(s!==((t=this.session)==null?void 0:t.topic))return;const{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&dt(o)&&this.events.emit("accountsChanged",o.map(Oh))}else if(n.name==="chainChanged"){const o=r.chainId,a=r.event.data,c=ki(o),h=Sn(o)!==Sn(a)?`${c}:${Sn(a)}`:o;this.onChainChanged(h)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r,s;if(e!==((r=this.session)==null?void 0:r.topic))return;const{namespaces:n}=t,o=(s=this.client)==null?void 0:s.session.get(e);this.session=On(ts({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",On(ts({},ie("USER_DISCONNECTED")),{data:e.topic})))}),this.on(nt.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Bi]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:r={},sessionProperties:s,scopedProperties:n}=e;this.optionalNamespaces=es(t,r),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[t,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,r];if(t&&!Object.keys(this.namespaces||{}).map(o=>ki(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];const s=ki(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[r,s]=this.validateChain(e);if(!s)return;this.updateNamespaceChain(r,s),this.events.emit("chainChanged",s);const n=this.getProvider(r).getDefaultChain();t||this.getProvider(r).setDefaultChain(s),this.emitAccountsChangedOnChainChange({namespace:r,previousChainId:n,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:r}){var s,n;try{if(t===r)return;const o=(n=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(Oh);if(!dt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const r=this.namespaces[e]?e:`${e}:${t}`,s={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=t):this.namespaces[r]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var r;const s=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.setItem(`${Qr}/${e}${s}`,t)}async getFromStore(e){var t;const r=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${Qr}/${e}${r}`)}async deleteFromStore(e){var t;const r=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${Qr}/${e}${r}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const r of t)r.startsWith(Qr)&&await this.client.core.storage.removeItem(r)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}};const _$=E$,I$="wc",D$="ethereum_provider",$$=`${I$}@2:${D$}:`,S$="https://rpc.walletconnect.org/v1/",ws=["eth_sendTransaction","personal_sign"],Xl=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],bs=["chainChanged","accountsChanged"],ed=["chainChanged","accountsChanged","message","disconnect","connect"],P$=async()=>{const{createAppKit:i}=await qh(()=>import("./core-DgXLvxy9.js").then(e=>e.G),__vite__mapDeps([2,0,1]));return i};var O$=Object.defineProperty,C$=Object.defineProperties,A$=Object.getOwnPropertyDescriptors,Rh=Object.getOwnPropertySymbols,x$=Object.prototype.hasOwnProperty,N$=Object.prototype.propertyIsEnumerable,go=(i,e,t)=>e in i?O$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ti=(i,e)=>{for(var t in e||(e={}))x$.call(e,t)&&go(i,t,e[t]);if(Rh)for(var t of Rh(e))N$.call(e,t)&&go(i,t,e[t]);return i},fr=(i,e)=>C$(i,A$(e)),Ve=(i,e,t)=>go(i,typeof e!="symbol"?e+"":e,t);function vs(i){return Number(i[0].split(":")[1])}function is(i){return`0x${i.toString(16)}`}function T$(i){const{chains:e,optionalChains:t,methods:r,optionalMethods:s,events:n,optionalEvents:o,rpcMap:a}=i;if(!dt(e))throw new Error("Invalid chains");const c={chains:e,methods:r||ws,events:n||bs,rpcMap:ti({},e.length?{[vs(e)]:a[vs(e)]}:{})},h=n?.filter(f=>!bs.includes(f)),u=r?.filter(f=>!ws.includes(f));if(!t&&!o&&!s&&!(h!=null&&h.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const l=h?.length&&u?.length||!t,d={chains:[...new Set(l?c.chains.concat(t||[]):t)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:Xl))],events:[...new Set(c.events.concat(o!=null&&o.length?o:ed))],rpcMap:a};return{required:e.length?c:void 0,optional:t.length?d:void 0}}class qs{constructor(){Ve(this,"events",new rt.EventEmitter),Ve(this,"namespace","eip155"),Ve(this,"accounts",[]),Ve(this,"signer"),Ve(this,"chainId",1),Ve(this,"modal"),Ve(this,"rpc"),Ve(this,"STORAGE_KEY",$$),Ve(this,"on",(e,t)=>(this.events.on(e,t),this)),Ve(this,"once",(e,t)=>(this.events.once(e,t),this)),Ve(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),Ve(this,"off",(e,t)=>(this.events.off(e,t),this)),Ve(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new qs;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,r){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),r)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:r,optional:s}=T$(this.rpc);try{const n=await new Promise(async(a,c)=>{var h,u;this.rpc.showQrModal&&((h=this.modal)==null||h.open(),(u=this.modal)==null||u.subscribeState(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const l=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(fr(ti({namespaces:ti({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e?.pairingTopic,scopedProperties:l})).then(d=>{a(d)}).catch(d=>{var f;(f=this.modal)==null||f.showErrorMessage("Unable to connect"),c(new Error(d.message))})});if(!n)return;const o=Ca(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:is(this.chainId)})}catch(n){throw this.signer.logger.error(n),n}finally{(t=this.modal)==null||t.close()}}async authenticate(e,t){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{const s=await new Promise(async(o,a)=>{var c,h;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(h=this.modal)==null||h.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(fr(ti({},e),{chains:this.rpc.chains}),t).then(u=>{o(u)}).catch(u=>{var l;(l=this.modal)==null||l.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),n=s.session;if(n){const o=Ca(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:is(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(r=this.modal)==null||r.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:r}=t;r.name==="accountsChanged"?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):r.name==="chainChanged"?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",is(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",fr(ti({},ie("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(r=>this.isCompatibleChainId(r)).map(r=>this.parseChainId(r));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",is(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,r,s]=e.split(":");return{chainId:`${t}:${r}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,r;const s=(t=e?.chains)!=null?t:[],n=(r=e?.optionalChains)!=null?r:[],o=s.concat(n);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?e?.methods||ws:[],c=s.length?e?.events||bs:[],h=e?.optionalMethods||[],u=e?.optionalEvents||[],l=e?.rpcMap||this.buildRpcMap(o,e.projectId),d=e?.qrModalOptions||void 0;return{chains:s?.map(f=>this.formatChainId(f)),optionalChains:n.map(f=>this.formatChainId(f)),methods:a,events:c,optionalMethods:h,optionalEvents:u,rpcMap:l,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:d,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const r={};return e.forEach(s=>{r[s]=this.getRpcUrl(s,t)}),r}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?vs(this.rpc.chains):vs(this.rpc.optionalChains),this.signer=await _$.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const r=await P$(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return H$}),n=s(fr(ti({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!n.networks.length)throw new Error("No networks found for WalletConnect");t=r(fr(ti({},n),{universalProvider:this.signer,manualWCControl:!0}))}catch(r){throw console.warn(r),new Error("To use QR modal, please install @reown/appkit package")}if(t)try{this.modal=t}catch(r){throw this.signer.logger.error(r),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:r,rpcMap:s}=e;t&&dt(t)&&(this.rpc.chains=t.map(n=>this.formatChainId(n)),t.forEach(n=>{this.rpc.rpcMap[n]=s?.[n]||this.getRpcUrl(n)})),r&&dt(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=r?.map(n=>this.formatChainId(n)),r.forEach(n=>{this.rpc.rpcMap[n]=s?.[n]||this.getRpcUrl(n)}))}getRpcUrl(e,t){var r;return((r=this.rpc.rpcMap)==null?void 0:r[e])||`${S$}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t?.accounts),this.setAccounts(t?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const R$=qs;var j$=Object.defineProperty,U$=Object.defineProperties,q$=Object.getOwnPropertyDescriptors,jh=Object.getOwnPropertySymbols,F$=Object.prototype.hasOwnProperty,B$=Object.prototype.propertyIsEnumerable,Uh=(i,e,t)=>e in i?j$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,td=(i,e)=>{for(var t in e||(e={}))F$.call(e,t)&&Uh(i,t,e[t]);if(jh)for(var t of jh(e))B$.call(e,t)&&Uh(i,t,e[t]);return i},L$=(i,e)=>U$(i,q$(e));function k$(i){if(i)return{"--w3m-font-family":i["--wcm-font-family"],"--w3m-accent":i["--wcm-accent-color"],"--w3m-color-mix":i["--wcm-background-color"],"--w3m-z-index":i["--wcm-z-index"]?Number(i["--wcm-z-index"]):void 0,"--w3m-qr-color":i["--wcm-accent-color"],"--w3m-font-size-master":i["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":i["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const M$=i=>{const[e,t]=i.split(":");return id({id:t,caipNetworkId:i,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function z$(i){var e,t,r,s,n,o,a;const c=(e=i.chains)==null?void 0:e.map(M$).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const h=c.find(l=>{var d;return l.id===((d=i.defaultChain)==null?void 0:d.id)}),u={projectId:i.projectId,networks:c,themeMode:i.themeMode,themeVariables:k$(i.themeVariables),chainImages:i.chainImages,connectorImages:i.walletImages,defaultNetwork:h,metadata:L$(td({},i.metadata),{name:((t=i.metadata)==null?void 0:t.name)||"WalletConnect",description:((r=i.metadata)==null?void 0:r.description)||"Connect to WalletConnect-compatible wallets",url:((s=i.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((n=i.metadata)==null?void 0:n.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:i.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(i.explorerRecommendedWalletIds)?i.explorerRecommendedWalletIds:[],excludeWalletIds:i.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(i.explorerExcludedWalletIds)?i.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=i.mobileWallets)!=null&&o.length||(a=i.desktopWallets)!=null&&a.length){const l=[...(i.mobileWallets||[]).map(p=>({id:p.id,name:p.name,links:p.links})),...(i.desktopWallets||[]).map(p=>({id:p.id,name:p.name,links:{native:p.links.native,universal:p.links.universal}}))],d=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],f=l.filter(p=>!d.includes(p.id));f.length&&(u.customWallets=f)}return u}function id(i){return td({formatters:void 0,fees:void 0,serializers:void 0},i)}var H$=Object.freeze({__proto__:null,convertWCMToAppKitOptions:z$,defineChain:id});const OS=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:R$,OPTIONAL_EVENTS:ed,OPTIONAL_METHODS:Xl,REQUIRED_EVENTS:bs,REQUIRED_METHODS:ws,default:qs},Symbol.toStringTag,{value:"Module"}));export{M0 as A,tt as B,om as C,bt as D,Ue as E,pt as F,OS as G,gi as I,Br as O,Sa as P,Du as Q,q as a,Ut as b,Yd as c,mr as d,yp as e,it as f,Vt as g,$0 as h,Jv as i,yi as j,xs as k,xE as l,Ro as m,Rs as n,st as o,Ns as p,hy as q,pp as r,Bn as s,Me as t,qt as u,ui as v,ai as w,Ts as x,ze as y,vt as z};
